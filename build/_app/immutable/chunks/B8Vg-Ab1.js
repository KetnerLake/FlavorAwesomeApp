import{W as Qu,ao as Xu,ap as Zu}from"./uVd2Cqrn.js";const ec=[];function Oo(e,t=!1){return br(e,new Map,"",ec)}function br(e,t,n,o,s=null){if(typeof e=="object"&&e!==null){var u=t.get(e);if(u!==void 0)return u;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Qu(e)){var f=Array(e.length);t.set(e,f),s!==null&&t.set(s,f);for(var h=0;h<e.length;h+=1){var y=e[h];h in e&&(f[h]=br(y,t,n,o))}return f}if(Xu(e)===Zu){f={},t.set(e,f),s!==null&&t.set(s,f);for(var v in e)f[v]=br(e[v],t,n,o);return f}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function")return br(e.toJSON(),t,n,o,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}var tc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var gr={exports:{}},rc=gr.exports,ts;function oc(){return ts||(ts=1,function(e,t){(function(n,o){e.exports=o()})(rc,function(){var n=function(r,i){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])})(r,i)},o=function(){return(o=Object.assign||function(r){for(var i,a=1,c=arguments.length;a<c;a++)for(var d in i=arguments[a])Object.prototype.hasOwnProperty.call(i,d)&&(r[d]=i[d]);return r}).apply(this,arguments)};function s(r,i,a){for(var c,d=0,p=i.length;d<p;d++)!c&&d in i||((c=c||Array.prototype.slice.call(i,0,d))[d]=i[d]);return r.concat(c||Array.prototype.slice.call(i))}var u=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:tc,f=Object.keys,h=Array.isArray;function y(r,i){return typeof i!="object"||f(i).forEach(function(a){r[a]=i[a]}),r}typeof Promise>"u"||u.Promise||(u.Promise=Promise);var v=Object.getPrototypeOf,l={}.hasOwnProperty;function g(r,i){return l.call(r,i)}function b(r,i){typeof i=="function"&&(i=i(v(r))),(typeof Reflect>"u"?f:Reflect.ownKeys)(i).forEach(function(a){j(r,a,i[a])})}var w=Object.defineProperty;function j(r,i,a,c){w(r,i,y(a&&g(a,"get")&&typeof a.get=="function"?{get:a.get,set:a.set,configurable:!0}:{value:a,configurable:!0,writable:!0},c))}function K(r){return{from:function(i){return r.prototype=Object.create(i.prototype),j(r.prototype,"constructor",r),{extend:b.bind(null,r.prototype)}}}}var N=Object.getOwnPropertyDescriptor,q=[].slice;function G(r,i,a){return q.call(r,i,a)}function B(r,i){return i(r)}function Q(r){if(!r)throw new Error("Assertion Failed")}function ce(r){u.setImmediate?setImmediate(r):setTimeout(r,0)}function te(r,i){if(typeof i=="string"&&g(r,i))return r[i];if(!i)return r;if(typeof i!="string"){for(var a=[],c=0,d=i.length;c<d;++c){var p=te(r,i[c]);a.push(p)}return a}var m=i.indexOf(".");if(m!==-1){var _=r[i.substr(0,m)];return _==null?void 0:te(_,i.substr(m+1))}}function pe(r,i,a){if(r&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(r)))if(typeof i!="string"&&"length"in i){Q(typeof a!="string"&&"length"in a);for(var c=0,d=i.length;c<d;++c)pe(r,i[c],a[c])}else{var p,m,_=i.indexOf(".");_!==-1?(p=i.substr(0,_),(m=i.substr(_+1))===""?a===void 0?h(r)&&!isNaN(parseInt(p))?r.splice(p,1):delete r[p]:r[p]=a:pe(_=!(_=r[p])||!g(r,p)?r[p]={}:_,m,a)):a===void 0?h(r)&&!isNaN(parseInt(i))?r.splice(i,1):delete r[i]:r[i]=a}}function ge(r){var i,a={};for(i in r)g(r,i)&&(a[i]=r[i]);return a}var ve=[].concat;function Z(r){return ve.apply([],r)}var It="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Z([8,16,32,64].map(function(r){return["Int","Uint","Float"].map(function(i){return i+r+"Array"})}))).filter(function(r){return u[r]}),oe=new Set(It.map(function(r){return u[r]})),ue=null;function Y(r){return ue=new WeakMap,r=function i(a){if(!a||typeof a!="object")return a;var c=ue.get(a);if(c)return c;if(h(a)){c=[],ue.set(a,c);for(var d=0,p=a.length;d<p;++d)c.push(i(a[d]))}else if(oe.has(a.constructor))c=a;else{var m,_=v(a);for(m in c=_===Object.prototype?{}:Object.create(_),ue.set(a,c),a)g(a,m)&&(c[m]=i(a[m]))}return c}(r),ue=null,r}var z={}.toString;function re(r){return z.call(r).slice(8,-1)}var de=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ee=typeof de=="symbol"?function(r){var i;return r!=null&&(i=r[de])&&i.apply(r)}:function(){return null};function Oe(r,i){return i=r.indexOf(i),0<=i&&r.splice(i,1),0<=i}var _e={};function ke(r){var i,a,c,d;if(arguments.length===1){if(h(r))return r.slice();if(this===_e&&typeof r=="string")return[r];if(d=Ee(r)){for(a=[];!(c=d.next()).done;)a.push(c.value);return a}if(r==null)return[r];if(typeof(i=r.length)!="number")return[r];for(a=new Array(i);i--;)a[i]=r[i];return a}for(i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return a}var Ue=typeof Symbol<"u"?function(r){return r[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},fn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Je=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(fn),We={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function $e(r,i){this.name=r,this.message=i}function Me(r,i){return r+". Errors: "+Object.keys(i).map(function(a){return i[a].toString()}).filter(function(a,c,d){return d.indexOf(a)===c}).join(`
`)}function De(r,i,a,c){this.failures=i,this.failedKeys=c,this.successCount=a,this.message=Me(r,i)}function at(r,i){this.name="BulkError",this.failures=Object.keys(i).map(function(a){return i[a]}),this.failuresByPos=i,this.message=Me(r,this.failures)}K($e).from(Error).extend({toString:function(){return this.name+": "+this.message}}),K(De).from($e),K(at).from($e);var qr=Je.reduce(function(r,i){return r[i]=i+"Error",r},{}),_u=$e,ne=Je.reduce(function(r,i){var a=i+"Error";function c(d,p){this.name=a,d?typeof d=="string"?(this.message="".concat(d).concat(p?`
 `+p:""),this.inner=p||null):typeof d=="object"&&(this.message="".concat(d.name," ").concat(d.message),this.inner=d):(this.message=We[i]||a,this.inner=null)}return K(c).from(_u),r[i]=c,r},{});ne.Syntax=SyntaxError,ne.Type=TypeError,ne.Range=RangeError;var wi=fn.reduce(function(r,i){return r[i+"Error"]=ne[i],r},{}),Bn=Je.reduce(function(r,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(r[i+"Error"]=ne[i]),r},{});function me(){}function cn(r){return r}function wu(r,i){return r==null||r===cn?i:function(a){return i(r(a))}}function Ot(r,i){return function(){r.apply(this,arguments),i.apply(this,arguments)}}function ku(r,i){return r===me?i:function(){var a=r.apply(this,arguments);a!==void 0&&(arguments[0]=a);var c=this.onsuccess,d=this.onerror;this.onsuccess=null,this.onerror=null;var p=i.apply(this,arguments);return c&&(this.onsuccess=this.onsuccess?Ot(c,this.onsuccess):c),d&&(this.onerror=this.onerror?Ot(d,this.onerror):d),p!==void 0?p:a}}function xu(r,i){return r===me?i:function(){r.apply(this,arguments);var a=this.onsuccess,c=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?Ot(a,this.onsuccess):a),c&&(this.onerror=this.onerror?Ot(c,this.onerror):c)}}function Su(r,i){return r===me?i:function(a){var c=r.apply(this,arguments);y(a,c);var d=this.onsuccess,p=this.onerror;return this.onsuccess=null,this.onerror=null,a=i.apply(this,arguments),d&&(this.onsuccess=this.onsuccess?Ot(d,this.onsuccess):d),p&&(this.onerror=this.onerror?Ot(p,this.onerror):p),c===void 0?a===void 0?void 0:a:y(c,a)}}function Eu(r,i){return r===me?i:function(){return i.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Fr(r,i){return r===me?i:function(){var a=r.apply(this,arguments);if(a&&typeof a.then=="function"){for(var c=this,d=arguments.length,p=new Array(d);d--;)p[d]=arguments[d];return a.then(function(){return i.apply(c,p)})}return i.apply(this,arguments)}}Bn.ModifyError=De,Bn.DexieError=$e,Bn.BulkError=at;var Ze=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ki(r){Ze=r}var ln={},xi=100,It=typeof Promise>"u"?[]:function(){var r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,v(r),r];var i=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[i,v(i),r]}(),fn=It[0],Je=It[1],It=It[2],Je=Je&&Je.then,At=fn&&fn.constructor,Wr=!!It,dn=function(r,i){hn.push([r,i]),Nn&&(queueMicrotask(Iu),Nn=!1)},Vr=!0,Nn=!0,Pt=[],Ln=[],zr=cn,vt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:me,pgp:!1,env:{},finalize:me},X=vt,hn=[],Ct=0,$n=[];function H(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=X;if(typeof r!="function"){if(r!==ln)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Gr(this,this._value))}this._state=null,this._value=null,++i.ref,function a(c,d){try{d(function(p){if(c._state===null){if(p===c)throw new TypeError("A promise cannot be resolved with itself.");var m=c._lib&&Lt();p&&typeof p.then=="function"?a(c,function(_,x){p instanceof H?p._then(_,x):p.then(_,x)}):(c._state=!0,c._value=p,Ei(c)),m&&$t()}},Gr.bind(null,c))}catch(p){Gr(c,p)}}(this,r)}var Hr={get:function(){var r=X,i=Wn;function a(c,d){var p=this,m=!r.global&&(r!==X||i!==Wn),_=m&&!bt(),x=new H(function(E,A){Yr(p,new Si(Ii(c,r,m,_),Ii(d,r,m,_),E,A,r))});return this._consoleTask&&(x._consoleTask=this._consoleTask),x}return a.prototype=ln,a},set:function(r){j(this,"then",r&&r.prototype===ln?Hr:{get:function(){return r},set:Hr.set})}};function Si(r,i,a,c,d){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof i=="function"?i:null,this.resolve=a,this.reject=c,this.psd=d}function Gr(r,i){var a,c;Ln.push(i),r._state===null&&(a=r._lib&&Lt(),i=zr(i),r._state=!1,r._value=i,c=r,Pt.some(function(d){return d._value===c._value})||Pt.push(c),Ei(r),a&&$t())}function Ei(r){var i=r._listeners;r._listeners=[];for(var a=0,c=i.length;a<c;++a)Yr(r,i[a]);var d=r._PSD;--d.ref||d.finalize(),Ct===0&&(++Ct,dn(function(){--Ct==0&&Jr()},[]))}function Yr(r,i){if(r._state!==null){var a=r._state?i.onFulfilled:i.onRejected;if(a===null)return(r._state?i.resolve:i.reject)(r._value);++i.psd.ref,++Ct,dn(Ou,[a,r,i])}else r._listeners.push(i)}function Ou(r,i,a){try{var c,d=i._value;!i._state&&Ln.length&&(Ln=[]),c=Ze&&i._consoleTask?i._consoleTask.run(function(){return r(d)}):r(d),i._state||Ln.indexOf(d)!==-1||function(p){for(var m=Pt.length;m;)if(Pt[--m]._value===p._value)return Pt.splice(m,1)}(i),a.resolve(c)}catch(p){a.reject(p)}finally{--Ct==0&&Jr(),--a.psd.ref||a.psd.finalize()}}function Iu(){jt(vt,function(){Lt()&&$t()})}function Lt(){var r=Vr;return Nn=Vr=!1,r}function $t(){var r,i,a;do for(;0<hn.length;)for(r=hn,hn=[],a=r.length,i=0;i<a;++i){var c=r[i];c[0].apply(null,c[1])}while(0<hn.length);Nn=Vr=!0}function Jr(){var r=Pt;Pt=[],r.forEach(function(c){c._PSD.onunhandled.call(null,c._value,c)});for(var i=$n.slice(0),a=i.length;a;)i[--a]()}function Mn(r){return new H(ln,!1,r)}function xe(r,i){var a=X;return function(){var c=Lt(),d=X;try{return gt(a,!0),r.apply(this,arguments)}catch(p){i&&i(p)}finally{gt(d,!1),c&&$t()}}}b(H.prototype,{then:Hr,_then:function(r,i){Yr(this,new Si(null,null,r,i,X))},catch:function(r){if(arguments.length===1)return this.then(null,r);var i=r,a=arguments[1];return typeof i=="function"?this.then(null,function(c){return(c instanceof i?a:Mn)(c)}):this.then(null,function(c){return(c&&c.name===i?a:Mn)(c)})},finally:function(r){return this.then(function(i){return H.resolve(r()).then(function(){return i})},function(i){return H.resolve(r()).then(function(){return Mn(i)})})},timeout:function(r,i){var a=this;return r<1/0?new H(function(c,d){var p=setTimeout(function(){return d(new ne.Timeout(i))},r);a.then(c,d).finally(clearTimeout.bind(null,p))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&j(H.prototype,Symbol.toStringTag,"Dexie.Promise"),vt.env=Oi(),b(H,{all:function(){var r=ke.apply(null,arguments).map(Vn);return new H(function(i,a){r.length===0&&i([]);var c=r.length;r.forEach(function(d,p){return H.resolve(d).then(function(m){r[p]=m,--c||i(r)},a)})})},resolve:function(r){return r instanceof H?r:r&&typeof r.then=="function"?new H(function(i,a){r.then(i,a)}):new H(ln,!0,r)},reject:Mn,race:function(){var r=ke.apply(null,arguments).map(Vn);return new H(function(i,a){r.map(function(c){return H.resolve(c).then(i,a)})})},PSD:{get:function(){return X},set:function(r){return X=r}},totalEchoes:{get:function(){return Wn}},newPSD:mt,usePSD:jt,scheduler:{get:function(){return dn},set:function(r){dn=r}},rejectionMapper:{get:function(){return zr},set:function(r){zr=r}},follow:function(r,i){return new H(function(a,c){return mt(function(d,p){var m=X;m.unhandleds=[],m.onunhandled=p,m.finalize=Ot(function(){var _,x=this;_=function(){x.unhandleds.length===0?d():p(x.unhandleds[0])},$n.push(function E(){_(),$n.splice($n.indexOf(E),1)}),++Ct,dn(function(){--Ct==0&&Jr()},[])},m.finalize),r()},i,a,c)})}}),At&&(At.allSettled&&j(H,"allSettled",function(){var r=ke.apply(null,arguments).map(Vn);return new H(function(i){r.length===0&&i([]);var a=r.length,c=new Array(a);r.forEach(function(d,p){return H.resolve(d).then(function(m){return c[p]={status:"fulfilled",value:m}},function(m){return c[p]={status:"rejected",reason:m}}).then(function(){return--a||i(c)})})})}),At.any&&typeof AggregateError<"u"&&j(H,"any",function(){var r=ke.apply(null,arguments).map(Vn);return new H(function(i,a){r.length===0&&a(new AggregateError([]));var c=r.length,d=new Array(c);r.forEach(function(p,m){return H.resolve(p).then(function(_){return i(_)},function(_){d[m]=_,--c||a(new AggregateError(d))})})})}),At.withResolvers&&(H.withResolvers=At.withResolvers));var Re={awaits:0,echoes:0,id:0},Au=0,qn=[],Fn=0,Wn=0,Pu=0;function mt(r,i,a,c){var d=X,p=Object.create(d);return p.parent=d,p.ref=0,p.global=!1,p.id=++Pu,vt.env,p.env=Wr?{Promise:H,PromiseProp:{value:H,configurable:!0,writable:!0},all:H.all,race:H.race,allSettled:H.allSettled,any:H.any,resolve:H.resolve,reject:H.reject}:{},i&&y(p,i),++d.ref,p.finalize=function(){--this.parent.ref||this.parent.finalize()},c=jt(p,r,a,c),p.ref===0&&p.finalize(),c}function Mt(){return Re.id||(Re.id=++Au),++Re.awaits,Re.echoes+=xi,Re.id}function bt(){return!!Re.awaits&&(--Re.awaits==0&&(Re.id=0),Re.echoes=Re.awaits*xi,!0)}function Vn(r){return Re.echoes&&r&&r.constructor===At?(Mt(),r.then(function(i){return bt(),i},function(i){return bt(),Ie(i)})):r}function Cu(){var r=qn[qn.length-1];qn.pop(),gt(r,!1)}function gt(r,i){var a,c=X;(i?!Re.echoes||Fn++&&r===X:!Fn||--Fn&&r===X)||queueMicrotask(i?(function(d){++Wn,Re.echoes&&--Re.echoes!=0||(Re.echoes=Re.awaits=Re.id=0),qn.push(X),gt(d,!0)}).bind(null,r):Cu),r!==X&&(X=r,c===vt&&(vt.env=Oi()),Wr&&(a=vt.env.Promise,i=r.env,(c.global||r.global)&&(Object.defineProperty(u,"Promise",i.PromiseProp),a.all=i.all,a.race=i.race,a.resolve=i.resolve,a.reject=i.reject,i.allSettled&&(a.allSettled=i.allSettled),i.any&&(a.any=i.any))))}function Oi(){var r=u.Promise;return Wr?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(u,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject}:{}}function jt(r,i,a,c,d){var p=X;try{return gt(r,!0),i(a,c,d)}finally{gt(p,!1)}}function Ii(r,i,a,c){return typeof r!="function"?r:function(){var d=X;a&&Mt(),gt(i,!0);try{return r.apply(this,arguments)}finally{gt(d,!1),c&&queueMicrotask(bt)}}}function Qr(r){Promise===At&&Re.echoes===0?Fn===0?r():enqueueNativeMicroTask(r):setTimeout(r,0)}(""+Je).indexOf("[native code]")===-1&&(Mt=bt=me);var Ie=H.reject,Tt="ï¿¿",ut="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ai="String expected.",qt=[],zn="__dbnames",Xr="readonly",Zr="readwrite";function Dt(r,i){return r?i?function(){return r.apply(this,arguments)&&i.apply(this,arguments)}:r:i}var Pi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Hn(r){return typeof r!="string"||/\./.test(r)?function(i){return i}:function(i){return i[r]===void 0&&r in i&&delete(i=Y(i))[r],i}}function Ci(){throw ne.Type()}function he(r,i){try{var a=ji(r),c=ji(i);if(a!==c)return a==="Array"?1:c==="Array"?-1:a==="binary"?1:c==="binary"?-1:a==="string"?1:c==="string"?-1:a==="Date"?1:c!=="Date"?NaN:-1;switch(a){case"number":case"Date":case"string":return i<r?1:r<i?-1:0;case"binary":return function(d,p){for(var m=d.length,_=p.length,x=m<_?m:_,E=0;E<x;++E)if(d[E]!==p[E])return d[E]<p[E]?-1:1;return m===_?0:m<_?-1:1}(Ti(r),Ti(i));case"Array":return function(d,p){for(var m=d.length,_=p.length,x=m<_?m:_,E=0;E<x;++E){var A=he(d[E],p[E]);if(A!==0)return A}return m===_?0:m<_?-1:1}(r,i)}}catch{}return NaN}function ji(r){var i=typeof r;return i!="object"?i:ArrayBuffer.isView(r)?"binary":(r=re(r),r==="ArrayBuffer"?"binary":r)}function Ti(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}var Di=(we.prototype._trans=function(r,i,a){var c=this._tx||X.trans,d=this.name,p=Ze&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(r==="readonly"?"read":"write"," ").concat(this.name));function m(E,A,k){if(!k.schema[d])throw new ne.NotFound("Table "+d+" not part of transaction");return i(k.idbtrans,k)}var _=Lt();try{var x=c&&c.db._novip===this.db._novip?c===X.trans?c._promise(r,m,a):mt(function(){return c._promise(r,m,a)},{trans:c,transless:X.transless||X}):function E(A,k,C,S){if(A.idbdb&&(A._state.openComplete||X.letThrough||A._vip)){var I=A._createTransaction(k,C,A._dbSchema);try{I.create(),A._state.PR1398_maxLoop=3}catch(P){return P.name===qr.InvalidState&&A.isOpen()&&0<--A._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),A.close({disableAutoOpen:!1}),A.open().then(function(){return E(A,k,C,S)})):Ie(P)}return I._promise(k,function(P,O){return mt(function(){return X.trans=I,S(P,O,I)})}).then(function(P){if(k==="readwrite")try{I.idbtrans.commit()}catch{}return k==="readonly"?P:I._completion.then(function(){return P})})}if(A._state.openComplete)return Ie(new ne.DatabaseClosed(A._state.dbOpenError));if(!A._state.isBeingOpened){if(!A._state.autoOpen)return Ie(new ne.DatabaseClosed);A.open().catch(me)}return A._state.dbReadyPromise.then(function(){return E(A,k,C,S)})}(this.db,r,[this.name],m);return p&&(x._consoleTask=p,x=x.catch(function(E){return console.trace(E),Ie(E)})),x}finally{_&&$t()}},we.prototype.get=function(r,i){var a=this;return r&&r.constructor===Object?this.where(r).first(i):r==null?Ie(new ne.Type("Invalid argument to Table.get()")):this._trans("readonly",function(c){return a.core.get({trans:c,key:r}).then(function(d){return a.hook.reading.fire(d)})}).then(i)},we.prototype.where=function(r){if(typeof r=="string")return new this.db.WhereClause(this,r);if(h(r))return new this.db.WhereClause(this,"[".concat(r.join("+"),"]"));var i=f(r);if(i.length===1)return this.where(i[0]).equals(r[i[0]]);var a=this.schema.indexes.concat(this.schema.primKey).filter(function(_){if(_.compound&&i.every(function(E){return 0<=_.keyPath.indexOf(E)})){for(var x=0;x<i.length;++x)if(i.indexOf(_.keyPath[x])===-1)return!1;return!0}return!1}).sort(function(_,x){return _.keyPath.length-x.keyPath.length})[0];if(a&&this.db._maxKey!==Tt){var p=a.keyPath.slice(0,i.length);return this.where(p).equals(p.map(function(x){return r[x]}))}!a&&Ze&&console.warn("The query ".concat(JSON.stringify(r)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var c=this.schema.idxByName;function d(_,x){return he(_,x)===0}var m=i.reduce(function(k,x){var E=k[0],A=k[1],k=c[x],C=r[x];return[E||k,E||!k?Dt(A,k&&k.multi?function(S){return S=te(S,x),h(S)&&S.some(function(I){return d(C,I)})}:function(S){return d(C,te(S,x))}):A]},[null,null]),p=m[0],m=m[1];return p?this.where(p.name).equals(r[p.keyPath]).filter(m):a?this.filter(m):this.where(i).equals("")},we.prototype.filter=function(r){return this.toCollection().and(r)},we.prototype.count=function(r){return this.toCollection().count(r)},we.prototype.offset=function(r){return this.toCollection().offset(r)},we.prototype.limit=function(r){return this.toCollection().limit(r)},we.prototype.each=function(r){return this.toCollection().each(r)},we.prototype.toArray=function(r){return this.toCollection().toArray(r)},we.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},we.prototype.orderBy=function(r){return new this.db.Collection(new this.db.WhereClause(this,h(r)?"[".concat(r.join("+"),"]"):r))},we.prototype.reverse=function(){return this.toCollection().reverse()},we.prototype.mapToClass=function(r){var i,a=this.db,c=this.name;function d(){return i!==null&&i.apply(this,arguments)||this}(this.schema.mappedClass=r).prototype instanceof Ci&&(function(x,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");function A(){this.constructor=x}n(x,E),x.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}(d,i=r),Object.defineProperty(d.prototype,"db",{get:function(){return a},enumerable:!1,configurable:!0}),d.prototype.table=function(){return c},r=d);for(var p=new Set,m=r.prototype;m;m=v(m))Object.getOwnPropertyNames(m).forEach(function(x){return p.add(x)});function _(x){if(!x)return x;var E,A=Object.create(r.prototype);for(E in x)if(!p.has(E))try{A[E]=x[E]}catch{}return A}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=_,this.hook("reading",_),r},we.prototype.defineClass=function(){return this.mapToClass(function(r){y(this,r)})},we.prototype.add=function(r,i){var a=this,c=this.schema.primKey,d=c.auto,p=c.keyPath,m=r;return p&&d&&(m=Hn(p)(r)),this._trans("readwrite",function(_){return a.core.mutate({trans:_,type:"add",keys:i!=null?[i]:null,values:[m]})}).then(function(_){return _.numFailures?H.reject(_.failures[0]):_.lastResult}).then(function(_){if(p)try{pe(r,p,_)}catch{}return _})},we.prototype.update=function(r,i){return typeof r!="object"||h(r)?this.where(":id").equals(r).modify(i):(r=te(r,this.schema.primKey.keyPath),r===void 0?Ie(new ne.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(i))},we.prototype.put=function(r,i){var a=this,c=this.schema.primKey,d=c.auto,p=c.keyPath,m=r;return p&&d&&(m=Hn(p)(r)),this._trans("readwrite",function(_){return a.core.mutate({trans:_,type:"put",values:[m],keys:i!=null?[i]:null})}).then(function(_){return _.numFailures?H.reject(_.failures[0]):_.lastResult}).then(function(_){if(p)try{pe(r,p,_)}catch{}return _})},we.prototype.delete=function(r){var i=this;return this._trans("readwrite",function(a){return i.core.mutate({trans:a,type:"delete",keys:[r]})}).then(function(a){return a.numFailures?H.reject(a.failures[0]):void 0})},we.prototype.clear=function(){var r=this;return this._trans("readwrite",function(i){return r.core.mutate({trans:i,type:"deleteRange",range:Pi})}).then(function(i){return i.numFailures?H.reject(i.failures[0]):void 0})},we.prototype.bulkGet=function(r){var i=this;return this._trans("readonly",function(a){return i.core.getMany({keys:r,trans:a}).then(function(c){return c.map(function(d){return i.hook.reading.fire(d)})})})},we.prototype.bulkAdd=function(r,i,a){var c=this,d=Array.isArray(i)?i:void 0,p=(a=a||(d?void 0:i))?a.allKeys:void 0;return this._trans("readwrite",function(m){var E=c.schema.primKey,_=E.auto,E=E.keyPath;if(E&&d)throw new ne.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(d&&d.length!==r.length)throw new ne.InvalidArgument("Arguments objects and keys must have the same length");var x=r.length,E=E&&_?r.map(Hn(E)):r;return c.core.mutate({trans:m,type:"add",keys:d,values:E,wantResults:p}).then(function(I){var k=I.numFailures,C=I.results,S=I.lastResult,I=I.failures;if(k===0)return p?C:S;throw new at("".concat(c.name,".bulkAdd(): ").concat(k," of ").concat(x," operations failed"),I)})})},we.prototype.bulkPut=function(r,i,a){var c=this,d=Array.isArray(i)?i:void 0,p=(a=a||(d?void 0:i))?a.allKeys:void 0;return this._trans("readwrite",function(m){var E=c.schema.primKey,_=E.auto,E=E.keyPath;if(E&&d)throw new ne.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(d&&d.length!==r.length)throw new ne.InvalidArgument("Arguments objects and keys must have the same length");var x=r.length,E=E&&_?r.map(Hn(E)):r;return c.core.mutate({trans:m,type:"put",keys:d,values:E,wantResults:p}).then(function(I){var k=I.numFailures,C=I.results,S=I.lastResult,I=I.failures;if(k===0)return p?C:S;throw new at("".concat(c.name,".bulkPut(): ").concat(k," of ").concat(x," operations failed"),I)})})},we.prototype.bulkUpdate=function(r){var i=this,a=this.core,c=r.map(function(m){return m.key}),d=r.map(function(m){return m.changes}),p=[];return this._trans("readwrite",function(m){return a.getMany({trans:m,keys:c,cache:"clone"}).then(function(_){var x=[],E=[];r.forEach(function(k,C){var S=k.key,I=k.changes,P=_[C];if(P){for(var O=0,T=Object.keys(I);O<T.length;O++){var D=T[O],R=I[D];if(D===i.schema.primKey.keyPath){if(he(R,S)!==0)throw new ne.Constraint("Cannot update primary key in bulkUpdate()")}else pe(P,D,R)}p.push(C),x.push(S),E.push(P)}});var A=x.length;return a.mutate({trans:m,type:"put",keys:x,values:E,updates:{keys:c,changeSpecs:d}}).then(function(k){var C=k.numFailures,S=k.failures;if(C===0)return A;for(var I=0,P=Object.keys(S);I<P.length;I++){var O,T=P[I],D=p[Number(T)];D!=null&&(O=S[T],delete S[T],S[D]=O)}throw new at("".concat(i.name,".bulkUpdate(): ").concat(C," of ").concat(A," operations failed"),S)})})})},we.prototype.bulkDelete=function(r){var i=this,a=r.length;return this._trans("readwrite",function(c){return i.core.mutate({trans:c,type:"delete",keys:r})}).then(function(m){var d=m.numFailures,p=m.lastResult,m=m.failures;if(d===0)return p;throw new at("".concat(i.name,".bulkDelete(): ").concat(d," of ").concat(a," operations failed"),m)})},we);function we(){}function pn(r){function i(m,_){if(_){for(var x=arguments.length,E=new Array(x-1);--x;)E[x-1]=arguments[x];return a[m].subscribe.apply(null,E),r}if(typeof m=="string")return a[m]}var a={};i.addEventType=p;for(var c=1,d=arguments.length;c<d;++c)p(arguments[c]);return i;function p(m,_,x){if(typeof m!="object"){var E;_=_||Eu;var A={subscribers:[],fire:x=x||me,subscribe:function(k){A.subscribers.indexOf(k)===-1&&(A.subscribers.push(k),A.fire=_(A.fire,k))},unsubscribe:function(k){A.subscribers=A.subscribers.filter(function(C){return C!==k}),A.fire=A.subscribers.reduce(_,x)}};return a[m]=i[m]=A}f(E=m).forEach(function(k){var C=E[k];if(h(C))p(k,E[k][0],E[k][1]);else{if(C!=="asap")throw new ne.InvalidArgument("Invalid event config");var S=p(k,cn,function(){for(var I=arguments.length,P=new Array(I);I--;)P[I]=arguments[I];S.subscribers.forEach(function(O){ce(function(){O.apply(null,P)})})})}})}}function yn(r,i){return K(i).from({prototype:r}),i}function Ft(r,i){return!(r.filter||r.algorithm||r.or)&&(i?r.justLimit:!r.replayFilter)}function eo(r,i){r.filter=Dt(r.filter,i)}function to(r,i,a){var c=r.replayFilter;r.replayFilter=c?function(){return Dt(c(),i())}:i,r.justLimit=a&&!c}function Gn(r,i){if(r.isPrimKey)return i.primaryKey;var a=i.getIndexByKeyPath(r.index);if(!a)throw new ne.Schema("KeyPath "+r.index+" on object store "+i.name+" is not indexed");return a}function Ri(r,i,a){var c=Gn(r,i.schema);return i.openCursor({trans:a,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:c,range:r.range}})}function Yn(r,i,a,c){var d=r.replayFilter?Dt(r.filter,r.replayFilter()):r.filter;if(r.or){var p={},m=function(_,x,E){var A,k;d&&!d(x,E,function(C){return x.stop(C)},function(C){return x.fail(C)})||((k=""+(A=x.primaryKey))=="[object ArrayBuffer]"&&(k=""+new Uint8Array(A)),g(p,k)||(p[k]=!0,i(_,x,E)))};return Promise.all([r.or._iterate(m,a),Ki(Ri(r,c,a),r.algorithm,m,!r.keysOnly&&r.valueMapper)])}return Ki(Ri(r,c,a),Dt(r.algorithm,d),i,!r.keysOnly&&r.valueMapper)}function Ki(r,i,a,c){var d=xe(c?function(p,m,_){return a(c(p),m,_)}:a);return r.then(function(p){if(p)return p.start(function(){var m=function(){return p.continue()};i&&!i(p,function(_){return m=_},function(_){p.stop(_),m=me},function(_){p.fail(_),m=me})||d(p.value,p,function(_){return m=_}),m()})})}var vn=(Ui.prototype.execute=function(r){var i=this["@@propmod"];if(i.add!==void 0){var a=i.add;if(h(a))return s(s([],h(r)?r:[],!0),a).sort();if(typeof a=="number")return(Number(r)||0)+a;if(typeof a=="bigint")try{return BigInt(r)+a}catch{return BigInt(0)+a}throw new TypeError("Invalid term ".concat(a))}if(i.remove!==void 0){var c=i.remove;if(h(c))return h(r)?r.filter(function(d){return!c.includes(d)}).sort():[];if(typeof c=="number")return Number(r)-c;if(typeof c=="bigint")try{return BigInt(r)-c}catch{return BigInt(0)-c}throw new TypeError("Invalid subtrahend ".concat(c))}return a=(a=i.replacePrefix)===null||a===void 0?void 0:a[0],a&&typeof r=="string"&&r.startsWith(a)?i.replacePrefix[1]+r.substring(a.length):r},Ui);function Ui(r){this["@@propmod"]=r}var ju=(ye.prototype._read=function(r,i){var a=this._ctx;return a.error?a.table._trans(null,Ie.bind(null,a.error)):a.table._trans("readonly",r).then(i)},ye.prototype._write=function(r){var i=this._ctx;return i.error?i.table._trans(null,Ie.bind(null,i.error)):i.table._trans("readwrite",r,"locked")},ye.prototype._addAlgorithm=function(r){var i=this._ctx;i.algorithm=Dt(i.algorithm,r)},ye.prototype._iterate=function(r,i){return Yn(this._ctx,r,i,this._ctx.table.core)},ye.prototype.clone=function(r){var i=Object.create(this.constructor.prototype),a=Object.create(this._ctx);return r&&y(a,r),i._ctx=a,i},ye.prototype.raw=function(){return this._ctx.valueMapper=null,this},ye.prototype.each=function(r){var i=this._ctx;return this._read(function(a){return Yn(i,r,a,i.table.core)})},ye.prototype.count=function(r){var i=this;return this._read(function(a){var c=i._ctx,d=c.table.core;if(Ft(c,!0))return d.count({trans:a,query:{index:Gn(c,d.schema),range:c.range}}).then(function(m){return Math.min(m,c.limit)});var p=0;return Yn(c,function(){return++p,!1},a,d).then(function(){return p})}).then(r)},ye.prototype.sortBy=function(r,i){var a=r.split(".").reverse(),c=a[0],d=a.length-1;function p(x,E){return E?p(x[a[E]],E-1):x[c]}var m=this._ctx.dir==="next"?1:-1;function _(x,E){return he(p(x,d),p(E,d))*m}return this.toArray(function(x){return x.sort(_)}).then(i)},ye.prototype.toArray=function(r){var i=this;return this._read(function(a){var c=i._ctx;if(c.dir==="next"&&Ft(c,!0)&&0<c.limit){var d=c.valueMapper,p=Gn(c,c.table.core.schema);return c.table.core.query({trans:a,limit:c.limit,values:!0,query:{index:p,range:c.range}}).then(function(_){return _=_.result,d?_.map(d):_})}var m=[];return Yn(c,function(_){return m.push(_)},a,c.table.core).then(function(){return m})},r)},ye.prototype.offset=function(r){var i=this._ctx;return r<=0||(i.offset+=r,Ft(i)?to(i,function(){var a=r;return function(c,d){return a===0||(a===1?--a:d(function(){c.advance(a),a=0}),!1)}}):to(i,function(){var a=r;return function(){return--a<0}})),this},ye.prototype.limit=function(r){return this._ctx.limit=Math.min(this._ctx.limit,r),to(this._ctx,function(){var i=r;return function(a,c,d){return--i<=0&&c(d),0<=i}},!0),this},ye.prototype.until=function(r,i){return eo(this._ctx,function(a,c,d){return!r(a.value)||(c(d),i)}),this},ye.prototype.first=function(r){return this.limit(1).toArray(function(i){return i[0]}).then(r)},ye.prototype.last=function(r){return this.reverse().first(r)},ye.prototype.filter=function(r){var i;return eo(this._ctx,function(a){return r(a.value)}),(i=this._ctx).isMatch=Dt(i.isMatch,r),this},ye.prototype.and=function(r){return this.filter(r)},ye.prototype.or=function(r){return new this.db.WhereClause(this._ctx.table,r,this)},ye.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ye.prototype.desc=function(){return this.reverse()},ye.prototype.eachKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(a,c){r(c.key,c)})},ye.prototype.eachUniqueKey=function(r){return this._ctx.unique="unique",this.eachKey(r)},ye.prototype.eachPrimaryKey=function(r){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(a,c){r(c.primaryKey,c)})},ye.prototype.keys=function(r){var i=this._ctx;i.keysOnly=!i.isMatch;var a=[];return this.each(function(c,d){a.push(d.key)}).then(function(){return a}).then(r)},ye.prototype.primaryKeys=function(r){var i=this._ctx;if(i.dir==="next"&&Ft(i,!0)&&0<i.limit)return this._read(function(c){var d=Gn(i,i.table.core.schema);return i.table.core.query({trans:c,values:!1,limit:i.limit,query:{index:d,range:i.range}})}).then(function(c){return c.result}).then(r);i.keysOnly=!i.isMatch;var a=[];return this.each(function(c,d){a.push(d.primaryKey)}).then(function(){return a}).then(r)},ye.prototype.uniqueKeys=function(r){return this._ctx.unique="unique",this.keys(r)},ye.prototype.firstKey=function(r){return this.limit(1).keys(function(i){return i[0]}).then(r)},ye.prototype.lastKey=function(r){return this.reverse().firstKey(r)},ye.prototype.distinct=function(){var r=this._ctx,r=r.index&&r.table.schema.idxByName[r.index];if(!r||!r.multi)return this;var i={};return eo(this._ctx,function(d){var c=d.primaryKey.toString(),d=g(i,c);return i[c]=!0,!d}),this},ye.prototype.modify=function(r){var i=this,a=this._ctx;return this._write(function(c){var d,p,m;m=typeof r=="function"?r:(d=f(r),p=d.length,function(O){for(var T=!1,D=0;D<p;++D){var R=d[D],U=r[R],L=te(O,R);U instanceof vn?(pe(O,R,U.execute(L)),T=!0):L!==U&&(pe(O,R,U),T=!0)}return T});var _=a.table.core,k=_.schema.primaryKey,x=k.outbound,E=k.extractKey,A=200,k=i.db._options.modifyChunkSize;k&&(A=typeof k=="object"?k[_.name]||k["*"]||200:k);function C(O,R){var D=R.failures,R=R.numFailures;I+=O-R;for(var U=0,L=f(D);U<L.length;U++){var W=L[U];S.push(D[W])}}var S=[],I=0,P=[];return i.clone().primaryKeys().then(function(O){function T(R){var U=Math.min(A,O.length-R);return _.getMany({trans:c,keys:O.slice(R,R+U),cache:"immutable"}).then(function(L){for(var W=[],$=[],M=x?[]:null,V=[],F=0;F<U;++F){var J=L[F],se={value:Y(J),primKey:O[R+F]};m.call(se,se.value,se)!==!1&&(se.value==null?V.push(O[R+F]):x||he(E(J),E(se.value))===0?($.push(se.value),x&&M.push(O[R+F])):(V.push(O[R+F]),W.push(se.value)))}return Promise.resolve(0<W.length&&_.mutate({trans:c,type:"add",values:W}).then(function(le){for(var fe in le.failures)V.splice(parseInt(fe),1);C(W.length,le)})).then(function(){return(0<$.length||D&&typeof r=="object")&&_.mutate({trans:c,type:"put",keys:M,values:$,criteria:D,changeSpec:typeof r!="function"&&r,isAdditionalChunk:0<R}).then(function(le){return C($.length,le)})}).then(function(){return(0<V.length||D&&r===no)&&_.mutate({trans:c,type:"delete",keys:V,criteria:D,isAdditionalChunk:0<R}).then(function(le){return C(V.length,le)})}).then(function(){return O.length>R+U&&T(R+A)})})}var D=Ft(a)&&a.limit===1/0&&(typeof r!="function"||r===no)&&{index:a.index,range:a.range};return T(0).then(function(){if(0<S.length)throw new De("Error modifying one or more objects",S,I,P);return O.length})})})},ye.prototype.delete=function(){var r=this._ctx,i=r.range;return Ft(r)&&(r.isPrimKey||i.type===3)?this._write(function(a){var c=r.table.core.schema.primaryKey,d=i;return r.table.core.count({trans:a,query:{index:c,range:d}}).then(function(p){return r.table.core.mutate({trans:a,type:"deleteRange",range:d}).then(function(m){var _=m.failures;if(m.lastResult,m.results,m=m.numFailures,m)throw new De("Could not delete some values",Object.keys(_).map(function(x){return _[x]}),p-m);return p-m})})}):this.modify(no)},ye);function ye(){}var no=function(r,i){return i.value=null};function Tu(r,i){return r<i?-1:r===i?0:1}function Du(r,i){return i<r?-1:r===i?0:1}function Ve(r,i,a){return r=r instanceof Ni?new r.Collection(r):r,r._ctx.error=new(a||TypeError)(i),r}function Wt(r){return new r.Collection(r,function(){return Bi("")}).limit(0)}function Jn(r,i,a,c){var d,p,m,_,x,E,A,k=a.length;if(!a.every(function(I){return typeof I=="string"}))return Ve(r,Ai);function C(I){d=I==="next"?function(O){return O.toUpperCase()}:function(O){return O.toLowerCase()},p=I==="next"?function(O){return O.toLowerCase()}:function(O){return O.toUpperCase()},m=I==="next"?Tu:Du;var P=a.map(function(O){return{lower:p(O),upper:d(O)}}).sort(function(O,T){return m(O.lower,T.lower)});_=P.map(function(O){return O.upper}),x=P.map(function(O){return O.lower}),A=(E=I)==="next"?"":c}C("next"),r=new r.Collection(r,function(){return _t(_[0],x[k-1]+c)}),r._ondirectionchange=function(I){C(I)};var S=0;return r._addAlgorithm(function(I,P,O){var T=I.key;if(typeof T!="string")return!1;var D=p(T);if(i(D,x,S))return!0;for(var R=null,U=S;U<k;++U){var L=function(W,$,M,V,F,J){for(var se=Math.min(W.length,V.length),le=-1,fe=0;fe<se;++fe){var ze=$[fe];if(ze!==V[fe])return F(W[fe],M[fe])<0?W.substr(0,fe)+M[fe]+M.substr(fe+1):F(W[fe],V[fe])<0?W.substr(0,fe)+V[fe]+M.substr(fe+1):0<=le?W.substr(0,le)+$[le]+M.substr(le+1):null;F(W[fe],ze)<0&&(le=fe)}return se<V.length&&J==="next"?W+M.substr(W.length):se<W.length&&J==="prev"?W.substr(0,M.length):le<0?null:W.substr(0,le)+V[le]+M.substr(le+1)}(T,D,_[U],x[U],m,E);L===null&&R===null?S=U+1:(R===null||0<m(R,L))&&(R=L)}return P(R!==null?function(){I.continue(R+A)}:O),!1}),r}function _t(r,i,a,c){return{type:2,lower:r,upper:i,lowerOpen:a,upperOpen:c}}function Bi(r){return{type:1,lower:r,upper:r}}var Ni=(Object.defineProperty(Ke.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ke.prototype.between=function(r,i,a,c){a=a!==!1,c=c===!0;try{return 0<this._cmp(r,i)||this._cmp(r,i)===0&&(a||c)&&(!a||!c)?Wt(this):new this.Collection(this,function(){return _t(r,i,!a,!c)})}catch{return Ve(this,ut)}},Ke.prototype.equals=function(r){return r==null?Ve(this,ut):new this.Collection(this,function(){return Bi(r)})},Ke.prototype.above=function(r){return r==null?Ve(this,ut):new this.Collection(this,function(){return _t(r,void 0,!0)})},Ke.prototype.aboveOrEqual=function(r){return r==null?Ve(this,ut):new this.Collection(this,function(){return _t(r,void 0,!1)})},Ke.prototype.below=function(r){return r==null?Ve(this,ut):new this.Collection(this,function(){return _t(void 0,r,!1,!0)})},Ke.prototype.belowOrEqual=function(r){return r==null?Ve(this,ut):new this.Collection(this,function(){return _t(void 0,r)})},Ke.prototype.startsWith=function(r){return typeof r!="string"?Ve(this,Ai):this.between(r,r+Tt,!0,!0)},Ke.prototype.startsWithIgnoreCase=function(r){return r===""?this.startsWith(r):Jn(this,function(i,a){return i.indexOf(a[0])===0},[r],Tt)},Ke.prototype.equalsIgnoreCase=function(r){return Jn(this,function(i,a){return i===a[0]},[r],"")},Ke.prototype.anyOfIgnoreCase=function(){var r=ke.apply(_e,arguments);return r.length===0?Wt(this):Jn(this,function(i,a){return a.indexOf(i)!==-1},r,"")},Ke.prototype.startsWithAnyOfIgnoreCase=function(){var r=ke.apply(_e,arguments);return r.length===0?Wt(this):Jn(this,function(i,a){return a.some(function(c){return i.indexOf(c)===0})},r,Tt)},Ke.prototype.anyOf=function(){var r=this,i=ke.apply(_e,arguments),a=this._cmp;try{i.sort(a)}catch{return Ve(this,ut)}if(i.length===0)return Wt(this);var c=new this.Collection(this,function(){return _t(i[0],i[i.length-1])});c._ondirectionchange=function(p){a=p==="next"?r._ascending:r._descending,i.sort(a)};var d=0;return c._addAlgorithm(function(p,m,_){for(var x=p.key;0<a(x,i[d]);)if(++d===i.length)return m(_),!1;return a(x,i[d])===0||(m(function(){p.continue(i[d])}),!1)}),c},Ke.prototype.notEqual=function(r){return this.inAnyRange([[-1/0,r],[r,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ke.prototype.noneOf=function(){var r=ke.apply(_e,arguments);if(r.length===0)return new this.Collection(this);try{r.sort(this._ascending)}catch{return Ve(this,ut)}var i=r.reduce(function(a,c){return a?a.concat([[a[a.length-1][1],c]]):[[-1/0,c]]},null);return i.push([r[r.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},Ke.prototype.inAnyRange=function(T,i){var a=this,c=this._cmp,d=this._ascending,p=this._descending,m=this._min,_=this._max;if(T.length===0)return Wt(this);if(!T.every(function(D){return D[0]!==void 0&&D[1]!==void 0&&d(D[0],D[1])<=0}))return Ve(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ne.InvalidArgument);var x=!i||i.includeLowers!==!1,E=i&&i.includeUppers===!0,A,k=d;function C(D,R){return k(D[0],R[0])}try{(A=T.reduce(function(D,R){for(var U=0,L=D.length;U<L;++U){var W=D[U];if(c(R[0],W[1])<0&&0<c(R[1],W[0])){W[0]=m(W[0],R[0]),W[1]=_(W[1],R[1]);break}}return U===L&&D.push(R),D},[])).sort(C)}catch{return Ve(this,ut)}var S=0,I=E?function(D){return 0<d(D,A[S][1])}:function(D){return 0<=d(D,A[S][1])},P=x?function(D){return 0<p(D,A[S][0])}:function(D){return 0<=p(D,A[S][0])},O=I,T=new this.Collection(this,function(){return _t(A[0][0],A[A.length-1][1],!x,!E)});return T._ondirectionchange=function(D){k=D==="next"?(O=I,d):(O=P,p),A.sort(C)},T._addAlgorithm(function(D,R,U){for(var L,W=D.key;O(W);)if(++S===A.length)return R(U),!1;return!I(L=W)&&!P(L)||(a._cmp(W,A[S][1])===0||a._cmp(W,A[S][0])===0||R(function(){k===d?D.continue(A[S][0]):D.continue(A[S][1])}),!1)}),T},Ke.prototype.startsWithAnyOf=function(){var r=ke.apply(_e,arguments);return r.every(function(i){return typeof i=="string"})?r.length===0?Wt(this):this.inAnyRange(r.map(function(i){return[i,i+Tt]})):Ve(this,"startsWithAnyOf() only works with strings")},Ke);function Ke(){}function et(r){return xe(function(i){return mn(i),r(i.target.error),!1})}function mn(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}var bn="storagemutated",ro="x-storagemutated-1",wt=pn(null,bn),Ru=(tt.prototype._lock=function(){return Q(!X.global),++this._reculock,this._reculock!==1||X.global||(X.lockOwnerFor=this),this},tt.prototype._unlock=function(){if(Q(!X.global),--this._reculock==0)for(X.global||(X.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var r=this._blockedFuncs.shift();try{jt(r[1],r[0])}catch{}}return this},tt.prototype._locked=function(){return this._reculock&&X.lockOwnerFor!==this},tt.prototype.create=function(r){var i=this;if(!this.mode)return this;var a=this.db.idbdb,c=this.db._state.dbOpenError;if(Q(!this.idbtrans),!r&&!a)switch(c&&c.name){case"DatabaseClosedError":throw new ne.DatabaseClosed(c);case"MissingAPIError":throw new ne.MissingAPI(c.message,c);default:throw new ne.OpenFailed(c)}if(!this.active)throw new ne.TransactionInactive;return Q(this._completion._state===null),(r=this.idbtrans=r||(this.db.core||a).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=xe(function(d){mn(d),i._reject(r.error)}),r.onabort=xe(function(d){mn(d),i.active&&i._reject(new ne.Abort(r.error)),i.active=!1,i.on("abort").fire(d)}),r.oncomplete=xe(function(){i.active=!1,i._resolve(),"mutatedParts"in r&&wt.storagemutated.fire(r.mutatedParts)}),this},tt.prototype._promise=function(r,i,a){var c=this;if(r==="readwrite"&&this.mode!=="readwrite")return Ie(new ne.ReadOnly("Transaction is readonly"));if(!this.active)return Ie(new ne.TransactionInactive);if(this._locked())return new H(function(p,m){c._blockedFuncs.push([function(){c._promise(r,i,a).then(p,m)},X])});if(a)return mt(function(){var p=new H(function(m,_){c._lock();var x=i(m,_,c);x&&x.then&&x.then(m,_)});return p.finally(function(){return c._unlock()}),p._lib=!0,p});var d=new H(function(p,m){var _=i(p,m,c);_&&_.then&&_.then(p,m)});return d._lib=!0,d},tt.prototype._root=function(){return this.parent?this.parent._root():this},tt.prototype.waitFor=function(r){var i,a=this._root(),c=H.resolve(r);a._waitingFor?a._waitingFor=a._waitingFor.then(function(){return c}):(a._waitingFor=c,a._waitingQueue=[],i=a.idbtrans.objectStore(a.storeNames[0]),function p(){for(++a._spinCount;a._waitingQueue.length;)a._waitingQueue.shift()();a._waitingFor&&(i.get(-1/0).onsuccess=p)}());var d=a._waitingFor;return new H(function(p,m){c.then(function(_){return a._waitingQueue.push(xe(p.bind(null,_)))},function(_){return a._waitingQueue.push(xe(m.bind(null,_)))}).finally(function(){a._waitingFor===d&&(a._waitingFor=null)})})},tt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ne.Abort))},tt.prototype.table=function(r){var i=this._memoizedTables||(this._memoizedTables={});if(g(i,r))return i[r];var a=this.schema[r];if(!a)throw new ne.NotFound("Table "+r+" not part of transaction");return a=new this.db.Table(r,a,this),a.core=this.db.core.table(r),i[r]=a},tt);function tt(){}function oo(r,i,a,c,d,p,m){return{name:r,keyPath:i,unique:a,multi:c,auto:d,compound:p,src:(a&&!m?"&":"")+(c?"*":"")+(d?"++":"")+Li(i)}}function Li(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function io(r,i,a){return{name:r,primKey:i,indexes:a,mappedClass:null,idxByName:(c=function(d){return[d.name,d]},a.reduce(function(d,p,m){return m=c(p,m),m&&(d[m[0]]=m[1]),d},{}))};var c}var gn=function(r){try{return r.only([[]]),gn=function(){return[[]]},[[]]}catch{return gn=function(){return Tt},Tt}};function so(r){return r==null?function(){}:typeof r=="string"?(i=r).split(".").length===1?function(a){return a[i]}:function(a){return te(a,i)}:function(a){return te(a,r)};var i}function $i(r){return[].slice.call(r)}var Ku=0;function _n(r){return r==null?":id":typeof r=="string"?r:"[".concat(r.join("+"),"]")}function Uu(r,i,x){function c(O){if(O.type===3)return null;if(O.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var S=O.lower,I=O.upper,P=O.lowerOpen,O=O.upperOpen;return S===void 0?I===void 0?null:i.upperBound(I,!!O):I===void 0?i.lowerBound(S,!!P):i.bound(S,I,!!P,!!O)}function d(C){var S,I=C.name;return{name:I,schema:C,mutate:function(P){var O=P.trans,T=P.type,D=P.keys,R=P.values,U=P.range;return new Promise(function(L,W){L=xe(L);var $=O.objectStore(I),M=$.keyPath==null,V=T==="put"||T==="add";if(!V&&T!=="delete"&&T!=="deleteRange")throw new Error("Invalid operation type: "+T);var F,J=(D||R||{length:1}).length;if(D&&R&&D.length!==R.length)throw new Error("Given keys array must have same length as given values array.");if(J===0)return L({numFailures:0,failures:{},results:[],lastResult:void 0});function se(qe){++ze,mn(qe)}var le=[],fe=[],ze=0;if(T==="deleteRange"){if(U.type===4)return L({numFailures:ze,failures:fe,results:[],lastResult:void 0});U.type===3?le.push(F=$.clear()):le.push(F=$.delete(c(U)))}else{var M=V?M?[R,D]:[R,null]:[D,null],ie=M[0],Ne=M[1];if(V)for(var Le=0;Le<J;++Le)le.push(F=Ne&&Ne[Le]!==void 0?$[T](ie[Le],Ne[Le]):$[T](ie[Le])),F.onerror=se;else for(Le=0;Le<J;++Le)le.push(F=$[T](ie[Le])),F.onerror=se}function cr(qe){qe=qe.target.result,le.forEach(function(Ut,Eo){return Ut.error!=null&&(fe[Eo]=Ut.error)}),L({numFailures:ze,failures:fe,results:T==="delete"?D:le.map(function(Ut){return Ut.result}),lastResult:qe})}F.onerror=function(qe){se(qe),cr(qe)},F.onsuccess=cr})},getMany:function(P){var O=P.trans,T=P.keys;return new Promise(function(D,R){D=xe(D);for(var U,L=O.objectStore(I),W=T.length,$=new Array(W),M=0,V=0,F=function(le){le=le.target,$[le._pos]=le.result,++V===M&&D($)},J=et(R),se=0;se<W;++se)T[se]!=null&&((U=L.get(T[se]))._pos=se,U.onsuccess=F,U.onerror=J,++M);M===0&&D($)})},get:function(P){var O=P.trans,T=P.key;return new Promise(function(D,R){D=xe(D);var U=O.objectStore(I).get(T);U.onsuccess=function(L){return D(L.target.result)},U.onerror=et(R)})},query:(S=E,function(P){return new Promise(function(O,T){O=xe(O);var D,R,U,M=P.trans,L=P.values,W=P.limit,F=P.query,$=W===1/0?void 0:W,V=F.index,F=F.range,M=M.objectStore(I),V=V.isPrimaryKey?M:M.index(V.name),F=c(F);if(W===0)return O({result:[]});S?(($=L?V.getAll(F,$):V.getAllKeys(F,$)).onsuccess=function(J){return O({result:J.target.result})},$.onerror=et(T)):(D=0,R=!L&&"openKeyCursor"in V?V.openKeyCursor(F):V.openCursor(F),U=[],R.onsuccess=function(J){var se=R.result;return se?(U.push(L?se.value:se.primaryKey),++D===W?O({result:U}):void se.continue()):O({result:U})},R.onerror=et(T))})}),openCursor:function(P){var O=P.trans,T=P.values,D=P.query,R=P.reverse,U=P.unique;return new Promise(function(L,W){L=xe(L);var V=D.index,$=D.range,M=O.objectStore(I),M=V.isPrimaryKey?M:M.index(V.name),V=R?U?"prevunique":"prev":U?"nextunique":"next",F=!T&&"openKeyCursor"in M?M.openKeyCursor(c($),V):M.openCursor(c($),V);F.onerror=et(W),F.onsuccess=xe(function(J){var se,le,fe,ze,ie=F.result;ie?(ie.___id=++Ku,ie.done=!1,se=ie.continue.bind(ie),le=(le=ie.continuePrimaryKey)&&le.bind(ie),fe=ie.advance.bind(ie),ze=function(){throw new Error("Cursor not stopped")},ie.trans=O,ie.stop=ie.continue=ie.continuePrimaryKey=ie.advance=function(){throw new Error("Cursor not started")},ie.fail=xe(W),ie.next=function(){var Ne=this,Le=1;return this.start(function(){return Le--?Ne.continue():Ne.stop()}).then(function(){return Ne})},ie.start=function(Ne){function Le(){if(F.result)try{Ne()}catch(qe){ie.fail(qe)}else ie.done=!0,ie.start=function(){throw new Error("Cursor behind last entry")},ie.stop()}var cr=new Promise(function(qe,Ut){qe=xe(qe),F.onerror=et(Ut),ie.fail=Ut,ie.stop=function(Eo){ie.stop=ie.continue=ie.continuePrimaryKey=ie.advance=ze,qe(Eo)}});return F.onsuccess=xe(function(qe){F.onsuccess=Le,Le()}),ie.continue=se,ie.continuePrimaryKey=le,ie.advance=fe,Le(),cr},L(ie)):L(null)},W)})},count:function(P){var O=P.query,T=P.trans,D=O.index,R=O.range;return new Promise(function(U,L){var W=T.objectStore(I),$=D.isPrimaryKey?W:W.index(D.name),W=c(R),$=W?$.count(W):$.count();$.onsuccess=xe(function(M){return U(M.target.result)}),$.onerror=et(L)})}}}var p,m,_,A=(m=x,_=$i((p=r).objectStoreNames),{schema:{name:p.name,tables:_.map(function(C){return m.objectStore(C)}).map(function(C){var S=C.keyPath,O=C.autoIncrement,I=h(S),P={},O={name:C.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:S==null,compound:I,keyPath:S,autoIncrement:O,unique:!0,extractKey:so(S)},indexes:$i(C.indexNames).map(function(T){return C.index(T)}).map(function(U){var D=U.name,R=U.unique,L=U.multiEntry,U=U.keyPath,L={name:D,compound:h(U),keyPath:U,unique:R,multiEntry:L,extractKey:so(U)};return P[_n(U)]=L}),getIndexByKeyPath:function(T){return P[_n(T)]}};return P[":id"]=O.primaryKey,S!=null&&(P[_n(S)]=O.primaryKey),O})},hasGetAll:0<_.length&&"getAll"in m.objectStore(_[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),x=A.schema,E=A.hasGetAll,A=x.tables.map(d),k={};return A.forEach(function(C){return k[C.name]=C}),{stack:"dbcore",transaction:r.transaction.bind(r),table:function(C){if(!k[C])throw new Error("Table '".concat(C,"' not found"));return k[C]},MIN_KEY:-1/0,MAX_KEY:gn(i),schema:x}}function Bu(r,i,a,c){var d=a.IDBKeyRange;return a.indexedDB,{dbcore:(c=Uu(i,d,c),r.dbcore.reduce(function(p,m){return m=m.create,o(o({},p),m(p))},c))}}function Qn(r,c){var a=c.db,c=Bu(r._middlewares,a,r._deps,c);r.core=c.dbcore,r.tables.forEach(function(d){var p=d.name;r.core.schema.tables.some(function(m){return m.name===p})&&(d.core=r.core.table(p),r[p]instanceof r.Table&&(r[p].core=d.core))})}function Xn(r,i,a,c){a.forEach(function(d){var p=c[d];i.forEach(function(m){var _=function x(E,A){return N(E,A)||(E=v(E))&&x(E,A)}(m,d);(!_||"value"in _&&_.value===void 0)&&(m===r.Transaction.prototype||m instanceof r.Transaction?j(m,d,{get:function(){return this.table(d)},set:function(x){w(this,d,{value:x,writable:!0,configurable:!0,enumerable:!0})}}):m[d]=new r.Table(d,p))})})}function ao(r,i){i.forEach(function(a){for(var c in a)a[c]instanceof r.Table&&delete a[c]})}function Nu(r,i){return r._cfg.version-i._cfg.version}function Lu(r,i,a,c){var d=r._dbSchema;a.objectStoreNames.contains("$meta")&&!d.$meta&&(d.$meta=io("$meta",qi("")[0],[]),r._storeNames.push("$meta"));var p=r._createTransaction("readwrite",r._storeNames,d);p.create(a),p._completion.catch(c);var m=p._reject.bind(p),_=X.transless||X;mt(function(){return X.trans=p,X.transless=_,i!==0?(Qn(r,a),E=i,((x=p).storeNames.includes("$meta")?x.table("$meta").get("version").then(function(A){return A??E}):H.resolve(E)).then(function(A){return C=A,S=p,I=a,P=[],A=(k=r)._versions,O=k._dbSchema=er(0,k.idbdb,I),(A=A.filter(function(T){return T._cfg.version>=C})).length!==0?(A.forEach(function(T){P.push(function(){var D=O,R=T._cfg.dbschema;tr(k,D,I),tr(k,R,I),O=k._dbSchema=R;var U=uo(D,R);U.add.forEach(function(V){co(I,V[0],V[1].primKey,V[1].indexes)}),U.change.forEach(function(V){if(V.recreate)throw new ne.Upgrade("Not yet support for changing primary key");var F=I.objectStore(V.name);V.add.forEach(function(J){return Zn(F,J)}),V.change.forEach(function(J){F.deleteIndex(J.name),Zn(F,J)}),V.del.forEach(function(J){return F.deleteIndex(J)})});var L=T._cfg.contentUpgrade;if(L&&T._cfg.version>C){Qn(k,I),S._memoizedTables={};var W=ge(R);U.del.forEach(function(V){W[V]=D[V]}),ao(k,[k.Transaction.prototype]),Xn(k,[k.Transaction.prototype],f(W),W),S.schema=W;var $,M=Ue(L);return M&&Mt(),U=H.follow(function(){var V;($=L(S))&&M&&(V=bt.bind(null,null),$.then(V,V))}),$&&typeof $.then=="function"?H.resolve($):U.then(function(){return $})}}),P.push(function(D){var R,U,L=T._cfg.dbschema;R=L,U=D,[].slice.call(U.db.objectStoreNames).forEach(function(W){return R[W]==null&&U.db.deleteObjectStore(W)}),ao(k,[k.Transaction.prototype]),Xn(k,[k.Transaction.prototype],k._storeNames,k._dbSchema),S.schema=k._dbSchema}),P.push(function(D){k.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(k.idbdb.version/10)===T._cfg.version?(k.idbdb.deleteObjectStore("$meta"),delete k._dbSchema.$meta,k._storeNames=k._storeNames.filter(function(R){return R!=="$meta"})):D.objectStore("$meta").put(T._cfg.version,"version"))})}),function T(){return P.length?H.resolve(P.shift()(S.idbtrans)).then(T):H.resolve()}().then(function(){Mi(O,I)})):H.resolve();var k,C,S,I,P,O}).catch(m)):(f(d).forEach(function(A){co(a,A,d[A].primKey,d[A].indexes)}),Qn(r,a),void H.follow(function(){return r.on.populate.fire(p)}).catch(m));var x,E})}function $u(r,i){Mi(r._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var a=er(0,r.idbdb,i);tr(r,r._dbSchema,i);for(var c=0,d=uo(a,r._dbSchema).change;c<d.length;c++){var p=function(m){if(m.change.length||m.recreate)return console.warn("Unable to patch indexes of table ".concat(m.name," because it has changes on the type of index or primary key.")),{value:void 0};var _=i.objectStore(m.name);m.add.forEach(function(x){Ze&&console.debug("Dexie upgrade patch: Creating missing index ".concat(m.name,".").concat(x.src)),Zn(_,x)})}(d[c]);if(typeof p=="object")return p.value}}function uo(r,i){var a,c={del:[],add:[],change:[]};for(a in r)i[a]||c.del.push(a);for(a in i){var d=r[a],p=i[a];if(d){var m={name:a,def:p,recreate:!1,del:[],add:[],change:[]};if(""+(d.primKey.keyPath||"")!=""+(p.primKey.keyPath||"")||d.primKey.auto!==p.primKey.auto)m.recreate=!0,c.change.push(m);else{var _=d.idxByName,x=p.idxByName,E=void 0;for(E in _)x[E]||m.del.push(E);for(E in x){var A=_[E],k=x[E];A?A.src!==k.src&&m.change.push(k):m.add.push(k)}(0<m.del.length||0<m.add.length||0<m.change.length)&&c.change.push(m)}}else c.add.push([a,p])}return c}function co(r,i,a,c){var d=r.db.createObjectStore(i,a.keyPath?{keyPath:a.keyPath,autoIncrement:a.auto}:{autoIncrement:a.auto});return c.forEach(function(p){return Zn(d,p)}),d}function Mi(r,i){f(r).forEach(function(a){i.db.objectStoreNames.contains(a)||(Ze&&console.debug("Dexie: Creating missing table",a),co(i,a,r[a].primKey,r[a].indexes))})}function Zn(r,i){r.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function er(r,i,a){var c={};return G(i.objectStoreNames,0).forEach(function(d){for(var p=a.objectStore(d),m=oo(Li(E=p.keyPath),E||"",!0,!1,!!p.autoIncrement,E&&typeof E!="string",!0),_=[],x=0;x<p.indexNames.length;++x){var A=p.index(p.indexNames[x]),E=A.keyPath,A=oo(A.name,E,!!A.unique,!!A.multiEntry,!1,E&&typeof E!="string",!1);_.push(A)}c[d]=io(d,m,_)}),c}function tr(r,i,a){for(var c=a.db.objectStoreNames,d=0;d<c.length;++d){var p=c[d],m=a.objectStore(p);r._hasGetAll="getAll"in m;for(var _=0;_<m.indexNames.length;++_){var x=m.indexNames[_],E=m.index(x).keyPath,A=typeof E=="string"?E:"["+G(E).join("+")+"]";!i[p]||(E=i[p].idxByName[A])&&(E.name=x,delete i[p].idxByName[A],i[p].idxByName[x]=E)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&u.WorkerGlobalScope&&u instanceof u.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function qi(r){return r.split(",").map(function(i,a){var c=(i=i.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return oo(c,d||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),h(d),a===0)})}var Mu=(nr.prototype._parseStoresSpec=function(r,i){f(r).forEach(function(a){if(r[a]!==null){var c=qi(r[a]),d=c.shift();if(d.unique=!0,d.multi)throw new ne.Schema("Primary key cannot be multi-valued");c.forEach(function(p){if(p.auto)throw new ne.Schema("Only primary key can be marked as autoIncrement (++)");if(!p.keyPath)throw new ne.Schema("Index must have a name and cannot be an empty string")}),i[a]=io(a,d,c)}})},nr.prototype.stores=function(a){var i=this.db;this._cfg.storesSource=this._cfg.storesSource?y(this._cfg.storesSource,a):a;var a=i._versions,c={},d={};return a.forEach(function(p){y(c,p._cfg.storesSource),d=p._cfg.dbschema={},p._parseStoresSpec(c,d)}),i._dbSchema=d,ao(i,[i._allTables,i,i.Transaction.prototype]),Xn(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],f(d),d),i._storeNames=f(d),this},nr.prototype.upgrade=function(r){return this._cfg.contentUpgrade=Fr(this._cfg.contentUpgrade||me,r),this},nr);function nr(){}function lo(r,i){var a=r._dbNamesDB;return a||(a=r._dbNamesDB=new ct(zn,{addons:[],indexedDB:r,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),a.table("dbnames")}function fo(r){return r&&typeof r.databases=="function"}function ho(r){return mt(function(){return X.letThrough=!0,r()})}function po(r){return!("from"in r)}var Be=function(r,i){if(!this){var a=new Be;return r&&"d"in r&&y(a,r),a}y(this,arguments.length?{d:1,from:r,to:1<arguments.length?i:r}:{d:0})};function wn(r,i,a){var c=he(i,a);if(!isNaN(c)){if(0<c)throw RangeError();if(po(r))return y(r,{from:i,to:a,d:1});var d=r.l,c=r.r;if(he(a,r.from)<0)return d?wn(d,i,a):r.l={from:i,to:a,d:1,l:null,r:null},Wi(r);if(0<he(i,r.to))return c?wn(c,i,a):r.r={from:i,to:a,d:1,l:null,r:null},Wi(r);he(i,r.from)<0&&(r.from=i,r.l=null,r.d=c?c.d+1:1),0<he(a,r.to)&&(r.to=a,r.r=null,r.d=r.l?r.l.d+1:1),a=!r.r,d&&!r.l&&kn(r,d),c&&a&&kn(r,c)}}function kn(r,i){po(i)||function a(c,x){var p=x.from,m=x.to,_=x.l,x=x.r;wn(c,p,m),_&&a(c,_),x&&a(c,x)}(r,i)}function Fi(r,i){var a=rr(i),c=a.next();if(c.done)return!1;for(var d=c.value,p=rr(r),m=p.next(d.from),_=m.value;!c.done&&!m.done;){if(he(_.from,d.to)<=0&&0<=he(_.to,d.from))return!0;he(d.from,_.from)<0?d=(c=a.next(_.from)).value:_=(m=p.next(d.from)).value}return!1}function rr(r){var i=po(r)?null:{s:0,n:r};return{next:function(a){for(var c=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,c)for(;i.n.l&&he(a,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!c||he(a,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function Wi(r){var i,a,c=(((i=r.r)===null||i===void 0?void 0:i.d)||0)-(((a=r.l)===null||a===void 0?void 0:a.d)||0),d=1<c?"r":c<-1?"l":"";d&&(i=d=="r"?"l":"r",a=o({},r),c=r[d],r.from=c.from,r.to=c.to,r[d]=c[d],a[d]=c[i],(r[i]=a).d=Vi(a)),r.d=Vi(r)}function Vi(a){var i=a.r,a=a.l;return(i?a?Math.max(i.d,a.d):i.d:a?a.d:0)+1}function or(r,i){return f(i).forEach(function(a){r[a]?kn(r[a],i[a]):r[a]=function c(d){var p,m,_={};for(p in d)g(d,p)&&(m=d[p],_[p]=!m||typeof m!="object"||oe.has(m.constructor)?m:c(m));return _}(i[a])}),r}function yo(r,i){return r.all||i.all||Object.keys(r).some(function(a){return i[a]&&Fi(i[a],r[a])})}b(Be.prototype,((Je={add:function(r){return kn(this,r),this},addKey:function(r){return wn(this,r,r),this},addKeys:function(r){var i=this;return r.forEach(function(a){return wn(i,a,a)}),this},hasKey:function(r){var i=rr(this).next(r).value;return i&&he(i.from,r)<=0&&0<=he(i.to,r)}})[de]=function(){return rr(this)},Je));var Rt={},vo={},mo=!1;function ir(r){or(vo,r),mo||(mo=!0,setTimeout(function(){mo=!1,bo(vo,!(vo={}))},0))}function bo(r,i){i===void 0&&(i=!1);var a=new Set;if(r.all)for(var c=0,d=Object.values(Rt);c<d.length;c++)zi(m=d[c],r,a,i);else for(var p in r){var m,_=/^idb\:\/\/(.*)\/(.*)\//.exec(p);_&&(p=_[1],_=_[2],(m=Rt["idb://".concat(p,"/").concat(_)])&&zi(m,r,a,i))}a.forEach(function(x){return x()})}function zi(r,i,a,c){for(var d=[],p=0,m=Object.entries(r.queries.query);p<m.length;p++){for(var _=m[p],x=_[0],E=[],A=0,k=_[1];A<k.length;A++){var C=k[A];yo(i,C.obsSet)?C.subscribers.forEach(function(O){return a.add(O)}):c&&E.push(C)}c&&d.push([x,E])}if(c)for(var S=0,I=d;S<I.length;S++){var P=I[S],x=P[0],E=P[1];r.queries.query[x]=E}}function qu(r){var i=r._state,a=r._deps.indexedDB;if(i.isBeingOpened||r.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Ie(i.dbOpenError):r});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var c=i.openCanceller,d=Math.round(10*r.verno),p=!1;function m(){if(i.openCanceller!==c)throw new ne.DatabaseClosed("db.open() was cancelled")}function _(){return new H(function(C,S){if(m(),!a)throw new ne.MissingAPI;var I=r.name,P=i.autoSchema||!d?a.open(I):a.open(I,d);if(!P)throw new ne.MissingAPI;P.onerror=et(S),P.onblocked=xe(r._fireOnBlocked),P.onupgradeneeded=xe(function(O){var T;A=P.transaction,i.autoSchema&&!r._options.allowEmptyDB?(P.onerror=mn,A.abort(),P.result.close(),(T=a.deleteDatabase(I)).onsuccess=T.onerror=xe(function(){S(new ne.NoSuchDatabase("Database ".concat(I," doesnt exist")))})):(A.onerror=et(S),O=O.oldVersion>Math.pow(2,62)?0:O.oldVersion,k=O<1,r.idbdb=P.result,p&&$u(r,A),Lu(r,O/10,A,S))},S),P.onsuccess=xe(function(){A=null;var O,T,D,R,U,L=r.idbdb=P.result,W=G(L.objectStoreNames);if(0<W.length)try{var $=L.transaction((R=W).length===1?R[0]:R,"readonly");if(i.autoSchema)T=L,D=$,(O=r).verno=T.version/10,D=O._dbSchema=er(0,T,D),O._storeNames=G(T.objectStoreNames,0),Xn(O,[O._allTables],f(D),D);else if(tr(r,r._dbSchema,$),((U=uo(er(0,(U=r).idbdb,$),U._dbSchema)).add.length||U.change.some(function(M){return M.add.length||M.change.length}))&&!p)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),L.close(),d=L.version+1,p=!0,C(_());Qn(r,$)}catch{}qt.push(r),L.onversionchange=xe(function(M){i.vcFired=!0,r.on("versionchange").fire(M)}),L.onclose=xe(function(M){r.on("close").fire(M)}),k&&(U=r._deps,$=I,L=U.indexedDB,U=U.IDBKeyRange,fo(L)||$===zn||lo(L,U).put({name:$}).catch(me)),C()},S)}).catch(function(C){switch(C==null?void 0:C.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),_();break;case"VersionError":if(0<d)return d=0,_()}return H.reject(C)})}var x,E=i.dbReadyResolve,A=null,k=!1;return H.race([c,(typeof navigator>"u"?H.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(C){function S(){return indexedDB.databases().finally(C)}x=setInterval(S,100),S()}).finally(function(){return clearInterval(x)}):Promise.resolve()).then(_)]).then(function(){return m(),i.onReadyBeingFired=[],H.resolve(ho(function(){return r.on.ready.fire(r.vip)})).then(function C(){if(0<i.onReadyBeingFired.length){var S=i.onReadyBeingFired.reduce(Fr,me);return i.onReadyBeingFired=[],H.resolve(ho(function(){return S(r.vip)})).then(C)}})}).finally(function(){i.openCanceller===c&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(C){i.dbOpenError=C;try{A&&A.abort()}catch{}return c===i.openCanceller&&r._close(),Ie(C)}).finally(function(){i.openComplete=!0,E()}).then(function(){var C;return k&&(C={},r.tables.forEach(function(S){S.schema.indexes.forEach(function(I){I.name&&(C["idb://".concat(r.name,"/").concat(S.name,"/").concat(I.name)]=new Be(-1/0,[[[]]]))}),C["idb://".concat(r.name,"/").concat(S.name,"/")]=C["idb://".concat(r.name,"/").concat(S.name,"/:dels")]=new Be(-1/0,[[[]]])}),wt(bn).fire(C),bo(C,!0)),r})}function go(r){function i(p){return r.next(p)}var a=d(i),c=d(function(p){return r.throw(p)});function d(p){return function(x){var _=p(x),x=_.value;return _.done?x:x&&typeof x.then=="function"?x.then(a,c):h(x)?Promise.all(x).then(a,c):a(x)}}return d(i)()}function sr(r,i,a){for(var c=h(r)?r.slice():[r],d=0;d<a;++d)c.push(i);return c}var Fu={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return o(o({},r),{table:function(i){var a=r.table(i),c=a.schema,d={},p=[];function m(k,C,S){var I=_n(k),P=d[I]=d[I]||[],O=k==null?0:typeof k=="string"?1:k.length,T=0<C,T=o(o({},S),{name:T?"".concat(I,"(virtual-from:").concat(S.name,")"):S.name,lowLevelIndex:S,isVirtual:T,keyTail:C,keyLength:O,extractKey:so(k),unique:!T&&S.unique});return P.push(T),T.isPrimaryKey||p.push(T),1<O&&m(O===2?k[0]:k.slice(0,O-1),C+1,S),P.sort(function(D,R){return D.keyTail-R.keyTail}),T}i=m(c.primaryKey.keyPath,0,c.primaryKey),d[":id"]=[i];for(var _=0,x=c.indexes;_<x.length;_++){var E=x[_];m(E.keyPath,0,E)}function A(k){var C,S=k.query.index;return S.isVirtual?o(o({},k),{query:{index:S.lowLevelIndex,range:(C=k.query.range,S=S.keyTail,{type:C.type===1?2:C.type,lower:sr(C.lower,C.lowerOpen?r.MAX_KEY:r.MIN_KEY,S),lowerOpen:!0,upper:sr(C.upper,C.upperOpen?r.MIN_KEY:r.MAX_KEY,S),upperOpen:!0})}}):k}return o(o({},a),{schema:o(o({},c),{primaryKey:i,indexes:p,getIndexByKeyPath:function(k){return(k=d[_n(k)])&&k[0]}}),count:function(k){return a.count(A(k))},query:function(k){return a.query(A(k))},openCursor:function(k){var C=k.query.index,S=C.keyTail,I=C.isVirtual,P=C.keyLength;return I?a.openCursor(A(k)).then(function(T){return T&&O(T)}):a.openCursor(k);function O(T){return Object.create(T,{continue:{value:function(D){D!=null?T.continue(sr(D,k.reverse?r.MAX_KEY:r.MIN_KEY,S)):k.unique?T.continue(T.key.slice(0,P).concat(k.reverse?r.MIN_KEY:r.MAX_KEY,S)):T.continue()}},continuePrimaryKey:{value:function(D,R){T.continuePrimaryKey(sr(D,r.MAX_KEY,S),R)}},primaryKey:{get:function(){return T.primaryKey}},key:{get:function(){var D=T.key;return P===1?D[0]:D.slice(0,P)}},value:{get:function(){return T.value}}})}}})}})}};function _o(r,i,a,c){return a=a||{},c=c||"",f(r).forEach(function(d){var p,m,_;g(i,d)?(p=r[d],m=i[d],typeof p=="object"&&typeof m=="object"&&p&&m?(_=re(p))!==re(m)?a[c+d]=i[d]:_==="Object"?_o(p,m,a,c+d+"."):p!==m&&(a[c+d]=i[d]):p!==m&&(a[c+d]=i[d])):a[c+d]=void 0}),f(i).forEach(function(d){g(r,d)||(a[c+d]=i[d])}),a}function wo(r,i){return i.type==="delete"?i.keys:i.keys||i.values.map(r.extractKey)}var Wu={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(r){return o(o({},r),{table:function(i){var a=r.table(i),c=a.schema.primaryKey;return o(o({},a),{mutate:function(d){var p=X.trans,m=p.table(i).hook,_=m.deleting,x=m.creating,E=m.updating;switch(d.type){case"add":if(x.fire===me)break;return p._promise("readwrite",function(){return A(d)},!0);case"put":if(x.fire===me&&E.fire===me)break;return p._promise("readwrite",function(){return A(d)},!0);case"delete":if(_.fire===me)break;return p._promise("readwrite",function(){return A(d)},!0);case"deleteRange":if(_.fire===me)break;return p._promise("readwrite",function(){return function k(C,S,I){return a.query({trans:C,values:!1,query:{index:c,range:S},limit:I}).then(function(P){var O=P.result;return A({type:"delete",keys:O,trans:C}).then(function(T){return 0<T.numFailures?Promise.reject(T.failures[0]):O.length<I?{failures:[],numFailures:0,lastResult:void 0}:k(C,o(o({},S),{lower:O[O.length-1],lowerOpen:!0}),I)})})}(d.trans,d.range,1e4)},!0)}return a.mutate(d);function A(k){var C,S,I,P=X.trans,O=k.keys||wo(c,k);if(!O)throw new Error("Keys missing");return(k=k.type==="add"||k.type==="put"?o(o({},k),{keys:O}):o({},k)).type!=="delete"&&(k.values=s([],k.values)),k.keys&&(k.keys=s([],k.keys)),C=a,I=O,((S=k).type==="add"?Promise.resolve([]):C.getMany({trans:S.trans,keys:I,cache:"immutable"})).then(function(T){var D=O.map(function(R,U){var L,W,$,M=T[U],V={onerror:null,onsuccess:null};return k.type==="delete"?_.fire.call(V,R,M,P):k.type==="add"||M===void 0?(L=x.fire.call(V,R,k.values[U],P),R==null&&L!=null&&(k.keys[U]=R=L,c.outbound||pe(k.values[U],c.keyPath,R))):(L=_o(M,k.values[U]),(W=E.fire.call(V,L,R,M,P))&&($=k.values[U],Object.keys(W).forEach(function(F){g($,F)?$[F]=W[F]:pe($,F,W[F])}))),V});return a.mutate(k).then(function(R){for(var U=R.failures,L=R.results,W=R.numFailures,R=R.lastResult,$=0;$<O.length;++$){var M=(L||O)[$],V=D[$];M==null?V.onerror&&V.onerror(U[$]):V.onsuccess&&V.onsuccess(k.type==="put"&&T[$]?k.values[$]:M)}return{failures:U,results:L,numFailures:W,lastResult:R}}).catch(function(R){return D.forEach(function(U){return U.onerror&&U.onerror(R)}),Promise.reject(R)})})}}})}})}};function Hi(r,i,a){try{if(!i||i.keys.length<r.length)return null;for(var c=[],d=0,p=0;d<i.keys.length&&p<r.length;++d)he(i.keys[d],r[p])===0&&(c.push(a?Y(i.values[d]):i.values[d]),++p);return c.length===r.length?c:null}catch{return null}}var Vu={stack:"dbcore",level:-1,create:function(r){return{table:function(i){var a=r.table(i);return o(o({},a),{getMany:function(c){if(!c.cache)return a.getMany(c);var d=Hi(c.keys,c.trans._cache,c.cache==="clone");return d?H.resolve(d):a.getMany(c).then(function(p){return c.trans._cache={keys:c.keys,values:c.cache==="clone"?Y(p):p},p})},mutate:function(c){return c.type!=="add"&&(c.trans._cache=null),a.mutate(c)}})}}}};function Gi(r,i){return r.trans.mode==="readonly"&&!!r.subscr&&!r.trans.explicit&&r.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function Yi(r,i){switch(r){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var zu={stack:"dbcore",level:0,name:"Observability",create:function(r){var i=r.schema.name,a=new Be(r.MIN_KEY,r.MAX_KEY);return o(o({},r),{transaction:function(c,d,p){if(X.subscr&&d!=="readonly")throw new ne.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(X.querier));return r.transaction(c,d,p)},table:function(c){var d=r.table(c),p=d.schema,m=p.primaryKey,k=p.indexes,_=m.extractKey,x=m.outbound,E=m.autoIncrement&&k.filter(function(S){return S.compound&&S.keyPath.includes(m.keyPath)}),A=o(o({},d),{mutate:function(S){function I(F){return F="idb://".concat(i,"/").concat(c,"/").concat(F),R[F]||(R[F]=new Be)}var P,O,T,D=S.trans,R=S.mutatedParts||(S.mutatedParts={}),U=I(""),L=I(":dels"),W=S.type,V=S.type==="deleteRange"?[S.range]:S.type==="delete"?[S.keys]:S.values.length<50?[wo(m,S).filter(function(F){return F}),S.values]:[],$=V[0],M=V[1],V=S.trans._cache;return h($)?(U.addKeys($),(V=W==="delete"||$.length===M.length?Hi($,V):null)||L.addKeys($),(V||M)&&(P=I,O=V,T=M,p.indexes.forEach(function(F){var J=P(F.name||"");function se(fe){return fe!=null?F.extractKey(fe):null}function le(fe){return F.multiEntry&&h(fe)?fe.forEach(function(ze){return J.addKey(ze)}):J.addKey(fe)}(O||T).forEach(function(fe,Ne){var ie=O&&se(O[Ne]),Ne=T&&se(T[Ne]);he(ie,Ne)!==0&&(ie!=null&&le(ie),Ne!=null&&le(Ne))})}))):$?(M={from:(M=$.lower)!==null&&M!==void 0?M:r.MIN_KEY,to:(M=$.upper)!==null&&M!==void 0?M:r.MAX_KEY},L.add(M),U.add(M)):(U.add(a),L.add(a),p.indexes.forEach(function(F){return I(F.name).add(a)})),d.mutate(S).then(function(F){return!$||S.type!=="add"&&S.type!=="put"||(U.addKeys(F.results),E&&E.forEach(function(J){for(var se=S.values.map(function(ie){return J.extractKey(ie)}),le=J.keyPath.findIndex(function(ie){return ie===m.keyPath}),fe=0,ze=F.results.length;fe<ze;++fe)se[fe][le]=F.results[fe];I(J.name).addKeys(se)})),D.mutatedParts=or(D.mutatedParts||{},R),F})}}),k=function(I){var P=I.query,I=P.index,P=P.range;return[I,new Be((I=P.lower)!==null&&I!==void 0?I:r.MIN_KEY,(P=P.upper)!==null&&P!==void 0?P:r.MAX_KEY)]},C={get:function(S){return[m,new Be(S.key)]},getMany:function(S){return[m,new Be().addKeys(S.keys)]},count:k,query:k,openCursor:k};return f(C).forEach(function(S){A[S]=function(I){var P=X.subscr,O=!!P,T=Gi(X,d)&&Yi(S,I)?I.obsSet={}:P;if(O){var D=function(M){return M="idb://".concat(i,"/").concat(c,"/").concat(M),T[M]||(T[M]=new Be)},R=D(""),U=D(":dels"),P=C[S](I),O=P[0],P=P[1];if((S==="query"&&O.isPrimaryKey&&!I.values?U:D(O.name||"")).add(P),!O.isPrimaryKey){if(S!=="count"){var L=S==="query"&&x&&I.values&&d.query(o(o({},I),{values:!1}));return d[S].apply(this,arguments).then(function(M){if(S==="query"){if(x&&I.values)return L.then(function(se){return se=se.result,R.addKeys(se),M});var V=I.values?M.result.map(_):M.result;(I.values?R:U).addKeys(V)}else if(S==="openCursor"){var F=M,J=I.values;return F&&Object.create(F,{key:{get:function(){return U.addKey(F.primaryKey),F.key}},primaryKey:{get:function(){var se=F.primaryKey;return U.addKey(se),se}},value:{get:function(){return J&&R.addKey(F.primaryKey),F.value}}})}return M})}U.add(a)}}return d[S].apply(this,arguments)}}),A}})}};function Ji(r,i,a){if(a.numFailures===0)return i;if(i.type==="deleteRange")return null;var c=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1;return a.numFailures===c?null:(i=o({},i),h(i.keys)&&(i.keys=i.keys.filter(function(d,p){return!(p in a.failures)})),"values"in i&&h(i.values)&&(i.values=i.values.filter(function(d,p){return!(p in a.failures)})),i)}function ko(r,i){return a=r,((c=i).lower===void 0||(c.lowerOpen?0<he(a,c.lower):0<=he(a,c.lower)))&&(r=r,(i=i).upper===void 0||(i.upperOpen?he(r,i.upper)<0:he(r,i.upper)<=0));var a,c}function Qi(r,i,C,c,d,p){if(!C||C.length===0)return r;var m=i.query.index,_=m.multiEntry,x=i.query.range,E=c.schema.primaryKey.extractKey,A=m.extractKey,k=(m.lowLevelIndex||m).extractKey,C=C.reduce(function(S,I){var P=S,O=[];if(I.type==="add"||I.type==="put")for(var T=new Be,D=I.values.length-1;0<=D;--D){var R,U=I.values[D],L=E(U);T.hasKey(L)||(R=A(U),(_&&h(R)?R.some(function(F){return ko(F,x)}):ko(R,x))&&(T.addKey(L),O.push(U)))}switch(I.type){case"add":var W=new Be().addKeys(i.values?S.map(function(J){return E(J)}):S),P=S.concat(i.values?O.filter(function(J){return J=E(J),!W.hasKey(J)&&(W.addKey(J),!0)}):O.map(function(J){return E(J)}).filter(function(J){return!W.hasKey(J)&&(W.addKey(J),!0)}));break;case"put":var $=new Be().addKeys(I.values.map(function(J){return E(J)}));P=S.filter(function(J){return!$.hasKey(i.values?E(J):J)}).concat(i.values?O:O.map(function(J){return E(J)}));break;case"delete":var M=new Be().addKeys(I.keys);P=S.filter(function(J){return!M.hasKey(i.values?E(J):J)});break;case"deleteRange":var V=I.range;P=S.filter(function(J){return!ko(E(J),V)})}return P},r);return C===r?r:(C.sort(function(S,I){return he(k(S),k(I))||he(E(S),E(I))}),i.limit&&i.limit<1/0&&(C.length>i.limit?C.length=i.limit:r.length===i.limit&&C.length<i.limit&&(d.dirty=!0)),p?Object.freeze(C):C)}function Xi(r,i){return he(r.lower,i.lower)===0&&he(r.upper,i.upper)===0&&!!r.lowerOpen==!!i.lowerOpen&&!!r.upperOpen==!!i.upperOpen}function Hu(r,i){return function(a,c,d,p){if(a===void 0)return c!==void 0?-1:0;if(c===void 0)return 1;if((c=he(a,c))===0){if(d&&p)return 0;if(d)return 1;if(p)return-1}return c}(r.lower,i.lower,r.lowerOpen,i.lowerOpen)<=0&&0<=function(a,c,d,p){if(a===void 0)return c!==void 0?1:0;if(c===void 0)return-1;if((c=he(a,c))===0){if(d&&p)return 0;if(d)return-1;if(p)return 1}return c}(r.upper,i.upper,r.upperOpen,i.upperOpen)}function Gu(r,i,a,c){r.subscribers.add(a),c.addEventListener("abort",function(){var d,p;r.subscribers.delete(a),r.subscribers.size===0&&(d=r,p=i,setTimeout(function(){d.subscribers.size===0&&Oe(p,d)},3e3))})}var Yu={stack:"dbcore",level:0,name:"Cache",create:function(r){var i=r.schema.name;return o(o({},r),{transaction:function(a,c,d){var p,m,_=r.transaction(a,c,d);return c==="readwrite"&&(m=(p=new AbortController).signal,d=function(x){return function(){if(p.abort(),c==="readwrite"){for(var E=new Set,A=0,k=a;A<k.length;A++){var C=k[A],S=Rt["idb://".concat(i,"/").concat(C)];if(S){var I=r.table(C),P=S.optimisticOps.filter(function(J){return J.trans===_});if(_._explicit&&x&&_.mutatedParts)for(var O=0,T=Object.values(S.queries.query);O<T.length;O++)for(var D=0,R=(W=T[O]).slice();D<R.length;D++)yo(($=R[D]).obsSet,_.mutatedParts)&&(Oe(W,$),$.subscribers.forEach(function(J){return E.add(J)}));else if(0<P.length){S.optimisticOps=S.optimisticOps.filter(function(J){return J.trans!==_});for(var U=0,L=Object.values(S.queries.query);U<L.length;U++)for(var W,$,M,V=0,F=(W=L[U]).slice();V<F.length;V++)($=F[V]).res!=null&&_.mutatedParts&&(x&&!$.dirty?(M=Object.isFrozen($.res),M=Qi($.res,$.req,P,I,$,M),$.dirty?(Oe(W,$),$.subscribers.forEach(function(J){return E.add(J)})):M!==$.res&&($.res=M,$.promise=H.resolve({result:M}))):($.dirty&&Oe(W,$),$.subscribers.forEach(function(J){return E.add(J)})))}}}E.forEach(function(J){return J()})}}},_.addEventListener("abort",d(!1),{signal:m}),_.addEventListener("error",d(!1),{signal:m}),_.addEventListener("complete",d(!0),{signal:m})),_},table:function(a){var c=r.table(a),d=c.schema.primaryKey;return o(o({},c),{mutate:function(p){var m=X.trans;if(d.outbound||m.db._options.cache==="disabled"||m.explicit||m.idbtrans.mode!=="readwrite")return c.mutate(p);var _=Rt["idb://".concat(i,"/").concat(a)];return _?(m=c.mutate(p),p.type!=="add"&&p.type!=="put"||!(50<=p.values.length||wo(d,p).some(function(x){return x==null}))?(_.optimisticOps.push(p),p.mutatedParts&&ir(p.mutatedParts),m.then(function(x){0<x.numFailures&&(Oe(_.optimisticOps,p),(x=Ji(0,p,x))&&_.optimisticOps.push(x),p.mutatedParts&&ir(p.mutatedParts))}),m.catch(function(){Oe(_.optimisticOps,p),p.mutatedParts&&ir(p.mutatedParts)})):m.then(function(x){var E=Ji(0,o(o({},p),{values:p.values.map(function(A,k){var C;return x.failures[k]?A:(A=(C=d.keyPath)!==null&&C!==void 0&&C.includes(".")?Y(A):o({},A),pe(A,d.keyPath,x.results[k]),A)})}),x);_.optimisticOps.push(E),queueMicrotask(function(){return p.mutatedParts&&ir(p.mutatedParts)})}),m):c.mutate(p)},query:function(p){if(!Gi(X,c)||!Yi("query",p))return c.query(p);var m=((E=X.trans)===null||E===void 0?void 0:E.db._options.cache)==="immutable",k=X,_=k.requery,x=k.signal,E=function(I,P,O,T){var D=Rt["idb://".concat(I,"/").concat(P)];if(!D)return[];if(!(P=D.queries[O]))return[null,!1,D,null];var R=P[(T.query?T.query.index.name:null)||""];if(!R)return[null,!1,D,null];switch(O){case"query":var U=R.find(function(L){return L.req.limit===T.limit&&L.req.values===T.values&&Xi(L.req.query.range,T.query.range)});return U?[U,!0,D,R]:[R.find(function(L){return("limit"in L.req?L.req.limit:1/0)>=T.limit&&(!T.values||L.req.values)&&Hu(L.req.query.range,T.query.range)}),!1,D,R];case"count":return U=R.find(function(L){return Xi(L.req.query.range,T.query.range)}),[U,!!U,D,R]}}(i,a,"query",p),A=E[0],k=E[1],C=E[2],S=E[3];return A&&k?A.obsSet=p.obsSet:(k=c.query(p).then(function(I){var P=I.result;if(A&&(A.res=P),m){for(var O=0,T=P.length;O<T;++O)Object.freeze(P[O]);Object.freeze(P)}else I.result=Y(P);return I}).catch(function(I){return S&&A&&Oe(S,A),Promise.reject(I)}),A={obsSet:p.obsSet,promise:k,subscribers:new Set,type:"query",req:p,dirty:!1},S?S.push(A):(S=[A],(C=C||(Rt["idb://".concat(i,"/").concat(a)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[p.query.index.name||""]=S)),Gu(A,S,_,x),A.promise.then(function(I){return{result:Qi(I.result,p,C==null?void 0:C.optimisticOps,c,A,m)}})}})}})}};function ar(r,i){return new Proxy(r,{get:function(a,c,d){return c==="db"?i:Reflect.get(a,c,d)}})}var ct=(Ae.prototype.version=function(r){if(isNaN(r)||r<.1)throw new ne.Type("Given version is not a positive number");if(r=Math.round(10*r)/10,this.idbdb||this._state.isBeingOpened)throw new ne.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,r);var i=this._versions,a=i.filter(function(c){return c._cfg.version===r})[0];return a||(a=new this.Version(r),i.push(a),i.sort(Nu),a.stores({}),this._state.autoSchema=!1,a)},Ae.prototype._whenReady=function(r){var i=this;return this.idbdb&&(this._state.openComplete||X.letThrough||this._vip)?r():new H(function(a,c){if(i._state.openComplete)return c(new ne.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void c(new ne.DatabaseClosed);i.open().catch(me)}i._state.dbReadyPromise.then(a,c)}).then(r)},Ae.prototype.use=function(r){var i=r.stack,a=r.create,c=r.level,d=r.name;return d&&this.unuse({stack:i,name:d}),r=this._middlewares[i]||(this._middlewares[i]=[]),r.push({stack:i,create:a,level:c??10,name:d}),r.sort(function(p,m){return p.level-m.level}),this},Ae.prototype.unuse=function(r){var i=r.stack,a=r.name,c=r.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(d){return c?d.create!==c:!!a&&d.name!==a})),this},Ae.prototype.open=function(){var r=this;return jt(vt,function(){return qu(r)})},Ae.prototype._close=function(){var r=this._state,i=qt.indexOf(this);if(0<=i&&qt.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}r.isBeingOpened||(r.dbReadyPromise=new H(function(a){r.dbReadyResolve=a}),r.openCanceller=new H(function(a,c){r.cancelOpen=c}))},Ae.prototype.close=function(a){var i=(a===void 0?{disableAutoOpen:!0}:a).disableAutoOpen,a=this._state;i?(a.isBeingOpened&&a.cancelOpen(new ne.DatabaseClosed),this._close(),a.autoOpen=!1,a.dbOpenError=new ne.DatabaseClosed):(this._close(),a.autoOpen=this._options.autoOpen||a.isBeingOpened,a.openComplete=!1,a.dbOpenError=null)},Ae.prototype.delete=function(r){var i=this;r===void 0&&(r={disableAutoOpen:!0});var a=0<arguments.length&&typeof arguments[0]!="object",c=this._state;return new H(function(d,p){function m(){i.close(r);var _=i._deps.indexedDB.deleteDatabase(i.name);_.onsuccess=xe(function(){var x,E,A;x=i._deps,E=i.name,A=x.indexedDB,x=x.IDBKeyRange,fo(A)||E===zn||lo(A,x).delete(E).catch(me),d()}),_.onerror=et(p),_.onblocked=i._fireOnBlocked}if(a)throw new ne.InvalidArgument("Invalid closeOptions argument to db.delete()");c.isBeingOpened?c.dbReadyPromise.then(m):m()})},Ae.prototype.backendDB=function(){return this.idbdb},Ae.prototype.isOpen=function(){return this.idbdb!==null},Ae.prototype.hasBeenClosed=function(){var r=this._state.dbOpenError;return r&&r.name==="DatabaseClosed"},Ae.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ae.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ae.prototype,"tables",{get:function(){var r=this;return f(this._allTables).map(function(i){return r._allTables[i]})},enumerable:!1,configurable:!0}),Ae.prototype.transaction=function(){var r=(function(i,a,c){var d=arguments.length;if(d<2)throw new ne.InvalidArgument("Too few arguments");for(var p=new Array(d-1);--d;)p[d-1]=arguments[d];return c=p.pop(),[i,Z(p),c]}).apply(this,arguments);return this._transaction.apply(this,r)},Ae.prototype._transaction=function(r,i,a){var c=this,d=X.trans;d&&d.db===this&&r.indexOf("!")===-1||(d=null);var p,m,_=r.indexOf("?")!==-1;r=r.replace("!","").replace("?","");try{if(m=i.map(function(E){if(E=E instanceof c.Table?E.name:E,typeof E!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return E}),r=="r"||r===Xr)p=Xr;else{if(r!="rw"&&r!=Zr)throw new ne.InvalidArgument("Invalid transaction mode: "+r);p=Zr}if(d){if(d.mode===Xr&&p===Zr){if(!_)throw new ne.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");d=null}d&&m.forEach(function(E){if(d&&d.storeNames.indexOf(E)===-1){if(!_)throw new ne.SubTransaction("Table "+E+" not included in parent transaction.");d=null}}),_&&d&&!d.active&&(d=null)}}catch(E){return d?d._promise(null,function(A,k){k(E)}):Ie(E)}var x=(function E(A,k,C,S,I){return H.resolve().then(function(){var P=X.transless||X,O=A._createTransaction(k,C,A._dbSchema,S);if(O.explicit=!0,P={trans:O,transless:P},S)O.idbtrans=S.idbtrans;else try{O.create(),O.idbtrans._explicit=!0,A._state.PR1398_maxLoop=3}catch(R){return R.name===qr.InvalidState&&A.isOpen()&&0<--A._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),A.close({disableAutoOpen:!1}),A.open().then(function(){return E(A,k,C,null,I)})):Ie(R)}var T,D=Ue(I);return D&&Mt(),P=H.follow(function(){var R;(T=I.call(O,O))&&(D?(R=bt.bind(null,null),T.then(R,R)):typeof T.next=="function"&&typeof T.throw=="function"&&(T=go(T)))},P),(T&&typeof T.then=="function"?H.resolve(T).then(function(R){return O.active?R:Ie(new ne.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):P.then(function(){return T})).then(function(R){return S&&O._resolve(),O._completion.then(function(){return R})}).catch(function(R){return O._reject(R),Ie(R)})})}).bind(null,this,p,m,d,a);return d?d._promise(p,x,"lock"):X.trans?jt(X.transless,function(){return c._whenReady(x)}):this._whenReady(x)},Ae.prototype.table=function(r){if(!g(this._allTables,r))throw new ne.InvalidTable("Table ".concat(r," does not exist"));return this._allTables[r]},Ae);function Ae(r,i){var a=this;this._middlewares={},this.verno=0;var c=Ae.dependencies;this._options=i=o({addons:Ae.addons,autoOpen:!0,indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},c=i.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var d,p,m,_,x,E={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:me,dbReadyPromise:null,cancelOpen:me,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen};E.dbReadyPromise=new H(function(k){E.dbReadyResolve=k}),E.openCanceller=new H(function(k,C){E.cancelOpen=C}),this._state=E,this.name=r,this.on=pn(this,"populate","blocked","versionchange","close",{ready:[Fr,me]}),this.on.ready.subscribe=B(this.on.ready.subscribe,function(k){return function(C,S){Ae.vip(function(){var I,P=a._state;P.openComplete?(P.dbOpenError||H.resolve().then(C),S&&k(C)):P.onReadyBeingFired?(P.onReadyBeingFired.push(C),S&&k(C)):(k(C),I=a,S||k(function O(){I.on.ready.unsubscribe(C),I.on.ready.unsubscribe(O)}))})}}),this.Collection=(d=this,yn(ju.prototype,function(T,O){this.db=d;var S=Pi,I=null;if(O)try{S=O()}catch(D){I=D}var P=T._ctx,O=P.table,T=O.hook.reading.fire;this._ctx={table:O,index:P.index,isPrimKey:!P.index||O.schema.primKey.keyPath&&P.index===O.schema.primKey.name,range:S,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:I,or:P.or,valueMapper:T!==cn?T:null}})),this.Table=(p=this,yn(Di.prototype,function(k,C,S){this.db=p,this._tx=S,this.name=k,this.schema=C,this.hook=p._allTables[k]?p._allTables[k].hook:pn(null,{creating:[ku,me],reading:[wu,cn],updating:[Su,me],deleting:[xu,me]})})),this.Transaction=(m=this,yn(Ru.prototype,function(k,C,S,I,P){var O=this;this.db=m,this.mode=k,this.storeNames=C,this.schema=S,this.chromeTransactionDurability=I,this.idbtrans=null,this.on=pn(this,"complete","error","abort"),this.parent=P||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new H(function(T,D){O._resolve=T,O._reject=D}),this._completion.then(function(){O.active=!1,O.on.complete.fire()},function(T){var D=O.active;return O.active=!1,O.on.error.fire(T),O.parent?O.parent._reject(T):D&&O.idbtrans&&O.idbtrans.abort(),Ie(T)})})),this.Version=(_=this,yn(Mu.prototype,function(k){this.db=_,this._cfg={version:k,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(x=this,yn(Ni.prototype,function(k,C,S){if(this.db=x,this._ctx={table:k,index:C===":id"?null:C,or:S},this._cmp=this._ascending=he,this._descending=function(I,P){return he(P,I)},this._max=function(I,P){return 0<he(I,P)?I:P},this._min=function(I,P){return he(I,P)<0?I:P},this._IDBKeyRange=x._deps.IDBKeyRange,!this._IDBKeyRange)throw new ne.MissingAPI})),this.on("versionchange",function(k){0<k.newVersion?console.warn("Another connection wants to upgrade database '".concat(a.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(a.name,"'. Closing db now to resume the delete request.")),a.close({disableAutoOpen:!1})}),this.on("blocked",function(k){!k.newVersion||k.newVersion<k.oldVersion?console.warn("Dexie.delete('".concat(a.name,"') was blocked")):console.warn("Upgrade '".concat(a.name,"' blocked by other connection holding version ").concat(k.oldVersion/10))}),this._maxKey=gn(i.IDBKeyRange),this._createTransaction=function(k,C,S,I){return new a.Transaction(k,C,S,a._options.chromeTransactionDurability,I)},this._fireOnBlocked=function(k){a.on("blocked").fire(k),qt.filter(function(C){return C.name===a.name&&C!==a&&!C._state.vcFired}).map(function(C){return C.on("versionchange").fire(k)})},this.use(Vu),this.use(Yu),this.use(zu),this.use(Fu),this.use(Wu);var A=new Proxy(this,{get:function(k,C,S){if(C==="_vip")return!0;if(C==="table")return function(P){return ar(a.table(P),A)};var I=Reflect.get(k,C,S);return I instanceof Di?ar(I,A):C==="tables"?I.map(function(P){return ar(P,A)}):C==="_createTransaction"?function(){return ar(I.apply(this,arguments),A)}:I}});this.vip=A,c.forEach(function(k){return k(a)})}var ur,Je=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ju=(xo.prototype.subscribe=function(r,i,a){return this._subscribe(r&&typeof r!="function"?r:{next:r,error:i,complete:a})},xo.prototype[Je]=function(){return this},xo);function xo(r){this._subscribe=r}try{ur={indexedDB:u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,IDBKeyRange:u.IDBKeyRange||u.webkitIDBKeyRange}}catch{ur={indexedDB:null,IDBKeyRange:null}}function Zi(r){var i,a=!1,c=new Ju(function(d){var p=Ue(r),m,_=!1,x={},E={},A={get closed(){return _},unsubscribe:function(){_||(_=!0,m&&m.abort(),k&&wt.storagemutated.unsubscribe(S))}};d.start&&d.start(A);var k=!1,C=function(){return Qr(I)},S=function(P){or(x,P),yo(E,x)&&C()},I=function(){var P,O,T;!_&&ur.indexedDB&&(x={},P={},m&&m.abort(),m=new AbortController,T=function(D){var R=Lt();try{p&&Mt();var U=mt(r,D);return U=p?U.finally(bt):U}finally{R&&$t()}}(O={subscr:P,signal:m.signal,requery:C,querier:r,trans:null}),Promise.resolve(T).then(function(D){a=!0,i=D,_||O.signal.aborted||(x={},function(R){for(var U in R)if(g(R,U))return;return 1}(E=P)||k||(wt(bn,S),k=!0),Qr(function(){return!_&&d.next&&d.next(D)}))},function(D){a=!1,["DatabaseClosedError","AbortError"].includes(D==null?void 0:D.name)||_||Qr(function(){_||d.error&&d.error(D)})}))};return setTimeout(C,0),A});return c.hasValue=function(){return a},c.getValue=function(){return i},c}var Kt=ct;function So(r){var i=kt;try{kt=!0,wt.storagemutated.fire(r),bo(r,!0)}finally{kt=i}}b(Kt,o(o({},Bn),{delete:function(r){return new Kt(r,{addons:[]}).delete()},exists:function(r){return new Kt(r,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(r){try{return i=Kt.dependencies,a=i.indexedDB,i=i.IDBKeyRange,(fo(a)?Promise.resolve(a.databases()).then(function(c){return c.map(function(d){return d.name}).filter(function(d){return d!==zn})}):lo(a,i).toCollection().primaryKeys()).then(r)}catch{return Ie(new ne.MissingAPI)}var i,a},defineClass:function(){return function(r){y(this,r)}},ignoreTransaction:function(r){return X.trans?jt(X.transless,r):r()},vip:ho,async:function(r){return function(){try{var i=go(r.apply(this,arguments));return i&&typeof i.then=="function"?i:H.resolve(i)}catch(a){return Ie(a)}}},spawn:function(r,i,a){try{var c=go(r.apply(a,i||[]));return c&&typeof c.then=="function"?c:H.resolve(c)}catch(d){return Ie(d)}},currentTransaction:{get:function(){return X.trans||null}},waitFor:function(r,i){return i=H.resolve(typeof r=="function"?Kt.ignoreTransaction(r):r).timeout(i||6e4),X.trans?X.trans.waitFor(i):i},Promise:H,debug:{get:function(){return Ze},set:function(r){ki(r)}},derive:K,extend:y,props:b,override:B,Events:pn,on:wt,liveQuery:Zi,extendObservabilitySet:or,getByKeyPath:te,setByKeyPath:pe,delByKeyPath:function(r,i){typeof i=="string"?pe(r,i,void 0):"length"in i&&[].map.call(i,function(a){pe(r,a,void 0)})},shallowClone:ge,deepClone:Y,getObjectDiff:_o,cmp:he,asap:ce,minKey:-1/0,addons:[],connections:qt,errnames:qr,dependencies:ur,cache:Rt,semVer:"4.0.11",version:"4.0.11".split(".").map(function(r){return parseInt(r)}).reduce(function(r,i,a){return r+i/Math.pow(10,2*a)})})),Kt.maxKey=gn(Kt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(wt(bn,function(r){kt||(r=new CustomEvent(ro,{detail:r}),kt=!0,dispatchEvent(r),kt=!1)}),addEventListener(ro,function(r){r=r.detail,kt||So(r)}));var Vt,kt=!1,es=function(){};return typeof BroadcastChannel<"u"&&((es=function(){(Vt=new BroadcastChannel(ro)).onmessage=function(r){return r.data&&So(r.data)}})(),typeof Vt.unref=="function"&&Vt.unref(),wt(bn,function(r){kt||Vt.postMessage(r)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(r){if(!ct.disableBfCache&&r.persisted){Ze&&console.debug("Dexie: handling persisted pagehide"),Vt!=null&&Vt.close();for(var i=0,a=qt;i<a.length;i++)a[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(r){!ct.disableBfCache&&r.persisted&&(Ze&&console.debug("Dexie: handling persisted pageshow"),es(),So({all:new Be(-1/0,[[]])}))})),H.rejectionMapper=function(r,i){return!r||r instanceof $e||r instanceof TypeError||r instanceof SyntaxError||!r.name||!wi[r.name]?r:(i=new wi[r.name](i||r.message,r),"stack"in r&&j(i,"stack",{get:function(){return this.inner.stack}}),i)},ki(Ze),o(ct,Object.freeze({__proto__:null,Dexie:ct,liveQuery:Zi,Entity:Ci,cmp:he,PropModification:vn,replacePrefix:function(r,i){return new vn({replacePrefix:[r,i]})},add:function(r){return new vn({add:r})},remove:function(r){return new vn({remove:r})},default:ct,RangeSet:Be,mergeRanges:kn,rangesOverlap:Fi}),{default:ct}),ct})}(gr)),gr.exports}var ic=oc();const Uo=nc(ic),ns=Symbol.for("Dexie"),Se=globalThis[ns]||(globalThis[ns]=Uo);if(Uo.semVer!==Se.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Uo.semVer} and ${Se.semVer}`);const{liveQuery:Gt,mergeRanges:Ff,rangesOverlap:Wf,RangeSet:Vf,cmp:sc,Entity:zf,PropModification:rs,replacePrefix:Hf,add:Gf,remove:Yf}=Se;var Bo=function(e,t){return Bo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},Bo(e,t)};function pt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Bo(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function ac(e,t,n,o){function s(u){return u instanceof n?u:new n(function(f){f(u)})}return new(n||(n=Promise))(function(u,f){function h(l){try{v(o.next(l))}catch(g){f(g)}}function y(l){try{v(o.throw(l))}catch(g){f(g)}}function v(l){l.done?u(l.value):s(l.value).then(h,y)}v((o=o.apply(e,t||[])).next())})}function Qs(e,t){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},o,s,u,f=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return f.next=h(0),f.throw=h(1),f.return=h(2),typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function h(v){return function(l){return y([v,l])}}function y(v){if(o)throw new TypeError("Generator is already executing.");for(;f&&(f=0,v[0]&&(n=0)),n;)try{if(o=1,s&&(u=v[0]&2?s.return:v[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,v[1])).done)return u;switch(s=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return n.label++,{value:v[1],done:!1};case 5:n.label++,s=v[1],v=[0];continue;case 7:v=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){n=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){n.label=v[1];break}if(v[0]===6&&n.label<u[1]){n.label=u[1],u=v;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(v);break}u[2]&&n.ops.pop(),n.trys.pop();continue}v=t.call(e,n)}catch(l){v=[6,l],s=0}finally{o=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function Zt(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Bt(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),s,u=[],f;try{for(;(t===void 0||t-- >0)&&!(s=o.next()).done;)u.push(s.value)}catch(h){f={error:h}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(f)throw f.error}}return u}function en(e,t,n){if(n||arguments.length===2)for(var o=0,s=t.length,u;o<s;o++)(u||!(o in t))&&(u||(u=Array.prototype.slice.call(t,0,o)),u[o]=t[o]);return e.concat(u||Array.prototype.slice.call(t))}function Yt(e){return this instanceof Yt?(this.v=e,this):new Yt(e)}function uc(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(e,t||[]),s,u=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),h("next"),h("throw"),h("return",f),s[Symbol.asyncIterator]=function(){return this},s;function f(w){return function(j){return Promise.resolve(j).then(w,g)}}function h(w,j){o[w]&&(s[w]=function(K){return new Promise(function(N,q){u.push([w,K,N,q])>1||y(w,K)})},j&&(s[w]=j(s[w])))}function y(w,j){try{v(o[w](j))}catch(K){b(u[0][3],K)}}function v(w){w.value instanceof Yt?Promise.resolve(w.value.v).then(l,g):b(u[0][2],w)}function l(w){y("next",w)}function g(w){y("throw",w)}function b(w,j){w(j),u.shift(),u.length&&y(u[0][0],u[0][1])}}function cc(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Zt=="function"?Zt(e):e[Symbol.iterator](),n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n);function o(u){n[u]=e[u]&&function(f){return new Promise(function(h,y){f=e[u](f),s(h,y,f.done,f.value)})}}function s(u,f,h,y){Promise.resolve(y).then(function(v){u({value:v,done:h})},f)}}function be(e){return typeof e=="function"}function oi(e){var t=function(o){Error.call(o),o.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Io=oi(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(o,s){return s+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Er(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var sn=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,o,s,u;if(!this.closed){this.closed=!0;var f=this._parentage;if(f)if(this._parentage=null,Array.isArray(f))try{for(var h=Zt(f),y=h.next();!y.done;y=h.next()){var v=y.value;v.remove(this)}}catch(K){t={error:K}}finally{try{y&&!y.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}else f.remove(this);var l=this.initialTeardown;if(be(l))try{l()}catch(K){u=K instanceof Io?K.errors:[K]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var b=Zt(g),w=b.next();!w.done;w=b.next()){var j=w.value;try{os(j)}catch(K){u=u??[],K instanceof Io?u=en(en([],Bt(u)),Bt(K.errors)):u.push(K)}}}catch(K){o={error:K}}finally{try{w&&!w.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}}if(u)throw new Io(u)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)os(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&Er(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&Er(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Xs=sn.EMPTY;function Zs(e){return e instanceof sn||e&&"closed"in e&&be(e.remove)&&be(e.add)&&be(e.unsubscribe)}function os(e){be(e)?e():e.unsubscribe()}var lc={Promise:void 0},fc={setTimeout:function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return setTimeout.apply(void 0,en([e,t],Bt(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function ea(e){fc.setTimeout(function(){throw e})}function is(){}function _r(e){e()}var ii=function(e){pt(t,e);function t(n){var o=e.call(this)||this;return o.isStopped=!1,n?(o.destination=n,Zs(n)&&n.add(o)):o.destination=pc,o}return t.create=function(n,o,s){return new tn(n,o,s)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(sn),dc=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(o){lr(o)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(o){lr(o)}else lr(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){lr(n)}},e}(),tn=function(e){pt(t,e);function t(n,o,s){var u=e.call(this)||this,f;return be(n)||!n?f={next:n??void 0,error:o??void 0,complete:s??void 0}:f=n,u.destination=new dc(f),u}return t}(ii);function lr(e){ea(e)}function hc(e){throw e}var pc={closed:!0,next:is,error:hc,complete:is},si=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Rr(e){return e}function yc(e){return e.length===0?Rr:e.length===1?e[0]:function(n){return e.reduce(function(o,s){return s(o)},n)}}var Te=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,o){var s=this,u=mc(t)?t:new tn(t,n,o);return _r(function(){var f=s,h=f.operator,y=f.source;u.add(h?h.call(u,y):y?s._subscribe(u):s._trySubscribe(u))}),u},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var o=this;return n=ss(n),new n(function(s,u){var f=new tn({next:function(h){try{t(h)}catch(y){u(y),f.unsubscribe()}},error:u,complete:s});o.subscribe(f)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[si]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return yc(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=ss(t),new t(function(o,s){var u;n.subscribe(function(f){return u=f},function(f){return s(f)},function(){return o(u)})})},e.create=function(t){return new e(t)},e}();function ss(e){var t;return(t=e??lc.Promise)!==null&&t!==void 0?t:Promise}function vc(e){return e&&be(e.next)&&be(e.error)&&be(e.complete)}function mc(e){return e&&e instanceof ii||vc(e)&&Zs(e)}function bc(e){return be(e==null?void 0:e.lift)}function an(e){return function(t){if(bc(t))return t.lift(function(n){try{return e(n,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function nn(e,t,n,o,s){return new gc(e,t,n,o,s)}var gc=function(e){pt(t,e);function t(n,o,s,u,f,h){var y=e.call(this,n)||this;return y.onFinalize=f,y.shouldUnsubscribe=h,y._next=o?function(v){try{o(v)}catch(l){n.error(l)}}:e.prototype._next,y._error=u?function(v){try{u(v)}catch(l){n.error(l)}finally{this.unsubscribe()}}:e.prototype._error,y._complete=s?function(){try{s()}catch(v){n.error(v)}finally{this.unsubscribe()}}:e.prototype._complete,y}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;e.prototype.unsubscribe.call(this),!o&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(ii),_c=oi(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Dn=function(e){pt(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var o=new as(this,this);return o.operator=n,o},t.prototype._throwIfClosed=function(){if(this.closed)throw new _c},t.prototype.next=function(n){var o=this;_r(function(){var s,u;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var f=Zt(o.currentObservers),h=f.next();!h.done;h=f.next()){var y=h.value;y.next(n)}}catch(v){s={error:v}}finally{try{h&&!h.done&&(u=f.return)&&u.call(f)}finally{if(s)throw s.error}}}})},t.prototype.error=function(n){var o=this;_r(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=n;for(var s=o.observers;s.length;)s.shift().error(n)}})},t.prototype.complete=function(){var n=this;_r(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var o=n.observers;o.length;)o.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var o=this,s=this,u=s.hasError,f=s.isStopped,h=s.observers;return u||f?Xs:(this.currentObservers=null,h.push(n),new sn(function(){o.currentObservers=null,Er(h,n)}))},t.prototype._checkFinalizedStatuses=function(n){var o=this,s=o.hasError,u=o.thrownError,f=o.isStopped;s?n.error(u):f&&n.complete()},t.prototype.asObservable=function(){var n=new Te;return n.source=this,n},t.create=function(n,o){return new as(n,o)},t}(Te),as=function(e){pt(t,e);function t(n,o){var s=e.call(this)||this;return s.destination=n,s.source=o,s}return t.prototype.next=function(n){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.next)===null||s===void 0||s.call(o,n)},t.prototype.error=function(n){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.error)===null||s===void 0||s.call(o,n)},t.prototype.complete=function(){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||o===void 0||o.call(n)},t.prototype._subscribe=function(n){var o,s;return(s=(o=this.source)===null||o===void 0?void 0:o.subscribe(n))!==null&&s!==void 0?s:Xs},t}(Dn),Qe=function(e){pt(t,e);function t(n){var o=e.call(this)||this;return o._value=n,o}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(n){var o=e.prototype._subscribe.call(this,n);return!o.closed&&n.next(this._value),o},t.prototype.getValue=function(){var n=this,o=n.hasError,s=n.thrownError,u=n._value;if(o)throw s;return this._throwIfClosed(),u},t.prototype.next=function(n){e.prototype.next.call(this,this._value=n)},t}(Dn),wc={now:function(){return Date.now()}},kc=function(e){pt(t,e);function t(n,o){return e.call(this)||this}return t.prototype.schedule=function(n,o){return this},t}(sn),us={setInterval:function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return setInterval.apply(void 0,en([e,t],Bt(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},xc=function(e){pt(t,e);function t(n,o){var s=e.call(this,n,o)||this;return s.scheduler=n,s.work=o,s.pending=!1,s}return t.prototype.schedule=function(n,o){var s;if(o===void 0&&(o=0),this.closed)return this;this.state=n;var u=this.id,f=this.scheduler;return u!=null&&(this.id=this.recycleAsyncId(f,u,o)),this.pending=!0,this.delay=o,this.id=(s=this.id)!==null&&s!==void 0?s:this.requestAsyncId(f,this.id,o),this},t.prototype.requestAsyncId=function(n,o,s){return s===void 0&&(s=0),us.setInterval(n.flush.bind(n,this),s)},t.prototype.recycleAsyncId=function(n,o,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return o;o!=null&&us.clearInterval(o)},t.prototype.execute=function(n,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(n,o);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,o){var s=!1,u;try{this.work(n)}catch(f){s=!0,u=f||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),u},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,o=n.id,s=n.scheduler,u=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Er(u,this),o!=null&&(this.id=this.recycleAsyncId(s,o,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(kc),cs=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,o){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(o,n)},e.now=wc.now,e}(),Sc=function(e){pt(t,e);function t(n,o){o===void 0&&(o=cs.now);var s=e.call(this,n,o)||this;return s.actions=[],s._active=!1,s}return t.prototype.flush=function(n){var o=this.actions;if(this._active){o.push(n);return}var s;this._active=!0;do if(s=n.execute(n.state,n.delay))break;while(n=o.shift());if(this._active=!1,s){for(;n=o.shift();)n.unsubscribe();throw s}},t}(cs),Ec=new Sc(xc),Oc=Ec,Ic=new Te(function(e){return e.complete()});function Ac(e){return e&&be(e.schedule)}function ai(e){return e[e.length-1]}function Pc(e){return be(ai(e))?e.pop():void 0}function ui(e){return Ac(ai(e))?e.pop():void 0}function Cc(e,t){return typeof ai(e)=="number"?e.pop():t}var ci=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ta(e){return be(e==null?void 0:e.then)}function na(e){return be(e[si])}function ra(e){return Symbol.asyncIterator&&be(e==null?void 0:e[Symbol.asyncIterator])}function oa(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function jc(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ia=jc();function sa(e){return be(e==null?void 0:e[ia])}function aa(e){return uc(this,arguments,function(){var n,o,s,u;return Qs(this,function(f){switch(f.label){case 0:n=e.getReader(),f.label=1;case 1:f.trys.push([1,,9,10]),f.label=2;case 2:return[4,Yt(n.read())];case 3:return o=f.sent(),s=o.value,u=o.done,u?[4,Yt(void 0)]:[3,5];case 4:return[2,f.sent()];case 5:return[4,Yt(s)];case 6:return[4,f.sent()];case 7:return f.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function ua(e){return be(e==null?void 0:e.getReader)}function yt(e){if(e instanceof Te)return e;if(e!=null){if(na(e))return Tc(e);if(ci(e))return Dc(e);if(ta(e))return Rc(e);if(ra(e))return ca(e);if(sa(e))return Kc(e);if(ua(e))return Uc(e)}throw oa(e)}function Tc(e){return new Te(function(t){var n=e[si]();if(be(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Dc(e){return new Te(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function Rc(e){return new Te(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,ea)})}function Kc(e){return new Te(function(t){var n,o;try{for(var s=Zt(e),u=s.next();!u.done;u=s.next()){var f=u.value;if(t.next(f),t.closed)return}}catch(h){n={error:h}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}t.complete()})}function ca(e){return new Te(function(t){Bc(e,t).catch(function(n){return t.error(n)})})}function Uc(e){return ca(aa(e))}function Bc(e,t){var n,o,s,u;return ac(this,void 0,void 0,function(){var f,h;return Qs(this,function(y){switch(y.label){case 0:y.trys.push([0,5,6,11]),n=cc(e),y.label=1;case 1:return[4,n.next()];case 2:if(o=y.sent(),!!o.done)return[3,4];if(f=o.value,t.next(f),t.closed)return[2];y.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return h=y.sent(),s={error:h},[3,11];case 6:return y.trys.push([6,,9,10]),o&&!o.done&&(u=n.return)?[4,u.call(n)]:[3,8];case 7:y.sent(),y.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function St(e,t,n,o,s){o===void 0&&(o=0),s===void 0&&(s=!1);var u=t.schedule(function(){n(),s?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!s)return u}function la(e,t){return t===void 0&&(t=0),an(function(n,o){n.subscribe(nn(o,function(s){return St(o,e,function(){return o.next(s)},t)},function(){return St(o,e,function(){return o.complete()},t)},function(s){return St(o,e,function(){return o.error(s)},t)}))})}function fa(e,t){return t===void 0&&(t=0),an(function(n,o){o.add(e.schedule(function(){return n.subscribe(o)},t))})}function Nc(e,t){return yt(e).pipe(fa(t),la(t))}function Lc(e,t){return yt(e).pipe(fa(t),la(t))}function $c(e,t){return new Te(function(n){var o=0;return t.schedule(function(){o===e.length?n.complete():(n.next(e[o++]),n.closed||this.schedule())})})}function Mc(e,t){return new Te(function(n){var o;return St(n,t,function(){o=e[ia](),St(n,t,function(){var s,u,f;try{s=o.next(),u=s.value,f=s.done}catch(h){n.error(h);return}f?n.complete():n.next(u)},0,!0)}),function(){return be(o==null?void 0:o.return)&&o.return()}})}function da(e,t){if(!e)throw new Error("Iterable cannot be null");return new Te(function(n){St(n,t,function(){var o=e[Symbol.asyncIterator]();St(n,t,function(){o.next().then(function(s){s.done?n.complete():n.next(s.value)})},0,!0)})})}function qc(e,t){return da(aa(e),t)}function Fc(e,t){if(e!=null){if(na(e))return Nc(e,t);if(ci(e))return $c(e,t);if(ta(e))return Lc(e,t);if(ra(e))return da(e,t);if(sa(e))return Mc(e,t);if(ua(e))return qc(e,t)}throw oa(e)}function st(e,t){return t?Fc(e,t):yt(e)}function ht(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ui(e);return st(e,n)}function ls(e,t){var n=be(e)?e:function(){return e},o=function(s){return s.error(n())};return new Te(o)}var Wc=oi(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Jt(e,t){return new Promise(function(n,o){var s=new tn({next:function(u){n(u),s.unsubscribe()},error:o,complete:function(){o(new Wc)}});e.subscribe(s)})}function Vc(e){return e instanceof Date&&!isNaN(e)}function Kr(e,t){return an(function(n,o){var s=0;n.subscribe(nn(o,function(u){o.next(e.call(t,u,s++))}))})}var zc=Array.isArray;function Hc(e,t){return zc(t)?e.apply(void 0,en([],Bt(t))):e(t)}function ha(e){return Kr(function(t){return Hc(e,t)})}var Gc=Array.isArray,Yc=Object.getPrototypeOf,Jc=Object.prototype,Qc=Object.keys;function Xc(e){if(e.length===1){var t=e[0];if(Gc(t))return{args:t,keys:null};if(Zc(t)){var n=Qc(t);return{args:n.map(function(o){return t[o]}),keys:n}}}return{args:e,keys:null}}function Zc(e){return e&&typeof e=="object"&&Yc(e)===Jc}function el(e,t){return e.reduce(function(n,o,s){return n[o]=t[s],n},{})}function Or(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ui(e),o=Pc(e),s=Xc(e),u=s.args,f=s.keys;if(u.length===0)return st([],n);var h=new Te(tl(u,n,f?function(y){return el(f,y)}:Rr));return o?h.pipe(ha(o)):h}function tl(e,t,n){return n===void 0&&(n=Rr),function(o){fs(t,function(){for(var s=e.length,u=new Array(s),f=s,h=s,y=function(l){fs(t,function(){var g=st(e[l],t),b=!1;g.subscribe(nn(o,function(w){u[l]=w,b||(b=!0,h--),h||o.next(n(u.slice()))},function(){--f||o.complete()}))},o)},v=0;v<s;v++)y(v)},o)}}function fs(e,t,n){e?St(n,e,t):t()}function nl(e,t,n,o,s,u,f,h){var y=[],v=0,l=0,g=!1,b=function(){g&&!y.length&&!v&&t.complete()},w=function(K){return v<o?j(K):y.push(K)},j=function(K){v++;var N=!1;yt(n(K,l++)).subscribe(nn(t,function(q){t.next(q)},function(){N=!0},void 0,function(){if(N)try{v--;for(var q=function(){var G=y.shift();f||j(G)};y.length&&v<o;)q();b()}catch(G){t.error(G)}}))};return e.subscribe(nn(t,w,function(){g=!0,b()})),function(){}}function li(e,t,n){return n===void 0&&(n=1/0),be(t)?li(function(o,s){return Kr(function(u,f){return t(o,u,s,f)})(yt(e(o,s)))},n):(typeof t=="number"&&(n=t),an(function(o,s){return nl(o,s,e,n)}))}function rl(e){return e===void 0&&(e=1/0),li(Rr,e)}var ol=["addListener","removeListener"],il=["addEventListener","removeEventListener"],sl=["on","off"];function ot(e,t,n,o){if(be(n)&&(o=n,n=void 0),o)return ot(e,t,n).pipe(ha(o));var s=Bt(cl(e)?il.map(function(h){return function(y){return e[h](t,y,n)}}):al(e)?ol.map(ds(e,t)):ul(e)?sl.map(ds(e,t)):[],2),u=s[0],f=s[1];if(!u&&ci(e))return li(function(h){return ot(h,t,n)})(yt(e));if(!u)throw new TypeError("Invalid event target");return new Te(function(h){var y=function(){for(var v=[],l=0;l<arguments.length;l++)v[l]=arguments[l];return h.next(1<v.length?v:v[0])};return u(y),function(){return f(y)}})}function ds(e,t){return function(n){return function(o){return e[n](t,o)}}}function al(e){return be(e.addListener)&&be(e.removeListener)}function ul(e){return be(e.on)&&be(e.off)}function cl(e){return be(e.addEventListener)&&be(e.removeEventListener)}function ll(e,t,n){return n===void 0&&(n=Oc),new Te(function(o){var s=Vc(e)?1e3-n.now():e;s<0&&(s=0);var u=0;return n.schedule(function(){o.closed||(o.next(u++),o.complete())},s)})}function pa(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ui(e),o=Cc(e,1/0),s=e;return s.length?s.length===1?yt(s[0]):rl(o)(st(s,n)):Ic}function fl(e,t){return an(function(n,o){var s=0;n.subscribe(nn(o,function(u){return e.call(t,u,s++)&&o.next(u)}))})}function dl(e){e===void 0&&(e={});var t=e.connector,n=t===void 0?function(){return new Dn}:t,o=e.resetOnError,s=o===void 0?!0:o,u=e.resetOnComplete,f=u===void 0?!0:u,h=e.resetOnRefCountZero,y=h===void 0?!0:h;return function(v){var l,g,b,w=0,j=!1,K=!1,N=function(){g==null||g.unsubscribe(),g=void 0},q=function(){N(),l=b=void 0,j=K=!1},G=function(){var B=l;q(),B==null||B.unsubscribe()};return an(function(B,Q){w++,!K&&!j&&N();var ce=b=b??n();Q.add(function(){w--,w===0&&!K&&!j&&(g=Ao(G,y))}),ce.subscribe(Q),!l&&w>0&&(l=new tn({next:function(te){return ce.next(te)},error:function(te){K=!0,N(),g=Ao(q,s,te),ce.error(te)},complete:function(){j=!0,N(),g=Ao(q,f),ce.complete()}}),yt(B).subscribe(l))})(v)}}function Ao(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];if(t===!0){e();return}if(t!==!1){var s=new tn({next:function(){s.unsubscribe(),e()}});return yt(t.apply(void 0,en([],Bt(n)))).subscribe(s)}}var No=function(e,t){return No=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},No(e,t)};function un(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}No(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function ee(e,t,n,o){return new(n||(n=Promise))(function(s,u){function f(v){try{y(o.next(v))}catch(l){u(l)}}function h(v){try{y(o.throw(v))}catch(l){u(l)}}function y(v){var l;v.done?s(v.value):(l=v.value,l instanceof n?l:new n(function(g){g(l)})).then(f,h)}y((o=o.apply(e,[])).next())})}function ya(e,t){var n,o,s,u,f={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(y){return function(v){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;f;)try{if(n=1,o&&(s=2&l[0]?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[2&l[0],s.value]),l[0]){case 0:case 1:s=l;break;case 4:return f.label++,{value:l[1],done:!1};case 5:f.label++,o=l[1],l=[0];continue;case 7:l=f.ops.pop(),f.trys.pop();continue;default:if(s=f.trys,!((s=s.length>0&&s[s.length-1])||l[0]!==6&&l[0]!==2)){f=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){f.label=l[1];break}if(l[0]===6&&f.label<s[1]){f.label=s[1],s=l;break}if(s&&f.label<s[2]){f.label=s[2],f.ops.push(l);break}s[2]&&f.ops.pop(),f.trys.pop();continue}l=t.call(e,f)}catch(g){l=[6,g],o=0}finally{n=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([y,v])}}}function Ir(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cn(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o,s,u=n.call(e),f=[];try{for(;(t===void 0||t-- >0)&&!(o=u.next()).done;)f.push(o.value)}catch(h){s={error:h}}finally{try{o&&!o.done&&(n=u.return)&&n.call(u)}finally{if(s)throw s.error}}return f}function jn(e,t,n){if(arguments.length===2)for(var o,s=0,u=t.length;s<u;s++)!o&&s in t||(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}function Qt(e){return this instanceof Qt?(this.v=e,this):new Qt(e)}function hl(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,s=n.apply(e,t||[]),u=[];return o={},f("next"),f("throw"),f("return"),o[Symbol.asyncIterator]=function(){return this},o;function f(g){s[g]&&(o[g]=function(b){return new Promise(function(w,j){u.push([g,b,w,j])>1||h(g,b)})})}function h(g,b){try{(function(w){w.value instanceof Qt?Promise.resolve(w.value.v).then(y,v):l(u[0][2],w)})(s[g](b))}catch(w){l(u[0][3],w)}}function y(g){h("next",g)}function v(g){h("throw",g)}function l(g,b){g(b),u.shift(),u.length&&h(u[0][0],u[0][1])}}function pl(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ir(e),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(s){t[s]=e[s]&&function(u){return new Promise(function(f,h){(function(y,v,l,g){Promise.resolve(g).then(function(b){y({value:b,done:l})},v)})(f,h,(u=e[s](u)).done,u.value)})}}}function va(e){if(!e)throw new Error("Assertion Failed")}const yl={}.hasOwnProperty;function Ar(e,t,n){if(e&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){va(typeof n!="string"&&"length"in n);for(var o=0,s=t.length;o<s;++o)Ar(e,t[o],n[o])}else{var u=t.indexOf(".");if(u!==-1){var f=t.substr(0,u),h=t.substr(u+1);if(h==="")n===void 0?Array.isArray(e)?isNaN(parseInt(f))||e.splice(parseInt(f),1):delete e[f]:e[f]=n;else{var y=e[f];y&&function(v,l){return yl.call(v,l)}(e,f)||(y=e[f]={}),Ar(y,h,n)}}else n===void 0?Array.isArray(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}const ma=typeof self<"u"&&typeof crypto<"u"?(e,t=crypto.getRandomValues.bind(crypto))=>{const n=new Uint8Array(e);return t(n),self.btoa(String.fromCharCode.apply(null,n))}:typeof Buffer<"u"?(e,t=vl)=>{const n=Buffer.alloc(e);return t(n),n.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function vl(e){for(let t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}function fi(e){return typeof e=="string"||!!(Array.isArray(e)&&e.some(t=>fi(t))&&e.every(ba))}function ba(e){return typeof e=="string"||typeof e=="number"||Array.isArray(e)&&e.every(ba)}function ml(e,t,n){const o=e[t]||(e[t]={}),s=n.keys.map(u=>typeof u=="string"?u:JSON.stringify(u));switch(n.type){case"insert":case"upsert":s.forEach((u,f)=>{o[u]={type:"ups",val:n.values[f]}});break;case"update":case"modify":s.forEach((u,f)=>{const h=n.type==="update"?n.changeSpecs[f]:n.changeSpec,y=o[u];if(y)switch(y.type){case"ups":for(const[v,l]of Object.entries(h))Ar(y.val,v,l);break;case"del":break;case"upd":Object.assign(y.mod,h)}else o[u]={type:"upd",mod:h}});break;case"delete":s.forEach(u=>{o[u]={type:"del"}})}return e}function hs(e,t){for(const{table:n,muts:o}of t)for(const s of o)ml(e,n,s)}function Pe(e){return typeof e=="function"}function Ye(e){return function(t){if(function(n){return Pe(n==null?void 0:n.lift)}(t))return t.lift(function(n){try{return e(n,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}var ga=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function _a(e){return Pe(e==null?void 0:e.then)}var ps,fr,Po=(ps=function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}},(fr=ps(function(e){Error.call(e),e.stack=new Error().stack})).prototype=Object.create(Error.prototype),fr.prototype.constructor=fr,fr);function Lo(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Ur=function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var n,o,s,u,f;if(!this.closed){this.closed=!0;var h=this._parentage;if(h)if(this._parentage=null,Array.isArray(h))try{for(var y=Ir(h),v=y.next();!v.done;v=y.next())v.value.remove(this)}catch(K){n={error:K}}finally{try{v&&!v.done&&(o=y.return)&&o.call(y)}finally{if(n)throw n.error}}else h.remove(this);var l=this.initialTeardown;if(Pe(l))try{l()}catch(K){f=K instanceof Po?K.errors:[K]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var b=Ir(g),w=b.next();!w.done;w=b.next()){var j=w.value;try{ys(j)}catch(K){f=f??[],K instanceof Po?f=jn(jn([],Cn(f)),Cn(K.errors)):f.push(K)}}}catch(K){s={error:K}}finally{try{w&&!w.done&&(u=b.return)&&u.call(b)}finally{if(s)throw s.error}}}if(f)throw new Po(f)}},e.prototype.add=function(n){var o;if(n&&n!==this)if(this.closed)ys(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(o=this._finalizers)!==null&&o!==void 0?o:[]).push(n)}},e.prototype._hasParent=function(n){var o=this._parentage;return o===n||Array.isArray(o)&&o.includes(n)},e.prototype._addParent=function(n){var o=this._parentage;this._parentage=Array.isArray(o)?(o.push(n),o):o?[o,n]:n},e.prototype._removeParent=function(n){var o=this._parentage;o===n?this._parentage=null:Array.isArray(o)&&Lo(o,n)},e.prototype.remove=function(n){var o=this._finalizers;o&&Lo(o,n),n instanceof e&&n._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function wa(e){return e instanceof Ur||e&&"closed"in e&&Pe(e.remove)&&Pe(e.add)&&Pe(e.unsubscribe)}function ys(e){Pe(e)?e():e.unsubscribe()}Ur.EMPTY;var bl={Promise:void 0},gl={setTimeout:function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return setTimeout.apply(void 0,jn([e,t],Cn(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function ka(e){gl.setTimeout(function(){throw e})}function $o(){}var di=function(e){function t(n){var o=e.call(this)||this;return o.isStopped=!1,n?(o.destination=n,wa(n)&&n.add(o)):o.destination=wl,o}return un(t,e),t.create=function(n,o,s){return new Mo(n,o,s)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Ur),_l=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(o){dr(o)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(o){dr(o)}else dr(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){dr(n)}},e}(),Mo=function(e){function t(n,o,s){var u,f=e.call(this)||this;return Pe(n)||!n?u={next:n??void 0,error:o??void 0,complete:s??void 0}:u=n,f.destination=new _l(u),f}return un(t,e),t}(di);function dr(e){ka(e)}var wl={closed:!0,next:$o,error:function(e){throw e},complete:$o},hi=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Br(e){return e}var Xe=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,o){var s,u=this,f=(s=t)&&s instanceof di||function(h){return h&&Pe(h.next)&&Pe(h.error)&&Pe(h.complete)}(s)&&wa(s)?t:new Mo(t,n,o);return function(){var h=u,y=h.operator,v=h.source;f.add(y?y.call(f,v):v?u._subscribe(f):u._trySubscribe(f))}(),f},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var o=this;return new(n=vs(n))(function(s,u){var f=new Mo({next:function(h){try{t(h)}catch(y){u(y),f.unsubscribe()}},error:u,complete:s});o.subscribe(f)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[hi]=function(){return this},e.prototype.pipe=function(){for(var t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return((t=n).length===0?Br:t.length===1?t[0]:function(s){return t.reduce(function(u,f){return f(u)},s)})(this)},e.prototype.toPromise=function(t){var n=this;return new(t=vs(t))(function(o,s){var u;n.subscribe(function(f){return u=f},function(f){return s(f)},function(){return o(u)})})},e.create=function(t){return new e(t)},e}();function vs(e){var t;return(t=e??bl.Promise)!==null&&t!==void 0?t:Promise}function xa(e){return Pe(e[hi])}function Sa(e){return Symbol.asyncIterator&&Pe(e==null?void 0:e[Symbol.asyncIterator])}function Ea(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Oa=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ia(e){return Pe(e==null?void 0:e[Oa])}function Aa(e){return hl(this,arguments,function(){var t,n,o;return ya(this,function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Qt(t.read())];case 3:return n=s.sent(),o=n.value,n.done?[4,Qt(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Qt(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Pa(e){return Pe(e==null?void 0:e.getReader)}function Nt(e){if(e instanceof Xe)return e;if(e!=null){if(xa(e))return s=e,new Xe(function(u){var f=s[hi]();if(Pe(f.subscribe))return f.subscribe(u);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(ga(e))return o=e,new Xe(function(u){for(var f=0;f<o.length&&!u.closed;f++)u.next(o[f]);u.complete()});if(_a(e))return n=e,new Xe(function(u){n.then(function(f){u.closed||(u.next(f),u.complete())},function(f){return u.error(f)}).then(null,ka)});if(Sa(e))return ms(e);if(Ia(e))return t=e,new Xe(function(u){var f,h;try{for(var y=Ir(t),v=y.next();!v.done;v=y.next()){var l=v.value;if(u.next(l),u.closed)return}}catch(g){f={error:g}}finally{try{v&&!v.done&&(h=y.return)&&h.call(y)}finally{if(f)throw f.error}}u.complete()});if(Pa(e))return ms(Aa(e))}var t,n,o,s;throw Ea(e)}function ms(e){return new Xe(function(t){(function(n,o){var s,u,f,h;return ee(this,void 0,void 0,function(){var y,v;return ya(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),s=pl(n),l.label=1;case 1:return[4,s.next()];case 2:if((u=l.sent()).done)return[3,4];if(y=u.value,o.next(y),o.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return v=l.sent(),f={error:v},[3,11];case 6:return l.trys.push([6,,9,10]),u&&!u.done&&(h=s.return)?[4,h.call(s)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(f)throw f.error;return[7];case 10:return[7];case 11:return o.complete(),[2]}})})})(e,t).catch(function(n){return t.error(n)})})}function Ge(e,t,n,o,s){return new kl(e,t,n,o,s)}var kl=function(e){function t(n,o,s,u,f,h){var y=e.call(this,n)||this;return y.onFinalize=f,y.shouldUnsubscribe=h,y._next=o?function(v){try{o(v)}catch(l){n.error(l)}}:e.prototype._next,y._error=u?function(v){try{u(v)}catch(l){n.error(l)}finally{this.unsubscribe()}}:e.prototype._error,y._complete=s?function(){try{s()}catch(v){n.error(v)}finally{this.unsubscribe()}}:e.prototype._complete,y}return un(t,e),t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;e.prototype.unsubscribe.call(this),!o&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(di),xl=function(e){function t(n,o){return e.call(this)||this}return un(t,e),t.prototype.schedule=function(n,o){return this},t}(Ur),qo={setInterval:function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var s=qo.delegate;return s!=null&&s.setInterval?s.setInterval.apply(s,jn([e,t],Cn(n))):setInterval.apply(void 0,jn([e,t],Cn(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},Sl=function(e){function t(n,o){var s=e.call(this,n,o)||this;return s.scheduler=n,s.work=o,s.pending=!1,s}return un(t,e),t.prototype.schedule=function(n,o){if(o===void 0&&(o=0),this.closed)return this;this.state=n;var s=this.id,u=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(u,s,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(u,this.id,o),this},t.prototype.requestAsyncId=function(n,o,s){return s===void 0&&(s=0),qo.setInterval(n.flush.bind(n,this),s)},t.prototype.recycleAsyncId=function(n,o,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return o;qo.clearInterval(o)},t.prototype.execute=function(n,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(n,o);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,o){var s,u=!1;try{this.work(n)}catch(f){u=!0,s=f||new Error("Scheduled action threw falsy error")}if(u)return this.unsubscribe(),s},t.prototype.unsubscribe=function(){if(!this.closed){var n=this.id,o=this.scheduler,s=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Lo(s,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(xl),El={now:function(){return Date.now()}},bs=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,o){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(o,n)},e.now=El.now,e}(),pi=new(function(e){function t(n,o){o===void 0&&(o=bs.now);var s=e.call(this,n,o)||this;return s.actions=[],s._active=!1,s._scheduled=void 0,s}return un(t,e),t.prototype.flush=function(n){var o=this.actions;if(this._active)o.push(n);else{var s;this._active=!0;do if(s=n.execute(n.state,n.delay))break;while(n=o.shift());if(this._active=!1,s){for(;n=o.shift();)n.unsubscribe();throw s}}},t}(bs))(Sl),Ol=pi;function Ca(e){return e&&Pe(e.schedule)}function Il(e,t,n){e===void 0&&(e=0),n===void 0&&(n=Ol);var o=-1;return t!=null&&(Ca(t)?n=t:o=t),new Xe(function(s){var u,f=(u=e)instanceof Date&&!isNaN(u)?+e-n.now():e;f<0&&(f=0);var h=0;return n.schedule(function(){s.closed||(s.next(h++),0<=o?this.schedule(void 0,o):s.complete())},f)})}function ja(e){return Ca((t=e)[t.length-1])?e.pop():void 0;var t}function Et(e,t,n,o,s){o===void 0&&(o=0),s===void 0&&(s=!1);var u=t.schedule(function(){n(),s?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(u),!s)return u}function Fo(e){return Ye(function(t,n){var o,s=null,u=!1;s=t.subscribe(Ge(n,void 0,void 0,function(f){o=Nt(e(f,Fo(e)(t))),s?(s.unsubscribe(),s=null,o.subscribe(n)):u=!0})),u&&(s.unsubscribe(),s=null,o.subscribe(n))})}function gs(e,t){return t===void 0&&(t=0),Ye(function(n,o){n.subscribe(Ge(o,function(s){return Et(o,e,function(){return o.next(s)},t)},function(){return Et(o,e,function(){return o.complete()},t)},function(s){return Et(o,e,function(){return o.error(s)},t)}))})}function _s(e,t){return t===void 0&&(t=0),Ye(function(n,o){o.add(e.schedule(function(){return n.subscribe(o)},t))})}function ws(e,t){if(!e)throw new Error("Iterable cannot be null");return new Xe(function(n){Et(n,t,function(){var o=e[Symbol.asyncIterator]();Et(n,t,function(){o.next().then(function(s){s.done?n.complete():n.next(s.value)})},0,!0)})})}function Al(e,t){if(e!=null){if(xa(e))return function(n,o){return Nt(n).pipe(_s(o),gs(o))}(e,t);if(ga(e))return function(n,o){return new Xe(function(s){var u=0;return o.schedule(function(){u===n.length?s.complete():(s.next(n[u++]),s.closed||this.schedule())})})}(e,t);if(_a(e))return function(n,o){return Nt(n).pipe(_s(o),gs(o))}(e,t);if(Sa(e))return ws(e,t);if(Ia(e))return function(n,o){return new Xe(function(s){var u;return Et(s,o,function(){u=n[Oa](),Et(s,o,function(){var f,h,y;try{h=(f=u.next()).value,y=f.done}catch(v){return void s.error(v)}y?s.complete():s.next(h)},0,!0)}),function(){return Pe(u==null?void 0:u.return)&&u.return()}})}(e,t);if(Pa(e))return function(n,o){return ws(Aa(n),o)}(e,t)}throw Ea(e)}function it(e,t){return Ye(function(n,o){var s=0;n.subscribe(Ge(o,function(u){o.next(e.call(t,u,s++))}))})}function yi(e,t,n){return n===void 0&&(n=1/0),Pe(t)?yi(function(o,s){return it(function(u,f){return t(o,u,s,f)})(Nt(e(o,s)))},n):(typeof t=="number"&&(n=t),Ye(function(o,s){return function(u,f,h,y,v,l,g,b){var w=[],j=0,K=0,N=!1,q=function(){!N||w.length||j||f.complete()},G=function(Q){return j<y?B(Q):w.push(Q)},B=function(Q){l&&f.next(Q),j++;var ce=!1;Nt(h(Q,K++)).subscribe(Ge(f,function(te){v==null||v(te),l?G(te):f.next(te)},function(){ce=!0},void 0,function(){if(ce)try{j--;for(var te=function(){var pe=w.shift();g?Et(f,g,function(){return B(pe)}):B(pe)};w.length&&j<y;)te();q()}catch(pe){f.error(pe)}}))};return u.subscribe(Ge(f,G,function(){N=!0,q()})),function(){b==null||b()}}(o,s,e,n)}))}function Pl(){return(e=1)===void 0&&(e=1/0),yi(Br,e);var e}function ks(e,t){return t===void 0&&(t=pi),Ye(function(n,o){var s=null,u=null,f=null,h=function(){if(s){s.unsubscribe(),s=null;var v=u;u=null,o.next(v)}};function y(){var v=f+e,l=t.now();if(l<v)return s=this.schedule(void 0,v-l),void o.add(s);h()}n.subscribe(Ge(o,function(v){u=v,f=t.now(),s||(s=t.schedule(y,e),o.add(s))},function(){h(),o.complete()},void 0,function(){u=s=null}))})}function Wo(){for(var e,t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return Pl()((e=n,(t=ja(n))?Al(e,t):Nt(e)))}var Cl=new Xe(function(e){return e.complete()});function Ht(e){return e<=0?function(){return Cl}:Ye(function(t,n){var o=0;t.subscribe(Ge(n,function(s){++o<=e&&(n.next(s),e<=o&&n.complete())}))})}function Ta(e,t){return t?function(n){return Wo(t.pipe(Ht(1),Ye(function(o,s){o.subscribe(Ge(s,$o))})),n.pipe(Ta(e)))}:yi(function(n,o){return e(n,o).pipe(Ht(1),function(s){return it(function(){return s})}(n))})}function Da(e,t){t===void 0&&(t=pi);var n=Il(e,t);return Ta(function(){return n})}function Ra(e,t){return t===void 0&&(t=Br),e=e??jl,Ye(function(n,o){var s,u=!0;n.subscribe(Ge(o,function(f){var h=t(f);!u&&e(s,h)||(u=!1,s=h,o.next(f))}))})}function jl(e,t){return e===t}function rt(e,t){return Ye(function(n,o){var s=0;n.subscribe(Ge(o,function(u){return e.call(t,u,s++)&&o.next(u)}))})}function xs(e){return rt(function(t,n){return e<=n})}function Tl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ja(e);return Ye(function(o,s){(n?Wo(e,o,n):Wo(e,o)).subscribe(s)})}function Fe(e,t){return Ye(function(n,o){var s=null,u=0,f=!1,h=function(){return f&&!s&&o.complete()};n.subscribe(Ge(o,function(y){s==null||s.unsubscribe();var v=0,l=u++;Nt(e(y,l)).subscribe(s=Ge(o,function(g){return o.next(t?t(y,g,l,v++):g)},function(){s=null,h()}))},function(){f=!0,h()}))})}function Ss(e,t,n){var o=Pe(e)||t||n?{next:e,error:t,complete:n}:e;return o?Ye(function(s,u){var f;(f=o.subscribe)===null||f===void 0||f.call(o);var h=!0;s.subscribe(Ge(u,function(y){var v;(v=o.next)===null||v===void 0||v.call(o,y),u.next(y)},function(){var y;h=!1,(y=o.complete)===null||y===void 0||y.call(o),u.complete()},function(y){var v;h=!1,(v=o.error)===null||v===void 0||v.call(o,y),u.error(y)},function(){var y,v;h&&((y=o.unsubscribe)===null||y===void 0||y.call(o)),(v=o.finalize)===null||v===void 0||v.call(o)}))}):Br}function Ka(e,t){return ee(this,void 0,void 0,function*(){try{const n=yield navigator.serviceWorker.ready;if(t==="push"&&n.sync&&(yield n.sync.register(`dexie-cloud:${e.name}`)),!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return void n.active.postMessage({type:"dexie-cloud-sync",dbName:e.name,purpose:t})}catch{}})}function dt(e,t){e.cloud.usingServiceWorker?Ka(e,t):e.localSyncEvent.next({purpose:t})}const Ua=typeof Buffer<"u"?e=>Buffer.from(e,"base64"):e=>{const t=atob(e),n=t.length,o=new Uint8Array(n);for(var s=0;s<n;s++)o[s]=t.charCodeAt(s);return o},Rn=typeof Buffer<"u"?e=>ArrayBuffer.isView(e)?Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"):Buffer.from(e).toString("base64"):e=>{const t=ArrayBuffer.isView(e)?e:new Uint8Array(e),n=[];for(let o=0,s=t.length;o<s;o+=4096){const u=t.subarray(o,o+4096);n.push(String.fromCharCode.apply(null,u))}return btoa(n.join(""))};class Vo extends Error{constructor({title:t,message:n,messageCode:o,messageParams:s}){super(n),this.name="TokenErrorResponseError",this.title=t,this.messageCode=o,this.messageParams=s}}function Kn(e,t){return new Promise((n,o)=>{const s=Object.assign(Object.assign({submitLabel:"Submit",cancelLabel:"Cancel"},t),{onSubmit:u=>{e.next(void 0),n(u)},onCancel:()=>{e.next(void 0),o(new Se.AbortError("User cancelled"))}});e.next(s)})}function zo(e,t,...n){return Kn(e,{type:"message-alert",title:t,alerts:n,fields:{},submitLabel:"OK",cancelLabel:null})}function Es(e,t,n){return ee(this,void 0,void 0,function*(){let o=n||"";for(;!o||!/^[\w-+.]+@([\w-]+\.)+[\w-]{2,10}(\sas\s[\w-+.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(o);)o=(yield Kn(e,{type:"email",title:t,alerts:o?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return o})}function Os(e,t,n){return ee(this,void 0,void 0,function*(){const o=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:t}}];n&&o.push(n);const{otp:s}=yield Kn(e,{type:"otp",title:"Enter OTP",alerts:o,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return s})}function vi(e){var t,n,o;return ee(this,void 0,void 0,function*(){const s=yield e.getCurrentUser(),{accessToken:u,accessTokenExpiration:f,refreshToken:h,refreshTokenExpiration:y,claims:v}=s;if(!u)return null;if(((t=f==null?void 0:f.getTime())!==null&&t!==void 0?t:1/0)>Date.now()&&(((n=s.license)===null||n===void 0?void 0:n.status)||"ok")==="ok")return s;if(!h)throw new Error("Refresh token missing");if(((o=y==null?void 0:y.getTime())!==null&&o!==void 0?o:1/0)<=Date.now())throw new Error("Refresh token has expired");const l=yield Nr(e.cloud.options.databaseUrl,s);return yield e.table("$logins").update(v.sub,{accessToken:l.accessToken,accessTokenExpiration:l.accessTokenExpiration,claims:l.claims,license:l.license}),l})}function Dl(e,t,n,o,s){return ee(this,void 0,void 0,function*(){return t.accessToken&&t.accessTokenExpiration.getTime()>Date.now()?t:t.refreshToken&&(!t.refreshTokenExpiration||t.refreshTokenExpiration.getTime()>Date.now())?yield Nr(e,t):yield function(u,f,h,y){return ee(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:v,publicKey:l}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!v||!l)throw new Error("Could not generate RSA keypair");u.nonExportablePrivateKey=v;const g=function(b){const w=Rn(b);return function(j){let K=`-----BEGIN PUBLIC KEY-----
`;for(;j.length>0;)K+=j.substring(0,64)+`
`,j=j.substring(64);return K+="-----END PUBLIC KEY-----",K}(w)}(yield crypto.subtle.exportKey("spki",l));u.publicKey=l;try{const b=yield f({public_key:g,hints:y});if(b.type==="error")throw new Vo(b);if(b.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${b.type}`);return u.accessToken=b.accessToken,u.accessTokenExpiration=new Date(b.accessTokenExpiration),u.refreshToken=b.refreshToken,b.refreshTokenExpiration&&(u.refreshTokenExpiration=new Date(b.refreshTokenExpiration)),u.userId=b.claims.sub,u.email=b.claims.email,u.name=b.claims.name,u.claims=b.claims,u.license={type:b.userType,status:b.claims.license||"ok"},u.data=b.data,b.evalDaysLeft!=null&&(u.license.evalDaysLeft=b.evalDaysLeft),b.userValidUntil!=null&&(u.license.validUntil=new Date(b.userValidUntil)),b.alerts&&b.alerts.length>0&&(yield Kn(h,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:b.alerts})),u}catch(b){if(b instanceof Vo)throw yield zo(h,b.title,{type:"error",messageCode:b.messageCode,message:b.message,messageParams:{}}),b;let w="We're having a problem authenticating right now.";throw b instanceof TypeError&&(w=typeof navigator!==void 0&&!navigator.onLine?"You seem to be offline. Please connect to the internet and try again.":Se.debug||typeof location<"u"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")?`Could not connect to server. Please verify that your origin '${location.origin}' is whitelisted using \`npx dexie-cloud whitelist\``:"Could not connect to server. Please verify the connection.",yield zo(h,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:w,messageParams:{}}).catch(()=>{})),b}})}(t,n,o,s)})}function Nr(e,t){return ee(this,void 0,void 0,function*(){if(!t.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!t.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const n=Date.now(),o="RSASSA-PKCS1-v1_5",s=new TextEncoder().encode(t.refreshToken+n),u=yield crypto.subtle.sign(o,t.nonExportablePrivateKey,s),f=Rn(u),h={grant_type:"refresh_token",refresh_token:t.refreshToken,scopes:["ACCESS_DB"],signature:f,signing_algorithm:o,time_stamp:n},y=yield fetch(`${e}/token`,{body:JSON.stringify(h),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(y.status!==200)throw new Error(`RefreshToken: Status ${y.status} from ${e}/token`);const v=yield y.json();if(v.type==="error")throw new Vo(v);return t.accessToken=v.accessToken,t.accessTokenExpiration=v.accessTokenExpiration?new Date(v.accessTokenExpiration):void 0,t.claims=v.claims,t.license={type:v.userType,status:v.claims.license||"ok"},v.evalDaysLeft!=null&&(t.license.evalDaysLeft=v.evalDaysLeft),v.userValidUntil!=null&&(t.license.validUntil=new Date(v.userValidUntil)),v.data&&(t.data=v.data),t})}const Is=new WeakMap;class mi{constructor(t,n){Is.set(this,t),Object.assign(this,n)}static load(t,n){return t.table("$logins").get(n).then(o=>new mi(t,o||{userId:n,claims:{sub:n},lastLogin:new Date(0)}))}save(){return ee(this,void 0,void 0,function*(){Is.get(this).table("$logins").put(this)})}}const He={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(He),Object.freeze(He.claims)}catch{}function Ba(e,t){return Jt(st(e).pipe(fl(t)))}function Na(e){return ee(this,void 0,void 0,function*(){const t=yield Ho(e);if(t){if(!(yield function(n,o,s){return ee(this,void 0,void 0,function*(){const u=[{type:"warning",messageCode:"LOGOUT_CONFIRMATION",message:`{numUnsyncedChanges} unsynced changes will get lost!
                Logout anyway?`,messageParams:{currentUserId:o,numUnsyncedChanges:s.toString()}}];return yield Kn(n,{type:"logout-confirmation",title:"Confirm Logout",alerts:u,fields:{},submitLabel:"Confirm logout",cancelLabel:"Cancel"}).then(()=>!0).catch(()=>!1)})}(e.cloud.userInteraction,e.cloud.currentUserId,t)))throw new Error("User cancelled logout due to unsynced changes");yield Ho(e,{deleteUnsyncedData:!0})}})}function Ho(e,{deleteUnsyncedData:t=!1}={}){return ee(this,void 0,void 0,function*(){const[n,o]=yield e.dx.transaction("rw",e.dx.tables,s=>ee(this,void 0,void 0,function*(){const u=s.idbtrans;u.disableChangeTracking=!0,u.disableAccessControl=!0;const f=s.storeNames.filter(y=>y.endsWith("_mutations")),h=(yield Promise.all(f.map(y=>s.table(y).count()))).reduce((y,v)=>y+v,0);if(h>0&&!t)return[h,!1];e.$syncState.delete("syncState");for(const y of e.dx.tables)y.name!=="$jobs"&&y.name!=="$syncState"&&y.clear();return[h,!0]}));return o&&(yield Ba(e.cloud.currentUser,s=>s.userId===He.userId),yield e.cloud.sync({purpose:"pull",wait:!0})),n})}class Go extends Error{constructor(t,n){super(n||`${t.status} ${t.statusText}`),this.httpStatus=t.status}get name(){return"HttpError"}}function hr(e,...t){globalThis.console[e](...t)}function Co(e,t){var n;return ee(this,void 0,void 0,function*(){const o=yield e.getCurrentUser(),s=o.userId;if(o.isLoggedIn&&(!t||!t.email&&!t.userId)){if((((n=o.license)===null||n===void 0?void 0:n.status)||"ok")==="ok"&&o.accessToken&&(!o.accessTokenExpiration||o.accessTokenExpiration.getTime()>Date.now()))return!1;if(o.refreshToken&&(!o.refreshTokenExpiration||o.refreshTokenExpiration.getTime()>Date.now()))return yield vi(e),!1}const u=new mi(e,{claims:{},lastLogin:new Date(0)});return yield Dl(e.cloud.options.databaseUrl,u,e.cloud.options.fetchTokens||function(f){const{userInteraction:h}=f.cloud;return function({public_key:y,hints:v}){var l;return ee(this,void 0,void 0,function*(){let g;const b=(l=f.cloud.options)===null||l===void 0?void 0:l.databaseUrl;if(!b)throw new Error("No database URL given.");if((v==null?void 0:v.grant_type)==="demo")g={demo_user:yield Es(h,"Enter a demo user email",(v==null?void 0:v.email)||(v==null?void 0:v.userId)),grant_type:"demo",scopes:["ACCESS_DB"],public_key:y};else if(v!=null&&v.otpId&&v.otp)g={grant_type:"otp",otp_id:v.otpId,otp:v.otp,scopes:["ACCESS_DB"],public_key:y};else{const K=yield Es(h,"Enter email address",v==null?void 0:v.email);g=/@demo.local$/.test(K)?{demo_user:K,grant_type:"demo",scopes:["ACCESS_DB"],public_key:y}:{email:K,grant_type:"otp",scopes:["ACCESS_DB"]}}const w=yield fetch(`${b}/token`,{body:JSON.stringify(g),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(w.status!==200){const K=yield w.text();throw yield zo(h,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:K,messageParams:{}}).catch(()=>{}),new Go(w,K)}const j=yield w.json();if(j.type==="tokens"||j.type==="error")return j;if(g.grant_type==="otp"&&"email"in g){if(j.type!=="otp-sent")throw new Error(`Unexpected response from ${b}/token`);const K=yield Os(h,g.email),N=Object.assign(Object.assign({},g),{otp:K||"",otp_id:j.otp_id,public_key:y});let q=yield fetch(`${b}/token`,{body:JSON.stringify(N),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;q.status===401;){const G=yield q.text();N.otp=yield Os(h,g.email,{type:"error",messageCode:"INVALID_OTP",message:G,messageParams:{}}),q=yield fetch(`${b}/token`,{body:JSON.stringify(N),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(q.status!==200){const G=yield q.text();throw new Go(q,G)}return yield q.json()}throw new Error(`Unexpected response from ${b}/token`)})}}(e),e.cloud.userInteraction,t),s!==He.userId&&u.userId!==s&&(yield Na(e)),yield function(f,h){return ee(this,void 0,void 0,function*(){if(h.userId===f.cloud.currentUserId)return;const y=f.table("$logins");yield f.transaction("rw",y,v=>ee(this,void 0,void 0,function*(){const l=yield y.toArray();yield Promise.all(l.filter(g=>g.userId!==h.userId&&g.isLoggedIn).map(g=>(g.isLoggedIn=!1,y.put(g)))),h.isLoggedIn=!0,h.lastLogin=new Date;try{yield h.save()}catch(g){try{g.name==="DataCloneError"&&(hr("debug","Login context property names:",Object.keys(h)),hr("debug","Login context property names:",Object.keys(h)),hr("debug","Login context:",h),hr("debug","Login context JSON:",JSON.stringify(h)))}catch{}throw g}})),yield Ba(f.cloud.currentUser,v=>v.userId===h.userId)})}(e,u),dt(e,"pull"),u.userId!==s})}const Yo={},On=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;On&&On.ready.then(e=>Yo.registration=e),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",e=>{var t,n;!((n=(t=e.data)===null||t===void 0?void 0:t.type)===null||n===void 0)&&n.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(o=>{var s;return o.id!==((s=e.source)===null||s===void 0?void 0:s.id)&&o.postMessage(e.data)})});class jo{constructor(t){this.name=t}subscribe(t){if(!On)return()=>{};const n=o=>{var s;((s=o.data)===null||s===void 0?void 0:s.type)===`sw-broadcast-${this.name}`&&t(o.data.message)};return On.addEventListener("message",n),()=>On.removeEventListener("message",n)}postMessage(t){var n;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(o=>o.postMessage({type:`sw-broadcast-${this.name}`,message:t})):Yo.registration&&((n=Yo.registration.active)===null||n===void 0||n.postMessage({type:`sw-broadcast-${this.name}`,message:t}))}}const xn=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class pr extends Te{constructor(t){const n=typeof BroadcastChannel>"u"?new jo(t):new BroadcastChannel(t);super(o=>{function s(h){o.next(h.detail)}function u(h){o.next(h.data)}let f;(function(h,y){xn.has(h)?xn.get(h).push(y):xn.set(h,[y])})(`lbc-${t}`,s);try{n instanceof jo?f=n.subscribe(h=>o.next(h)):n.addEventListener("message",u)}catch{}return()=>{(function(h,y){const v=xn.get(h);if(v){const l=v.indexOf(y);l!==-1&&v.splice(l,1)}})(`lbc-${t}`,s),n instanceof jo?f():n.removeEventListener("message",u)}}),this.name=t,this.bc=n}next(t){this.bc.postMessage(t),function(n){const o=xn.get(n.type);o&&o.forEach(s=>{try{s(n)}catch{}})}(new CustomEvent(`lbc-${this.name}`,{detail:t}))}}function Jo({realms:e,inviteRealms:t}){return ee(this,void 0,void 0,function*(){const n=JSON.stringify([...e.map(u=>({realmId:u,accepted:!0})),...t.map(u=>({realmId:u,accepted:!1}))].sort((u,f)=>u.realmId<f.realmId?-1:u.realmId>f.realmId?1:0)),o=new TextEncoder().encode(n),s=yield crypto.subtle.digest("SHA-1",o);return Rn(s)})}function wr(e){return Object.entries(e.cloud.schema||{}).filter(([,{markedForSync:t}])=>t).map(([t])=>e.tables.filter(({name:n})=>n===t)[0]).filter(t=>t)}function bi(e){return`$${e}_mutations`}function La(e){var t;const n=(t=/^\$(.*)_mutations$/.exec(e))===null||t===void 0?void 0:t[1];if(!n)throw new Error(`Given mutationTable ${e} is not correct`);return n}const Rl=[].concat;function $a(e){return Rl.apply([],e)}function Qo(e,t,{since:n={},limit:o=1/0}={}){return ee(this,void 0,void 0,function*(){const s=$a(yield Promise.all(e.map(y=>ee(this,void 0,void 0,function*(){const v=La(y.name),l=n[v];let g=l?y.where("rev").above(l):y;return o<1/0&&(g=g.limit(o)),(yield g.toArray()).map(b=>({table:v,mut:b}))})))).sort((y,v)=>y.mut.txid===v.mut.txid?y.mut.opNo-v.mut.opNo:y.mut.ts-v.mut.ts),u=[];let f=null,h=null;for(const{table:y,mut:v}of s)f&&f.table===y&&h===v.txid?f.muts.push(v):(f={table:y,muts:[v]},h=v.txid,u.push(f));return u})}function Ma(e){const t=new Uint8Array(e);if(typeof crypto<"u")crypto.getRandomValues(t);else for(let n=0;n<e;n++)t[n]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(t).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,t));throw new Error("No btoa or Buffer available")}const{toString:Kl}={},As={replace:function(e){const t=Object.keys(e);let n=null;for(let s=0,u=t.length;s<u;++s)t[s][0]==="$"&&(n=n||[],n.push(t[s]));if(!n)return e;const o={...e};for(const s of n)delete o[s];for(const s of n)o["$"+s]=e[s];return o}};function qa(...e){const t=e.reduce((o,s)=>({...o,...s}),e.reduce((o,s)=>({...s,...o}),{})),n=new WeakMap;return{stringify(o,s,u){return JSON.stringify(o,function(h){const y=this[h],v=function(l){const g=typeof l;switch(typeof l){case"object":case"function":{if(l===null)return null;const w=Object.getPrototypeOf(l);if(!w)return As;let j=n.get(w);if(j!==void 0)return j;const K=(b=l,Kl.call(b).slice(8,-1)),N=Object.entries(t).find(([q,G])=>{var B,Q;return(Q=(B=G==null?void 0:G.test)===null||B===void 0?void 0:B.call(G,l,K))!==null&&Q!==void 0?Q:q===K});return j=N==null?void 0:N[1],j||(j=Array.isArray(l)?null:typeof l=="function"?t.function||null:As),n.set(w,j),j}default:return t[g]}var b}(y);return v?v.replace(y,s,t):y},u)},parse(o,s){const u=[];return JSON.parse(o,function(f,h){const y=h==null?void 0:h.$t;if(y){const l=t[y];h=l?l.revive(h,s,t):h}let v=u[u.length-1];if(v&&v[0]===h){h={...h};for(const l of v[1])delete h[l];for(const[l,g]of Object.entries(v[2]))h[l]=g;u.pop()}if(h===void 0||f[0]==="$"&&f!=="$t"){let l,g;v=u[u.length-1],v&&v[0]===this?(l=v[1],g=v[2]):u.push([this,l=[],g={}]),f[0]==="$"&&f!=="$t"?(l.push(f),g[f.substr(1)]=h):g[f]=void 0}return h})}}}const Ul={Blob:{test:(e,t)=>t==="Blob",replace:(e,t)=>{const n=t.length;return t.push(e),{$t:"Blob",mimeType:e.type,i:n}},revive:({i:e,mimeType:t},n)=>new Blob([n[e]],{type:t})}};var Bl={number:{replace:e=>{switch(!0){case isNaN(e):return{$t:"number",v:"NaN"};case e===1/0:return{$t:"number",v:"Infinity"};case e===-1/0:return{$t:"number",v:"-Infinity"};default:return e}},revive:({v:e})=>Number(e)}};const Nl={bigint:{replace:e=>({$t:"bigint",v:""+e}),revive:e=>BigInt(e.v)}};var Ll={Date:{replace:e=>({$t:"Date",v:isNaN(e.getTime())?"NaN":e.toISOString()}),revive:({v:e})=>new Date(e==="NaN"?NaN:Date.parse(e))}},$l={Set:{replace:e=>({$t:"Set",v:Array.from(e.entries())}),revive:({v:e})=>new Set(e)}},Ml={Map:{replace:e=>({$t:"Map",v:Array.from(e.entries())}),revive:({v:e})=>new Map(e)}};const ql=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0;var Fl=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((e,t)=>({...e,[t]:{replace:(n,o,s)=>({$t:t,v:s.ArrayBuffer.replace(n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),o,s).v}),revive:({v:n},o,s)=>{const u=ql[t];return u&&new u(s.ArrayBuffer.revive({v:n},o,s))}}}),{});function Fa(e){return function(t){for(var n="",o=0,s=t.length;o<s;o++)n+=Wa[t[o]];return n}(Rn(e))}function Wl(e){return Ua(function(t){if(typeof t!="string")throw new Error("invalid decoder input: "+t);for(var n="",o=0,s=t.length;o<s;o++)n+=Xo[t[o]];return n}(e))}const Xo={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Wa={};for(const e of Object.keys(Xo))Wa[Xo[e]]=e;var Vl={ArrayBuffer:{replace:e=>({$t:"ArrayBuffer",v:Fa(e)}),revive:({v:e})=>{const t=Wl(e);return t.buffer.byteLength===t.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}}};class To{constructor(t,n){this.buf=t,this.type=n}}function zl(e){const t=new XMLHttpRequest;if(t.overrideMimeType("text/plain; charset=x-user-defined"),t.open("GET",URL.createObjectURL(e),!1),t.send(),t.status!==200&&t.status!==0)throw new Error("Bad Blob access: "+t.status);return t.responseText}function Hl(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}var Gl={Blob:{test:(e,t)=>t==="Blob"||e instanceof To,replace:e=>({$t:"Blob",v:Rn(e instanceof To?e.buf:Hl(zl(e))),type:e.type}),revive:({type:e,v:t})=>{const n=Ua(t);return typeof Blob!==void 0?new Blob([n]):new To(n.buffer,e)}}};const Va={...Bl,...Nl,...Ll,...$l,...Ml,...Fl,...Vl,...Gl};function Ps(e){return new Promise((t,n)=>{const o=new FileReader;o.onabort=s=>n(new Error("file read aborted")),o.onerror=s=>n(s.target.error),o.onload=s=>t(s.target.result),o.readAsArrayBuffer(e)})}var Yl={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}};const Jl=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class Cs{toString(){return this.v}constructor(t){this.v=t}}const Ql=Jl?{}:{bigint:{test:e=>e instanceof Cs,replace:e=>Object.assign({$t:"bigint"},e),revive:({v:e})=>new Cs(e)}},za=Object.assign(Object.assign(Object.assign({},Yl),Ql),{PropModification:{test:e=>e instanceof rs,replace:e=>Object.assign({$t:"PropModification"},e["@@propmod"]),revive:e=>{var t=function(n,o){var s={};for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&o.indexOf(u)<0&&(s[u]=n[u]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var f=0;for(u=Object.getOwnPropertySymbols(n);f<u.length;f++)o.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(n,u[f])&&(s[u[f]]=n[u[f]])}return s}(e,["$t"]);return new rs(t)}}}),Pr=qa(Va,za),Xl=function(...e){const t=qa(Va,Ul,...e);return{toBinary(n){const[o,s]=this.stringify(n),u=new ArrayBuffer(4);return new DataView(u).setUint32(0,o.size),new Blob([u,o,s])},stringify(n){const o=[],s=t.stringify(n,o);return[new Blob(o.map(f=>{const h=new ArrayBuffer(4);return new DataView(h).setUint32(0,"byteLength"in f?f.byteLength:f.size),new Blob([h,f])})),s]},async parse(n,o){let s=0;const u=[],f=await Ps(o),h=new DataView(f);for(;s<f.byteLength;){const y=h.getUint32(s);s+=4;const v=f.slice(s,s+y);s+=y,u.push(v)}return t.parse(n,u)},async fromBinary(n){const o=new DataView(await Ps(n.slice(0,4))).getUint32(0),s=n.slice(4,o+4),u=await function(f){return new Promise((h,y)=>{const v=new FileReader;v.onabort=l=>y(new Error("file read aborted")),v.onerror=l=>y(l.target.error),v.onload=l=>h(l.target.result),v.readAsText(f)})}(n.slice(o+4));return await this.parse(u,s)}}}(za);function Zl(e,t,n){const o=[];for(let s of n){const{table:u,muts:f}=s,h=e.tables.find(l=>l.name===u);if(!h)throw new Error(`Internal error: table ${u} not found in DBCore schema`);const{primaryKey:y}=h;let v=s;f.forEach((l,g)=>{const b=!y.outbound&&(l.type==="upsert"||l.type==="insert");l.keys.forEach((w,j)=>{if(Array.isArray(w)){v===s&&(v=js(s,b));const K=v.muts[g],N=JSON.stringify(w);K.keys[j]=N}else if(w[0]==="#"){v===s&&(v=js(s,b));const K=v.muts[g];if(!t.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const N=`${w}:${t.userId}`;K.keys[j]=N,b&&Se.setByKeyPath(K.values[j],y.keyPath,N)}})}),o.push(v)}return o}function js(e,t){return Object.assign(Object.assign({},e),{muts:t?e.muts.map(n=>n.type!=="insert"&&n.type!=="upsert"||!n.values?Object.assign(Object.assign({},n),{keys:n.keys.slice()}):Object.assign(Object.assign({},n),{keys:n.keys.slice(),values:n.values.slice()})):e.muts.map(n=>Object.assign(Object.assign({},n),{keys:n.keys.slice()}))})}let Zo=new WeakMap;function Ha(e){var t,n;return ee(this,void 0,void 0,function*(){const o=((n=(t=Zo.get(e))===null||t===void 0?void 0:t.getTime())!==null&&n!==void 0?n:0)-Date.now();o>0&&(yield new Promise(s=>setTimeout(s,o)))})}function ef(e,t,n,o,s,u,f,h){return ee(this,void 0,void 0,function*(){const y={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},v=yield vi(o),l=v==null?void 0:v.accessToken;l&&(y.Authorization=`Bearer ${l}`);const g={v:2,dbID:t==null?void 0:t.remoteDbId,clientIdentity:f,schema:u||{},lastPull:t?{serverRevision:t.serverRevision,realms:t.realms,inviteRealms:t.inviteRealms}:void 0,baseRevs:n,changes:Zl(o.dx.core.schema,h,e)};o.syncStateChangedEvent.next({phase:"pushing"});const b=yield fetch(`${s}/sync`,{method:"post",headers:y,credentials:"include",body:Pr.stringify(g)});if(o.syncStateChangedEvent.next({phase:"pulling"}),function(w,j){const K=j.headers.get("Ratelimit-Limit"),N=j.headers.get("Ratelimit-Remaining"),q=j.headers.get("Ratelimit-Reset");if(K&&N&&q){const G=Number(K),B=Math.max(0,Number(N)),Q=Number(q);if(B<G/2){const ce=Math.ceil(Q/(B+1));Zo.set(w,new Date(Date.now()+1e3*ce))}else Zo.delete(w)}}(o,b),!b.ok)throw new Go(b);if(b.headers.get("content-type")==="application/x-bison")return Xl.fromBinary(yield b.blob());{const w=yield b.text();return Pr.parse(w)}})}function Sn(e){if(e!=null&&e.cancelled)throw new Se.AbortError("Operation was cancelled")}let Xt=!1;function Ga(e,t,n,o){return ee(this,void 0,void 0,function*(){yield e.$baseRevs.bulkPut(Object.keys(t).filter(s=>t[s].markedForSync).map(s=>({tableName:s,clientRev:(n[s]||0)+1,serverRev:o}))),yield e.$baseRevs.where("tableName").noneOf(Object.keys(t).filter(s=>t[s].markedForSync)).delete()})}function ei(e,t={}){for(const{table:n,muts:o}of e){const s=o.length>0?o[o.length-1].rev:null;t[n]=s||t[n]||0}return t}function tf(e,t,n){return ee(this,void 0,void 0,function*(){const o=yield e.bulkGet(t),s=[],u=[];t.forEach((f,h)=>{const y=o[h];if(y){for(const[v,l]of Object.entries(n[h]))if(v===e.schema.primKey.keyPath){if(sc(l,f)!==0)throw new Error("Cannot change primary key")}else Se.setByKeyPath(y,v,l);s.push(f),u.push(y)}}),yield e.schema.primKey.keyPath==null?e.bulkPut(u,s):e.bulkPut(u)})}function Ya(e,t){return ee(this,void 0,void 0,function*(){for(const{table:n,muts:o}of e){const s=t.table(n);if(!s)continue;const{primaryKey:u}=s.core.schema,f=h=>{switch(h[0]){case"[":if(h.endsWith("]"))try{return JSON.parse(h)}catch{}return h;case"#":return h.endsWith(":"+t.cloud.currentUserId)?h.substr(0,h.length-t.cloud.currentUserId.length-1):h;default:return h}};for(const h of o){const y=h.keys.map(f);switch(h.type){case"insert":u.outbound?yield s.bulkAdd(h.values,y):(y.forEach((v,l)=>{Se.setByKeyPath(h.values[l],u.keyPath,v)}),yield s.bulkAdd(h.values));break;case"upsert":u.outbound?yield s.bulkPut(h.values,y):(y.forEach((v,l)=>{Se.setByKeyPath(h.values[l],u.keyPath,v)}),yield s.bulkPut(h.values));break;case"modify":y.length===1?yield s.update(y[0],h.changeSpec):yield s.where(":id").anyOf(y).modify(h.changeSpec);break;case"update":yield tf(s,y,h.changeSpecs);break;case"delete":yield s.bulkDelete(y)}}}})}typeof self<"u"&&typeof navigator<"u"&&(Xt=navigator.onLine,self.addEventListener("online",()=>Xt=!0),self.addEventListener("offline",()=>Xt=!1));const nf="currentSyncWorker";function Tn(e,t,n,o){return Ja.apply(this,arguments).then(s=>(o!=null&&o.justCheckIfNeeded||e.syncStateChangedEvent.next({phase:"in-sync"}),s)).catch(s=>ee(this,void 0,void 0,function*(){return o!=null&&o.justCheckIfNeeded?Promise.reject(s):Xt&&(o!=null&&o.retryImmediatelyOnFetchError)&&(s==null?void 0:s.name)==="TypeError"&&/fetch/.test(s==null?void 0:s.message)?(e.syncStateChangedEvent.next({phase:"error",error:s}),yield new Promise(u=>setTimeout(u,500)),yield Tn(e,t,n,Object.assign(Object.assign({},o),{retryImmediatelyOnFetchError:!1}))):(yield e.$syncState.update("syncState",{timestamp:new Date,error:""+s}),e.syncStateChangedEvent.next({phase:Xt?"error":"offline",error:new Error(""+(s==null?void 0:s.message)||s)}),Promise.reject(s))}))}function Ja(e,t,n,{isInitialSync:o,cancelToken:s,justCheckIfNeeded:u,purpose:f}={isInitialSync:!1}){var h;return ee(this,void 0,void 0,function*(){if(!(!((h=e.cloud.options)===null||h===void 0)&&h.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:y}=t,v=yield e.getCurrentUser(),l=v.isLoggedIn?wr(e):[],g=l.map(ge=>e.table(bi(ge.name))),b=yield e.getPersistedSyncState(),w=!o&&v.isLoggedIn,j=w?function(ge,ve){const Z=(ve==null?void 0:ve.syncedTables)||[];return wr(ge).filter(oe=>!Z.includes(oe.name))}(e,b):[];Sn(s);const K=j.length>0;if(K){if(u)return!0;yield e.transaction("rw",j,ge=>ee(this,void 0,void 0,function*(){ge.idbtrans.disableChangeTracking=!0,ge.idbtrans.disableAccessControl=!0,yield function(ve,Z,oe){return ee(this,void 0,void 0,function*(){const ue=new Set(oe||[]);for(const Y of ve)Y.name==="members"?yield Y.toCollection().modify(z=>{ue.has(z.realmId)||z.userId&&z.userId!==He.userId||(z.userId=Z.userId)}):Y.name==="roles"||(Y.name==="realms"?yield Y.toCollection().modify(z=>{ue.has(z.realmId)||z.owner!==void 0&&z.owner!==He.userId||(z.owner=Z.userId)}):yield Y.toCollection().modify(z=>{z.realmId&&ue.has(z.realmId)||(z.owner&&z.owner!==He.userId||(z.owner=Z.userId),z.realmId&&z.realmId!==He.userId||(z.realmId=Z.userId))}))})}(j,v,b==null?void 0:b.realms)})),Sn(s)}const[N,q,G]=yield e.transaction("r",e.tables,()=>ee(this,void 0,void 0,function*(){const ge=yield e.getPersistedSyncState();let ve=yield e.$baseRevs.toArray();ve=ve.filter(oe=>l.some(ue=>ue.name===oe.tableName));let Z=yield Qo(g);if(Sn(s),K){const oe=[...(b==null?void 0:b.realms)||[],...(b==null?void 0:b.inviteRealms)||[]],ue=yield function(Y,z,re,de){return ee(this,void 0,void 0,function*(){const Ee=`upload-${Ma(8)}`;if(z.isLoggedIn&&Y.length>0){const Oe=new Set(de||[]);return(yield Promise.all(Y.map(_e=>ee(this,void 0,void 0,function*(){const{extractKey:ke}=_e.core.schema.primaryKey;if(!ke)return{table:_e.name,muts:[]};const Ue=re[_e.name],We=Ue!=null&&Ue.generatedGlobalId?_e.filter(Me=>{return ke(Me),!Oe.has(Me.realmId||"")&&(De=ke(Me),!(at=Ue==null?void 0:Ue.idPrefix)||typeof De=="string"&&De.startsWith(at));var De,at}):_e.filter(Me=>{const De=ke(Me);return!Oe.has(Me.realmId||"")&&fi(De)}),$e=yield We.toArray();if($e.length>0){const Me={type:"upsert",values:$e,keys:$e.map(ke),userId:z.userId,txid:Ee};return{table:_e.name,muts:[Me]}}return{table:_e.name,muts:[]}})))).filter(_e=>_e.muts.length>0)}return[]})}(j,v,n,oe);return Sn(s),Z=Z.concat(ue),[Z,ge,ve]}return[Z,ge,ve]})),B=N.some(ge=>ge.muts.some(ve=>ve.keys.length>0));if(u)return B;if(f==="push"&&!B)return!1;const Q=ei(N,q==null?void 0:q.latestRevisions),ce=(q==null?void 0:q.clientIdentity)||ma(16);Sn(s);const te=yield ef(N,q,G,e,y,n,ce,v);return(yield e.transaction("rw",e.tables,ge=>ee(this,void 0,void 0,function*(){ge.idbtrans.disableChangeTracking=!0,ge.idbtrans.disableAccessControl=!0;for(const Y of Object.keys(n))te.schema[Y]&&(n[Y]=te.schema[Y]);yield e.$syncState.put(n,"schema");const ve=yield Qo(g,0,{since:Q});for(const Y of g){const z=La(Y.name);if(ve.some(re=>re.table===z&&re.muts.length>0)){if(Q[z]){const re=Q[z]||0;yield Promise.all([Y.where("rev").belowOrEqual(re).delete(),e.$baseRevs.where(":id").between([z,-1/0],[z,re+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([Y.clear(),e.$baseRevs.where({tableName:z}).delete()])}ei(ve,Q),yield Ga(e,n,Q,te.serverRevision);const Z=yield e.getPersistedSyncState();yield function(Y,z,re){return ee(this,void 0,void 0,function*(){const de=new Set,Ee=new Set,Oe=re?re.realms:[],_e=re?re.inviteRealms:[],ke=new Set(z.realms),Ue=new Set(z.realms.concat(z.inviteRealms));for(const We of Oe)ke.has(We)||(Ee.add(We),Ue.has(We)||de.add(We));for(const We of _e.concat(Oe))Ue.has(We)||de.add(We);if(de.size>0||Ee.size>0){const We=wr(Y);for(const $e of We){let Me=["realms","members","roles"].includes($e.name)?de:Ee;Me.size!==0&&($e.schema.indexes.some(De=>De.keyPath==="realmId"||Array.isArray(De.keyPath)&&De.keyPath[0]==="realmId")?yield $e.where("realmId").anyOf([...Me]).delete():yield $e.filter(De=>!!(De!=null&&De.realmId)&&Me.has(De.realmId)).delete())}}})}(e,te,Z);const oe=Z||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:ce};w&&(oe.syncedTables=l.map(Y=>Y.name).concat(j.map(Y=>Y.name))),oe.latestRevisions=Q,oe.remoteDbId=te.dbId,oe.initiallySynced=!0,oe.realms=te.realms,oe.inviteRealms=te.inviteRealms,oe.serverRevision=te.serverRevision,oe.timestamp=new Date,delete oe.error;const ue=Qa(te.changes,ve);return yield Ya(ue,e),e.$syncState.put(oe,"syncState"),ve.length===0})))?(e.syncCompleteEvent.next(),!1):(yield Ha(e),yield Ja(e,t,n,{isInitialSync:o,cancelToken:s}))})}function Qa(e,t){const n={};hs(n,e);const o={};return hs(o,t),function(s,u){var f,h,y;for(const[v,l]of Object.entries(u))for(const[g,b]of Object.entries(l))switch(b.type){case"ups":{const w=(f=s[v])===null||f===void 0?void 0:f[g];if(w)switch(w.type){case"ups":case"upd":delete s[v][g]}}break;case"del":(h=s[v])===null||h===void 0||delete h[g];break;case"upd":{const w=(y=s[v])===null||y===void 0?void 0:y[g];if(w)switch(w.type){case"ups":for(const[j,K]of Object.entries(b.mod))Ar(w.val,j,K);break;case"del":break;case"upd":for(const j of Object.keys(b.mod))delete w.mod[j]}break}}}(n,o),function(s,u=""){u||(u=ma(16));const f={};for(const[y,v]of Object.entries(s))for(const[l,g]of Object.entries(v)){const b=f[y]||(f[y]={});(b[g.type]||(b[g.type]=[])).push(Object.assign({key:l},g))}const h=[];for(const[y,v]of Object.entries(f)){const l={table:y,muts:[]};for(const[g,b]of Object.entries(v))switch(g){case"ups":{const w={type:"upsert",keys:b.map(j=>j.key),values:b.map(j=>j.val),txid:u};l.muts.push(w);break}case"upd":{const w={type:"update",keys:b.map(j=>j.key),changeSpecs:b.map(j=>j.mod),txid:u};l.muts.push(w);break}case"del":{const w={type:"delete",keys:b.map(j=>j.key),txid:u};l.muts.push(w);break}}h.push(l)}return h}(n)}const rf=10,of=1e4,sf=1e3;function af(e){const t=[],n=new Qe(!0),o=new Qe(null);let s=!1,u=new Array(rf).fill(0);return o.subscribe(()=>ee(this,void 0,void 0,function*(){if(!s&&t.length>0){s=!0,u.shift(),u.push(Date.now()),n.next(!1);try{yield function(){var f,h,y,v,l,g;return ee(this,void 0,void 0,function*(){for(;t.length>0;){const b=t.shift();try{yield Jt(e.cloud.syncState.pipe(rt(({phase:j})=>j==="in-sync"||j==="error")));const w=e.cloud.persistedSyncState.value;if(!b)continue;switch(b.type){case"token-expired":const j=e.cloud.currentUser.value,K=yield Nr(e.cloud.options.databaseUrl,j);yield e.table("$logins").update(j.userId,{accessToken:K.accessToken,accessTokenExpiration:K.accessTokenExpiration,claims:K.claims,license:K.license,data:K.data});break;case"realm-added":!((f=w==null?void 0:w.realms)===null||f===void 0)&&f.includes(b.realm)||!((h=w==null?void 0:w.inviteRealms)===null||h===void 0)&&h.includes(b.realm)||(yield e.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((y=w==null?void 0:w.realms)===null||y===void 0)&&y.includes(b.realm)||(yield e.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(!((v=w==null?void 0:w.realms)===null||v===void 0)&&v.includes(b.realm)||!((l=w==null?void 0:w.inviteRealms)===null||l===void 0)&&l.includes(b.realm))&&(yield e.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield e.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(((g=e.cloud.syncState.value)===null||g===void 0?void 0:g.phase)==="error"){dt(e,"pull");break}yield e.transaction("rw",e.dx.tables,N=>ee(this,void 0,void 0,function*(){N.idbtrans.disableChangeTracking=!0,N.idbtrans.disableAccessControl=!0;const[q,G,B]=yield Promise.all([e.getSchema(),e.getPersistedSyncState(),e.getCurrentUser()]);if(!G||!q||!B)return;if(b.baseRev!==G.serverRevision)return void(typeof b.baseRev!="string"||typeof G.serverRevision!="bigint"&&typeof G.serverRevision!="object"||dt(e,"pull"));if((yield Se.waitFor(Jo(G)))!==b.realmSetHash)return void dt(e,"pull");let Q=[];if(B.isLoggedIn){const ce=wr(e).map(te=>e.table(bi(te.name)));Q=yield Qo(ce)}if(b.changes.length>0){const ce=Qa(b.changes,Q);yield Ya(ce,e)}G.latestRevisions=ei(Q,G.latestRevisions),G.serverRevision=b.newRev,yield Ga(e,q,G.latestRevisions,b.newRev),yield e.$syncState.put(G,"syncState")}))}}catch{}}})}()}finally{u[u.length-1]-u[0]<of&&(yield new Promise(f=>setTimeout(f,sf))),s=!1,n.next(!0)}}})),{enqueue:function(f){t.push(f),o.next(null)},readyToServe:n}}const Ts=new WeakMap,yr={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let uf=0;function lt(e){"vip"in e&&(e=e.vip);let t=Ts.get(e.cloud);if(!t){const n=new Dn;let o=new pr(`syncstatechanged-${e.name}`),s=new pr(`synccomplete-${e.name}`);n.id=++uf;let u=!1;t={get name(){return e.name},close:()=>e.close(),transaction:e.transaction.bind(e),table:e.table.bind(e),get tables(){return e.tables},cloud:e.cloud,get $jobs(){return e.table("$jobs")},get $syncState(){return e.table("$syncState")},get $baseRevs(){return e.table("$baseRevs")},get $logins(){return e.table("$logins")},get realms(){return e.realms},get members(){return e.members},get roles(){return e.roles},get initiallySynced(){return u},localSyncEvent:n,get syncStateChangedEvent(){return o},get syncCompleteEvent(){return s},dx:e},Object.assign(t,{getCurrentUser:()=>t.$logins.toArray().then(h=>h.find(y=>y.isLoggedIn)||He),getPersistedSyncState:()=>t.$syncState.get("syncState"),getSchema:()=>t.$syncState.get("schema").then(h=>{if(h)for(const v of t.tables)v.schema.primKey&&v.schema.primKey.keyPath&&h[v.name]&&(h[v.name].primaryKey=typeof(y=v.schema.primKey.keyPath)=="string"?y:y?"["+[].join.call(y,"+")+"]":"");var y;return h}),getOptions:()=>t.$syncState.get("options"),setInitiallySynced(h){u=h},reconfigure(){o=new pr(`syncstatechanged-${e.name}`),s=new pr(`synccomplete-${e.name}`)}}),t.messageConsumer=af(t),Ts.set(e.cloud,t)}return t}const cf=typeof InstallTrigger<"u",Xa=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),lf=Xa?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,ff=Xa&&lf<=605||cf,df=typeof self<"u"&&"clients"in self&&!self.document;function Za(){throw new Se.SchemaError("Version increment needed to allow dexie-cloud change tracking")}const{toString:hf}={};function Ds(e){return hf.call(e).slice(8,-1)}function Do(e,t){var n;return t.type==="delete"?t.keys:((n=t.keys)===null||n===void 0?void 0:n.slice())||t.values.map(e.extractKey)}const pf=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;let ft=0;function eu(e,t){const n=new Uint8Array(18),o=new Uint8Array(n.buffer,0,6),s=Date.now();ft>=s?++ft:ft=s,o[0]=ft/1099511627776,o[1]=ft/4294967296,o[2]=ft/16777216,o[3]=ft/65536,o[4]=ft/256,o[5]=ft;const u=new Uint8Array(n.buffer,6);return crypto.getRandomValues(u),e+Fa(new Uint8Array(n.buffer))+(t||"")}function yf(e){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:t=>Object.assign(Object.assign({},t),{table:n=>{const o=t.table(n);return Object.assign(Object.assign({},o),{mutate:s=>{var u,f;if(s.trans.disableChangeTracking)return o.mutate(s);if(s.type==="add"||s.type==="put"){const h=(u=e.cloud.schema)===null||u===void 0?void 0:u[n];if(h!=null&&h.generatedGlobalId){if(!((f=e.cloud.options)===null||f===void 0)&&f.databaseUrl&&!e.initiallySynced){const y=Do(o.schema.primaryKey,s);return o.getMany({keys:y,trans:s.trans,cache:"immutable"}).then(v=>{if(v.length<y.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return o.mutate(s)})}return function(y,v){let l=null;const g=Do(o.schema.primaryKey,y);return g.forEach((b,w)=>{if(b===void 0){const j=y.values[w].realmId||e.cloud.currentUserId,K=j.substr(j.length-3);g[w]=eu(v,K),o.schema.primaryKey.outbound||(l||(l=y.values.slice()),l[w]=Se.deepClone(l[w]),Se.setByKeyPath(l[w],o.schema.primaryKey.keyPath,g[w]))}else if(typeof b!="string"||!b.startsWith(v)&&!b.startsWith("#"+v))throw new Se.ConstraintError(`The ID "${b}" is not valid for table "${n}". Primary '@' keys requires the key to be prefixed with "${v}" (or "#${v}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),o.mutate(Object.assign(Object.assign({},y),{keys:g,values:l||y.values}))}(s,h.idPrefix)}h!=null&&h.markedForSync&&Do(o.schema.primaryKey,s).forEach((y,v)=>{if(!fi(y)){const l=Array.isArray(y)?y.map(Ds).join(","):Ds(y);throw new Se.ConstraintError(`Invalid primary key type ${l} for table ${n}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return o.mutate(s)}})}})}}let vf=0;function En(e,t){return function(n){const{readers:o,writers:s}=n.trans[t]||(n.trans[t]={writers:[],readers:[]}),u=s.length,f=(u>0?s[u-1].then(()=>e(n),()=>e(n)):e(n)).finally(()=>{o.splice(o.indexOf(f))});return o.push(f),f}}function mf(e,t){return function(n){const{readers:o,writers:s}=n.trans[t]||(n.trans[t]={writers:[],readers:[]});let u=(s.length>0?s[s.length-1].then(()=>e(n),()=>e(n)):o.length>0?(f=o,new Promise(h=>{f.length===0&&h([]);let y=f.length;const v=new Array(y);f.forEach((l,g)=>Promise.resolve(l).then(b=>v[g]={status:"fulfilled",value:b},b=>v[g]={status:"rejected",reason:b}).then(()=>--y||h(v)))})).then(()=>e(n)):e(n)).finally(()=>{s.shift()});var f;return s.push(u),u}}const zt=new Qe(new Set);function tu(e){var t,n,o,s;return((t=e.cloud.options)===null||t===void 0?void 0:t.disableEagerSync)||((o=(n=e.cloud.currentUser.value)===null||n===void 0?void 0:n.license)===null||o===void 0?void 0:o.status)!=="ok"||!(!((s=e.cloud.options)===null||s===void 0)&&s.databaseUrl)}function bf({currentUserObservable:e,db:t}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:n=>{const o=n.schema.tables.filter(u=>!/^\$/.test(u.name));let s;try{s=new Map(o.map(u=>[u.name,n.table(`$${u.name}_mutations`)]))}catch{Za()}return Object.assign(Object.assign({},n),{transaction:(u,f)=>{let h;if(f==="readwrite"){const y=u.filter(v=>{var l,g;return(g=(l=t.cloud.schema)===null||l===void 0?void 0:l[v])===null||g===void 0?void 0:g.markedForSync}).map(v=>bi(v));h=n.transaction([...u,...y],f)}else h=n.transaction(u,f);if(f==="readwrite"){h.txid=Ma(16),h.opCount=0,h.currentUser=e.value,zt.value.add(h),zt.next(zt.value);const y=()=>{h.removeEventListener("complete",v),h.removeEventListener("error",y),h.removeEventListener("abort",y),zt.value.delete(h),zt.next(zt.value)},v=()=>{h.mutationsAdded&&!tu(t)&&dt(t,"push"),y()};h.addEventListener("complete",v),h.addEventListener("error",y),h.addEventListener("abort",y)}return h},table:u=>{const f=n.table(u);if(/^\$/.test(u))return u.endsWith("_mutations")?Object.assign(Object.assign({},f),{mutate:l=>(l.type!=="add"&&l.type!=="put"||(l.trans.mutationsAdded=!0),f.mutate(l))}):u==="$logins"?Object.assign(Object.assign({},f),{mutate:l=>f.mutate(l).then(g=>(l.trans.mutationsAdded=!0,g)).catch(g=>Promise.reject(g))}):f;const{schema:h}=f,y=s.get(u);return function(l){const g="$lock"+ ++vf;return Object.assign(Object.assign({},l),{count:En(l.count,g),get:En(l.get,g),getMany:En(l.getMany,g),openCursor:En(l.openCursor,g),query:En(l.query,g),mutate:mf(l.mutate,g)})}(Object.assign(Object.assign({},f),{mutate:l=>{var g,b,w;const j=l.trans;return j.txid?j.disableChangeTracking?f.mutate(l):!((b=(g=t.cloud.schema)===null||g===void 0?void 0:g[u])===null||b===void 0)&&b.markedForSync&&(!((w=j.currentUser)===null||w===void 0)&&w.isLoggedIn)?l.type==="deleteRange"?f.query({query:{range:l.range,index:h.primaryKey},trans:l.trans,values:!1}).then(K=>v({type:"delete",keys:K.result,trans:l.trans,criteria:{index:null,range:l.range}})):v(l):f.mutate(l):f.mutate(l)}}));function v(l){const g=l.trans;g.mutationsAdded=!0;const{txid:b,currentUser:{userId:w}}=g,{type:j}=l,K=++g.opCount;return f.mutate(l).then(N=>{const{numFailures:q,failures:G}=N;let B=j==="delete"?l.keys:N.results,Q="values"in l?l.values:[],ce="updates"in l&&l.updates;q&&(B=B.filter((ge,ve)=>!G[ve]),Q=Q.filter((ge,ve)=>!G[ve]));const te=Date.now(),pe=l.type==="delete"?{type:"delete",ts:te,opNo:K,keys:B,criteria:l.criteria,txid:b,userId:w}:l.type==="add"?{type:"insert",ts:te,opNo:K,keys:B,txid:b,userId:w,values:Q}:l.criteria&&l.changeSpec?{type:"modify",ts:te,opNo:K,keys:B,criteria:l.criteria,changeSpec:l.changeSpec,txid:b,userId:w}:ce?{type:"update",ts:te,opNo:K,keys:ce.keys,changeSpecs:ce.changeSpecs,txid:b,userId:w}:{type:"upsert",ts:te,opNo:K,keys:B,values:Q,txid:b,userId:w};return"isAdditionalChunk"in l&&l.isAdditionalChunk&&(pe.isAdditionalChunk=!0),B.length>0||"criteria"in l&&l.criteria?y.mutate({type:"add",trans:g,values:[pe]}).then(()=>N):N})}}})}}}function gf(e,t){return function(n,o){const s=Object.assign(Object.assign({},yr),n);Object.keys(yr).forEach(h=>{const y=s[h];if(y==null)throw new Error(`Cannot delete table ${h} as it is needed for access control of Dexie Cloud`);if(!n[h])return;const v=y.split(",").map(b=>b.trim()),l=yr[h].split(",").map(b=>b.trim()),g=new Set(v.map(b=>b.replace(/([&*]|\+\+)/g,"")));if(v[0]!==l[0])throw new Error(`Cannot override primary key of table ${h}. Please declare it as {${h}: ${JSON.stringify(yr[h])}`);for(let b=1;b<l.length;++b){const w=l[b];g.has(w.replace(/([&*]|\+\+)/g,""))||(s[h]+=`,${w}`)}});const u=t.cloud.schema||(t.cloud.schema={}),f=new Set;return Object.keys(s).forEach(h=>{const y=s[h],v=u[h]||(u[h]={});y!=null?(/^\@/.test(y)&&(s[h]=s[h].substr(1),v.generatedGlobalId=!0,v.idPrefix=function(l,g){let b=l[0].toLocaleLowerCase();for(let N=1,q=l.length;N<q&&b.length<3;++N)(pf.test(l[N])||(w=l[N])>="A"&&w<="Z")&&(b+=l[N].toLowerCase());for(var w,j,K;g.has(b);){if(/\d/g.test(b)){if(b=b.substr(0,b.length-1)+(b[b.length-1]+1),!(b.length>3))continue;b=b.substr(0,3)}else if(b.length<3){b+="2";continue}let N=1,q=b;for(;g.has(q)&&N<8;)j=b,q=(1&(K=N)?j[0].toUpperCase():j[0].toLowerCase())+(2&K?j[1].toUpperCase():j[1].toLowerCase())+(4&K?j[2].toUpperCase():j[2].toLowerCase()),++N;if(N<8)b=q;else{let G=b.charCodeAt(2)+1&127;b=b.substr(0,2)+String.fromCharCode(G)}}return b}(h,f),f.add(v.idPrefix)),/^\$/.test(h)||(s[`$${h}_mutations`]="++rev",v.markedForSync=!0),v.deleted&&(v.deleted=!1)):(v.deleted=!0,v.markedForSync=!1,s[`$${h}_mutations`]=null)}),e.call(this,s,o)}}const In=new Qe(!0),ti=new Qe(!0);In.pipe(Fe(e=>e?ht(!0):ht(!1).pipe(Da(2e4))),Ra()).subscribe(ti);const nu=typeof document<"u"?ot(document,"visibilitychange"):ht({}),_f=nu.pipe(rt(()=>document.visibilityState==="hidden")),wf=nu.pipe(rt(()=>document.visibilityState==="visible")),ru=typeof window<"u"?pa(wf,ot(window,"mousedown"),ot(window,"mousemove"),ot(window,"keydown"),ot(window,"wheel"),ot(window,"touchmove")):ht({});typeof document<"u"&&pa(ht(!0),_f,ru).pipe(it(()=>document.visibilityState==="visible"),Ss(e=>{In.value!==e&&In.next(e)}),Fe(e=>e?ht(0).pipe(Da(16e4),Ss(()=>In.next(!1))):ht(0))).subscribe(()=>{});class kf extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}class xf extends Te{constructor(t,n,o,s,u,f,h,y){super(v=>new Ef(t,n,o,s,h,y,v,u,f))}}let Sf=0;class Ef extends sn{constructor(t,n,o,s,u,f,h,y,v){super(()=>this.teardown()),this.id=++Sf,this.reconnecting=!1,this.databaseUrl=t,this.rev=n,this.realmSetHash=o,this.clientIdentity=s,this.token=u,this.tokenExpiration=f,this.subscriber=h,this.lastUserActivity=new Date,this.messageProducer=y,this.messageProducerSubscription=null,this.webSocketStatus=v,this.connect()}teardown(){this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null,this.messageProducerSubscription&&(this.messageProducerSubscription.unsubscribe(),this.messageProducerSubscription=null)}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return ee(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return;if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;if(this.tokenExpiration&&this.tokenExpiration<new Date)return void this.subscriber.error(new kf);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>ee(this,void 0,void 0,function*(){if(this.closed)this.teardown();else if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{this.pinger&&(this.closed?this.teardown():this.lastServerActivity<new Date(Date.now()-2e4)&&this.reconnect())},2e4)}catch{this.reconnect()}else this.reconnect()}),3e4);const t=new URL(this.databaseUrl);t.protocol=t.protocol==="http:"?"ws":"wss";const n=new URLSearchParams;if(this.subscriber.closed)return;n.set("v","2"),n.set("rev",this.rev),n.set("realmsHash",this.realmSetHash),n.set("clientId",this.clientIdentity),this.token&&n.set("token",this.token);const o=this.ws=new WebSocket(`${t}/changes?${n}`);o.onclose=s=>{this.pinger&&this.reconnect()},o.onmessage=s=>{if(this.pinger){this.lastServerActivity=new Date;try{const u=Pr.parse(s.data);if(u.type==="error")throw new Error(`Error message from dexie-cloud: ${u.error}`);u.type==="rev"&&(this.rev=u.rev),u.type!=="pong"&&this.subscriber.next(u)}catch(u){this.subscriber.error(u)}}};try{let s=!1;yield new Promise((u,f)=>{o.onopen=h=>{s=!0,u(null)},o.onerror=h=>{if(s)this.reconnect();else{const y=h.error||new Error("WebSocket Error");this.subscriber.error(y),this.webSocketStatus.next("error"),f(y)}}}),this.messageProducerSubscription=this.messageProducer.subscribe(u=>{var f;this.closed||(u.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),(f=this.ws)===null||f===void 0||f.send(Pr.stringify(u)))})}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}class Of extends Error{constructor(t){super(t==="expired"?"License expired":t==="deactivated"?"User deactivated":"Invalid license"),this.name="InvalidLicenseError",t&&(this.license=t)}}function If(e){return ee(this,void 0,void 0,function*(){var t;yield(t=3e3,new Promise(n=>setTimeout(n,t))),yield Jt(ru)})}function Rs(e){var t;return ee(this,void 0,void 0,function*(){return!(!(!((t=e.cloud.options)===null||t===void 0)&&t.databaseUrl)||!e.cloud.schema)&&(yield Tn(e,e.cloud.options,e.cloud.schema,{justCheckIfNeeded:!0}))})}const vr=new WeakMap;function ou(e,t,n,o){const s=vr.get(e);if(s){if(s.pull||(o==null?void 0:o.purpose)==="push")return s.promise;{let f=!1;const h=e.cloud.syncState.subscribe(y=>{y.phase==="pulling"&&(f=!0)});return s.promise.then(()=>{h.unsubscribe()}).catch(y=>(h.unsubscribe(),Promise.reject(y))).then(()=>{if(!f)return ou(e,t,n,o)})}}const u=function(){return ee(this,void 0,void 0,function*(){try{if(yield Ha(e),e.cloud.isServiceWorkerDB)yield Tn(e,t,n,o);else{if(e.cloud.usingServiceWorker)throw va(!1),new Error("Internal _syncIfPossible() - invalid precondition - should not have been called.");yield function(f,h,y){return typeof navigator<"u"&&navigator.locks?navigator.locks.request(f.name+"|"+h,()=>y()):y()}(e,nf,()=>Tn(e,t,n,o))}vr.delete(e)}catch(f){throw vr.delete(e),f}})}();return vr.set(e,{promise:u,pull:(o==null?void 0:o.purpose)!=="push"}),u}const Af=6e4;function Pf(e,t,n){let o=null,s={cancelled:!1},u=null,f=null;function h(v,l=1){setTimeout(()=>{u&&clearTimeout(u);const g=f==="pull"?"pull":v;u=null,f=null,ou(e,t,n,{cancelToken:s,retryImmediatelyOnFetchError:!0,purpose:g}).catch(b=>{if(s.cancelled)y();else if(l<3){const w=f&&f==="pull"?"pull":v,j=setTimeout(()=>h(w,l+1),[0,5,15][l]*Af);u&&clearTimeout(u),u=j,f=w}})},0)}const y=()=>{s.cancelled=!0,o&&o.unsubscribe()};return{start:()=>{o=e.localSyncEvent.subscribe(({purpose:v})=>{try{h(v||"pull")}catch{}})},stop:y}}function Ro(e,t){if(e&&t&&t.unsyncedTables)for(const n of t.unsyncedTables)e[n]&&(e[n].markedForSync=!1)}var Lr,ae,iu,An,Ks,Cr={},su=[],Cf=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function xt(e,t){for(var n in t)e[n]=t[n];return e}function au(e){var t=e.parentNode;t&&t.removeChild(e)}function Ce(e,t,n){var o,s,u,f={};for(u in t)u=="key"?o=t[u]:u=="ref"?s=t[u]:f[u]=t[u];if(arguments.length>2&&(f.children=arguments.length>3?Lr.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(u in e.defaultProps)f[u]===void 0&&(f[u]=e.defaultProps[u]);return kr(e,f,o,s,null)}function kr(e,t,n,o,s){var u={type:e,props:t,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s??++iu};return s==null&&ae.vnode!=null&&ae.vnode(u),u}function rn(e){return e.children}function Pn(e,t){this.props=e,this.context=t}function on(e,t){if(t==null)return e.__?on(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?on(e):null}function uu(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return uu(e)}}function Us(e){(!e.__d&&(e.__d=!0)&&An.push(e)&&!jr.__r++||Ks!==ae.debounceRendering)&&((Ks=ae.debounceRendering)||setTimeout)(jr)}function jr(){for(var e;jr.__r=An.length;)e=An.sort(function(t,n){return t.__v.__b-n.__v.__b}),An=[],e.some(function(t){var n,o,s,u,f,h;t.__d&&(f=(u=(n=t).__v).__e,(h=n.__P)&&(o=[],(s=xt({},u)).__v=u.__v+1,gi(h,u,s,n.__n,h.ownerSVGElement!==void 0,u.__h!=null?[f]:null,o,f??on(u),u.__h),du(o,u),u.__e!=f&&uu(u)))})}function cu(e,t,n,o,s,u,f,h,y,v){var l,g,b,w,j,K,N,q=o&&o.__k||su,G=q.length;for(n.__k=[],l=0;l<t.length;l++)if((w=n.__k[l]=(w=t[l])==null||typeof w=="boolean"?null:typeof w=="string"||typeof w=="number"||typeof w=="bigint"?kr(null,w,null,null,w):Array.isArray(w)?kr(rn,{children:w},null,null,null):w.__b>0?kr(w.type,w.props,w.key,null,w.__v):w)!=null){if(w.__=n,w.__b=n.__b+1,(b=q[l])===null||b&&w.key==b.key&&w.type===b.type)q[l]=void 0;else for(g=0;g<G;g++){if((b=q[g])&&w.key==b.key&&w.type===b.type){q[g]=void 0;break}b=null}gi(e,w,b=b||Cr,s,u,f,h,y,v),j=w.__e,(g=w.ref)&&b.ref!=g&&(N||(N=[]),b.ref&&N.push(b.ref,null,w),N.push(g,w.__c||j,w)),j!=null?(K==null&&(K=j),typeof w.type=="function"&&w.__k===b.__k?w.__d=y=lu(w,y,e):y=fu(e,w,b,q,j,y),typeof n.type=="function"&&(n.__d=y)):y&&b.__e==y&&y.parentNode!=e&&(y=on(b))}for(n.__e=K,l=G;l--;)q[l]!=null&&(typeof n.type=="function"&&q[l].__e!=null&&q[l].__e==n.__d&&(n.__d=on(o,l+1)),pu(q[l],q[l]));if(N)for(l=0;l<N.length;l++)hu(N[l],N[++l],N[++l])}function lu(e,t,n){for(var o,s=e.__k,u=0;s&&u<s.length;u++)(o=s[u])&&(o.__=e,t=typeof o.type=="function"?lu(o,t,n):fu(n,o,o,s,o.__e,t));return t}function fu(e,t,n,o,s,u){var f,h,y;if(t.__d!==void 0)f=t.__d,t.__d=void 0;else if(n==null||s!=u||s.parentNode==null)e:if(u==null||u.parentNode!==e)e.appendChild(s),f=null;else{for(h=u,y=0;(h=h.nextSibling)&&y<o.length;y+=2)if(h==s)break e;e.insertBefore(s,u),f=u}return f!==void 0?f:s.nextSibling}function Bs(e,t,n){t[0]==="-"?e.setProperty(t,n):e[t]=n==null?"":typeof n!="number"||Cf.test(t)?n:n+"px"}function mr(e,t,n,o,s){var u;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof o=="string"&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||Bs(e.style,t,"");if(n)for(t in n)o&&n[t]===o[t]||Bs(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")u=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+u]=n,n?o||e.addEventListener(t,u?Ls:Ns,u):e.removeEventListener(t,u?Ls:Ns,u);else if(t!=="dangerouslySetInnerHTML"){if(s)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||t[0]==="a"&&t[1]==="r")?e.setAttribute(t,n):e.removeAttribute(t))}}function Ns(e){this.l[e.type+!1](ae.event?ae.event(e):e)}function Ls(e){this.l[e.type+!0](ae.event?ae.event(e):e)}function gi(e,t,n,o,s,u,f,h,y){var v,l,g,b,w,j,K,N,q,G,B,Q,ce,te=t.type;if(t.constructor!==void 0)return null;n.__h!=null&&(y=n.__h,h=t.__e=n.__e,t.__h=null,u=[h]),(v=ae.__b)&&v(t);try{e:if(typeof te=="function"){if(N=t.props,q=(v=te.contextType)&&o[v.__c],G=v?q?q.props.value:v.__:o,n.__c?K=(l=t.__c=n.__c).__=l.__E:("prototype"in te&&te.prototype.render?t.__c=l=new te(N,G):(t.__c=l=new Pn(N,G),l.constructor=te,l.render=Tf),q&&q.sub(l),l.props=N,l.state||(l.state={}),l.context=G,l.__n=o,g=l.__d=!0,l.__h=[]),l.__s==null&&(l.__s=l.state),te.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=xt({},l.__s)),xt(l.__s,te.getDerivedStateFromProps(N,l.__s))),b=l.props,w=l.state,g)te.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(te.getDerivedStateFromProps==null&&N!==b&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(N,G),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(N,l.__s,G)===!1||t.__v===n.__v){l.props=N,l.state=l.__s,t.__v!==n.__v&&(l.__d=!1),l.__v=t,t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(pe){pe&&(pe.__=t)}),l.__h.length&&f.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(N,l.__s,G),l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(b,w,j)})}if(l.context=G,l.props=N,l.__v=t,l.__P=e,B=ae.__r,Q=0,"prototype"in te&&te.prototype.render)l.state=l.__s,l.__d=!1,B&&B(t),v=l.render(l.props,l.state,l.context);else do l.__d=!1,B&&B(t),v=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++Q<25);l.state=l.__s,l.getChildContext!=null&&(o=xt(xt({},o),l.getChildContext())),g||l.getSnapshotBeforeUpdate==null||(j=l.getSnapshotBeforeUpdate(b,w)),ce=v!=null&&v.type===rn&&v.key==null?v.props.children:v,cu(e,Array.isArray(ce)?ce:[ce],t,n,o,s,u,f,h,y),l.base=t.__e,t.__h=null,l.__h.length&&f.push(l),K&&(l.__E=l.__=null),l.__e=!1}else u==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=jf(n.__e,t,n,o,s,u,f,y);(v=ae.diffed)&&v(t)}catch(pe){t.__v=null,(y||u!=null)&&(t.__e=h,t.__h=!!y,u[u.indexOf(h)]=null),ae.__e(pe,t,n)}}function du(e,t){ae.__c&&ae.__c(t,e),e.some(function(n){try{e=n.__h,n.__h=[],e.some(function(o){o.call(n)})}catch(o){ae.__e(o,n.__v)}})}function jf(e,t,n,o,s,u,f,h){var y,v,l,g=n.props,b=t.props,w=t.type,j=0;if(w==="svg"&&(s=!0),u!=null){for(;j<u.length;j++)if((y=u[j])&&"setAttribute"in y==!!w&&(w?y.localName===w:y.nodeType===3)){e=y,u[j]=null;break}}if(e==null){if(w===null)return document.createTextNode(b);e=s?document.createElementNS("http://www.w3.org/2000/svg",w):document.createElement(w,b.is&&b),u=null,h=!1}if(w===null)g===b||h&&e.data===b||(e.data=b);else{if(u=u&&Lr.call(e.childNodes),v=(g=n.props||Cr).dangerouslySetInnerHTML,l=b.dangerouslySetInnerHTML,!h){if(u!=null)for(g={},j=0;j<e.attributes.length;j++)g[e.attributes[j].name]=e.attributes[j].value;(l||v)&&(l&&(v&&l.__html==v.__html||l.__html===e.innerHTML)||(e.innerHTML=l&&l.__html||""))}if(function(K,N,q,G,B){var Q;for(Q in q)Q==="children"||Q==="key"||Q in N||mr(K,Q,null,q[Q],G);for(Q in N)B&&typeof N[Q]!="function"||Q==="children"||Q==="key"||Q==="value"||Q==="checked"||q[Q]===N[Q]||mr(K,Q,N[Q],q[Q],G)}(e,b,g,s,h),l)t.__k=[];else if(j=t.props.children,cu(e,Array.isArray(j)?j:[j],t,n,o,s&&w!=="foreignObject",u,f,u?u[0]:n.__k&&on(n,0),h),u!=null)for(j=u.length;j--;)u[j]!=null&&au(u[j]);h||("value"in b&&(j=b.value)!==void 0&&(j!==e.value||w==="progress"&&!j||w==="option"&&j!==g.value)&&mr(e,"value",j,g.value,!1),"checked"in b&&(j=b.checked)!==void 0&&j!==e.checked&&mr(e,"checked",j,g.checked,!1))}return e}function hu(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(o){ae.__e(o,n)}}function pu(e,t,n){var o,s;if(ae.unmount&&ae.unmount(e),(o=e.ref)&&(o.current&&o.current!==e.__e||hu(o,null,t)),(o=e.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(u){ae.__e(u,t)}o.base=o.__P=null}if(o=e.__k)for(s=0;s<o.length;s++)o[s]&&pu(o[s],t,typeof e.type!="function");n||e.__e==null||au(e.__e),e.__e=e.__d=void 0}function Tf(e,t,n){return this.constructor(e,n)}function $s(e,t,n){var o,s,u;ae.__&&ae.__(e,t),s=(o=!1)?null:t.__k,u=[],gi(t,e=t.__k=Ce(rn,null,[e]),s||Cr,Cr,t.ownerSVGElement!==void 0,s?null:t.firstChild?Lr.call(t.childNodes):null,u,s?s.__e:t.firstChild,o),du(u,e)}Lr=su.slice,ae={__e:function(e,t,n,o){for(var s,u,f;t=t.__;)if((s=t.__c)&&!s.__)try{if((u=s.constructor)&&u.getDerivedStateFromError!=null&&(s.setState(u.getDerivedStateFromError(e)),f=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,o||{}),f=s.__d),f)return s.__E=s}catch(h){e=h}throw e}},iu=0,Pn.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=xt({},this.state),typeof e=="function"&&(e=e(xt({},n),this.props)),e&&xt(n,e),e!=null&&this.__v&&(t&&this.__h.push(t),Us(this))},Pn.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Us(this))},Pn.prototype.render=rn,An=[],jr.__r=0;const nt={Alert:{error:{color:"red",fontWeight:"bold"},warning:{color:"#f80",fontWeight:"bold"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"30px",marginBottom:"2em",maxWidth:"90%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",width:"auto",fontFamily:"sans-serif"},Input:{height:"35px",width:"17em",borderColor:"#ccf4",outline:"none",fontSize:"17pt",padding:"8px"}};function Df({children:e,className:t}){return Ce("div",{className:t},Ce("div",{style:nt.Darken}),Ce("div",{style:nt.DialogOuter},Ce("div",{style:nt.DialogInner},e)))}var $r,je,Ko,Ms,Tr=0,yu=[],xr=[],qs=ae.__b,Fs=ae.__r,Ws=ae.diffed,Vs=ae.__c,zs=ae.unmount;function _i(e,t){ae.__h&&ae.__h(je,e,Tr||t),Tr=0;var n=je.__H||(je.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:xr}),n.__[e]}function Rf(e){return Tr=1,function(t,n,o){var s=_i($r++,2);if(s.t=t,!s.__c&&(s.__=[Gs(void 0,n),function(f){var h=s.__N?s.__N[0]:s.__[0],y=s.t(h,f);h!==y&&(s.__N=[y,s.__[1]],s.__c.setState({}))}],s.__c=je,!je.u)){je.u=!0;var u=je.shouldComponentUpdate;je.shouldComponentUpdate=function(f,h,y){if(!s.__c.__H)return!0;var v=s.__c.__H.__.filter(function(g){return g.__c});if(v.every(function(g){return!g.__N}))return!u||u.call(this,f,h,y);var l=!1;return v.forEach(function(g){if(g.__N){var b=g.__[0];g.__=g.__N,g.__N=void 0,b!==g.__[0]&&(l=!0)}}),!!l&&(!u||u.call(this,f,h,y))}}return s.__N||s.__}(Gs,e)}function Kf(e){return Tr=5,function(t,n){var o=_i($r++,7);return vu(o.__H,n)?(o.__V=t(),o.i=n,o.__h=t,o.__V):o.__}(function(){return{current:e}},[])}function Uf(){for(var e;e=yu.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Sr),e.__H.__h.forEach(ni),e.__H.__h=[]}catch(t){e.__H.__h=[],ae.__e(t,e.__v)}}ae.__b=function(e){je=null,qs&&qs(e)},ae.__r=function(e){Fs&&Fs(e),$r=0;var t=(je=e.__c).__H;t&&(Ko===je?(t.__h=[],je.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=xr,n.__N=n.i=void 0})):(t.__h.forEach(Sr),t.__h.forEach(ni),t.__h=[])),Ko=je},ae.diffed=function(e){Ws&&Ws(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(yu.push(t)!==1&&Ms===ae.requestAnimationFrame||((Ms=ae.requestAnimationFrame)||function(n){var o,s=function(){clearTimeout(u),Hs&&cancelAnimationFrame(o),setTimeout(n)},u=setTimeout(s,100);Hs&&(o=requestAnimationFrame(s))})(Uf)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==xr&&(n.__=n.__V),n.i=void 0,n.__V=xr})),Ko=je=null},ae.__c=function(e,t){t.some(function(n){try{n.__h.forEach(Sr),n.__h=n.__h.filter(function(o){return!o.__||ni(o)})}catch(o){t.some(function(s){s.__h&&(s.__h=[])}),t=[],ae.__e(o,n.__v)}}),Vs&&Vs(e,t)},ae.unmount=function(e){zs&&zs(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{Sr(o)}catch(s){t=s}}),t&&ae.__e(t,n.__v))};var Hs=typeof requestAnimationFrame=="function";function Sr(e){var t=je,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),je=t}function ni(e){var t=je;e.__c=e.__(),je=t}function vu(e,t){return!e||e.length!==t.length||t.some(function(n,o){return n!==e[o]})}function Gs(e,t){return typeof t=="function"?t(e):t}function Bf({message:e,messageCode:t,messageParams:n}){return e.replace(/\{\w+\}/gi,o=>n[o.substring(1,o.length-1)])}function Nf({title:e,type:t,alerts:n,fields:o,submitLabel:s,cancelLabel:u,onCancel:f,onSubmit:h}){const[y,v]=Rf({}),l=Kf(null);return function(g,b){var w=_i($r++,4);!ae.__s&&vu(w.__H,b)&&(w.__=g,w.i=b,je.__h.push(w))}(()=>{var g;return(g=l.current)===null||g===void 0?void 0:g.focus()},[]),Ce(Df,{className:"dxc-login-dlg"},Ce(rn,null,Ce("h3",{style:nt.WindowHeader},e),n.map(g=>Ce("p",{style:nt.Alert[g.type]},Bf(g))),Ce("form",{onSubmit:g=>{g.preventDefault(),h(y)}},Object.entries(o).map(([g,{type:b,label:w,placeholder:j}],K)=>Ce("label",{style:nt.Label,key:K},w?`${w}: `:"",Ce("input",{ref:K===0?l:void 0,type:b,name:g,autoComplete:"on",style:nt.Input,autoFocus:!0,placeholder:j,value:y[g]||"",onInput:N=>{var q;const G=function(Q,ce){switch(Q){case"email":return ce.toLowerCase();case"otp":return ce.toUpperCase();default:return ce}}(b,(q=N.target)===null||q===void 0?void 0:q.value);let B=Object.assign(Object.assign({},y),{[g]:G});v(B),b==="otp"&&(G==null?void 0:G.trim().length)===8&&h(B)}}))))),Ce("div",{style:nt.ButtonsDiv},Ce(rn,null,Ce("button",{type:"submit",style:nt.Button,onClick:()=>h(y)},s),u&&Ce("button",{style:nt.Button,onClick:f},u))))}class Ys extends Pn{constructor(t){super(t),this.observer=n=>this.setState({userInteraction:n}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=st(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(t,{userInteraction:n}){return n?Ce(Nf,Object.assign({},n)):null}}function Un(e){const t=new WeakMap;return n=>{let o=t.get(n);return o||(o=e(n),t.set(n,o)),o}}const Dr=Un(e=>new Qe(He));function Mr(e,t){let n=t,o=st(e).pipe(Kr(u=>n=u),dl({resetOnRefCountZero:()=>ll(1e3)}));const s=new Te(u=>{let f=!1;const h=o.subscribe({next(y){f=!0,u.next(y)},error(y){u.error(y)},complete(){u.complete()}});return f||h.closed||u.next(n),h});return s.getValue=()=>n,s}const mu=Un(e=>Mr(Gt(()=>e.roles.where({realmId:"rlm-public"}).toArray().then(t=>{const n={};for(const o of t.slice().sort((s,u)=>(s.sortOrder||0)-(u.sortOrder||0)))n[o.name]=o;return n})),{})),bu=Un(e=>Mr(Dr(e._novip).pipe(Fe(t=>Gt(()=>e.transaction("r","realms","members",()=>Promise.all([e.members.where({userId:t.userId}).toArray(),e.realms.toArray(),t.userId]).then(([n,o,s])=>({selfMembers:n,realms:o,userId:s})))))),{selfMembers:[],realms:[],get userId(){return e.cloud.currentUserId}}));function Lf(...e){return e.length===0?{}:e.reduce((n,o)=>{const s=Object.assign({},n);for(const[u,f]of Object.entries(o))if(u in s&&s[u]){if(s[u]==="*")continue;if(f==="*")s[u]="*";else if(Array.isArray(f)&&Array.isArray(s[u])){const h=s,y=h[u];h[u]=[...new Set([...y,...f])]}else if(typeof f=="object"&&f&&typeof s[u]=="object"){const h=s[u];for(const[y,v]of Object.entries(f))h[y]!=="*"&&(v==="*"?h[y]="*":Array.isArray(h[y])&&Array.isArray(v)&&(h[y]=[...new Set([...h[y],...v])]))}}else s[u]=o[u];return s})}const gu=Un(e=>function(t,n){let o;const s=t.pipe(Kr(u=>o=n(u)));return s.getValue=()=>o!==void 0?o:o=n(t.getValue()),s}(Mr(Or([bu(e._novip),mu(e._novip)]).pipe(it(([{selfMembers:t,realms:n,userId:o},s])=>({selfMembers:t,realms:n,userId:o,globalRoles:s}))),{selfMembers:[],realms:[],userId:He.userId,globalRoles:{}}),({selfMembers:t,realms:n,userId:o,globalRoles:s})=>n.map(f=>{const h=t.filter(l=>l.realmId===f.realmId),y=h.map(l=>l.permissions).filter(l=>l),v=$a(h.map(l=>l.roles).filter(l=>l)).map(l=>s[l]).filter(l=>l).map(l=>l.permissions);return Object.assign(Object.assign({},f),{permissions:f.owner===o?{manage:"*"}:Lf(...y,...v)})}).reduce((f,h)=>Object.assign(Object.assign({},f),{[h.realmId]:h}),{[o]:{realmId:o,owner:o,name:o,permissions:{manage:"*"}}})));class Js{constructor(t,n,o){this.permissions=t||{},this.tableName=n,this.isOwner=o}add(...t){var n;return this.permissions.manage==="*"||!!(!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))||this.permissions.add==="*"||!!t.every(o=>{var s;return(s=this.permissions.add)===null||s===void 0?void 0:s.includes(o)})}update(...t){var n,o;if(this.isOwner||this.permissions.manage==="*"||!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))return!0;if(this.permissions.update==="*")return t.every(u=>u!=="owner");const s=(o=this.permissions.update)===null||o===void 0?void 0:o[this.tableName];return s==="*"?t.every(u=>u!=="owner"):t.every(u=>s==null?void 0:s.some(f=>f===u||f==="*"&&u!=="owner"))}delete(){var t;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((t=this.permissions.manage)===null||t===void 0)&&t.includes(this.tableName))}}const $f=Un(e=>{const t=Dr(e._novip).pipe(Fe(s=>Gt(()=>e.members.where({email:s.email||""}).toArray()))),n=gu(e._novip),o=bu(e._novip);return Mr(Or([t,o,n]).pipe(it(([s,u,f])=>{const h=(l,g)=>Object.assign(Object.assign({},l),{[g.id]:Object.assign(Object.assign({},g),{realm:f[g.realmId]})}),y=s.reduce(h,{}),v=u.selfMembers.reduce(h,y);return Object.values(v).filter(l=>!l.accepted).map(l=>Object.assign(Object.assign({},l),{accept(){return ee(this,void 0,void 0,function*(){yield e.members.update(l.id,{accepted:new Date})})},reject(){return ee(this,void 0,void 0,function*(){yield e.members.update(l.id,{rejected:new Date})})}}))})),[])}),Mf={nameSuffix:!0};function ri(e){const t=e.name,n=Dr(e),o=[];let s=!1,u=null;e.on("ready",l=>ee(this,void 0,void 0,function*(){try{yield function(g){var b,w,j,K,N,q,G;return ee(this,void 0,void 0,function*(){f=!1;const B=lt(g);typeof window<"u"&&typeof document<"u"&&(!((b=B.cloud.options)===null||b===void 0)&&b.customLoginGui||o.push(function(Z){let oe=!1;const ue=document.createElement("div");return document.body?(document.body.appendChild(ue),$s(Ce(Ys,{db:Z.vip}),ue)):addEventListener("DOMContentLoaded",()=>{oe||(document.body.appendChild(ue),$s(Ce(Ys,{db:Z.vip}),ue))}),{unsubscribe(){try{ue.remove()}catch{}oe=!0},get closed(){return oe}}}(g))),B.cloud.isServiceWorkerDB||o.push(function(Z){let oe=Z.cloud.webSocketStatus.value;const ue=Z.cloud.webSocketStatus.pipe(Fe(Y=>{const z=oe;oe=Y;const re=ht(Y);switch(Y){case"disconnected":return In.value?re.pipe(ks(500)):re;case"connecting":return z==="not-started"||z==="error"?re:re.pipe(ks(4e3));default:return re}}));return Or([ue,Z.syncStateChangedEvent.pipe(Tl({phase:"initial"})),Dr(Z.dx._novip),ti]).pipe(it(([Y,z,re,de])=>{var Ee;if(!((Ee=re.license)===null||Ee===void 0)&&Ee.status&&re.license.status!=="ok")return{phase:"offline",status:"offline",license:re.license.status};let{phase:Oe,error:_e,progress:ke}=z,Ue=Y;return Oe==="error"&&(Ue="error"),Y==="not-started"&&(Oe!=="pushing"&&Oe!=="pulling"||(Ue="connecting")),Z.cloud.syncState.value.phase!=="error"||z.phase!=="pushing"&&z.phase!=="pulling"||(Ue="connecting"),de||(Ue="disconnected"),{phase:Oe,error:_e,progress:ke,status:Xt?Ue:"offline",license:"ok"}}))}(B).subscribe(g.cloud.syncState)),o.push(B.syncCompleteEvent.subscribe(y)),B.tables.every(Z=>Z.core)||Za();const Q="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],[ce,te]=yield B.transaction("rw",B.$syncState,()=>ee(this,void 0,void 0,function*(){var Z,oe;const{options:ue,schema:Y}=B.cloud,[z,re,de]=yield Promise.all([B.getOptions(),B.getSchema(),B.getPersistedSyncState()]);if(s){if(!z||JSON.stringify(z)!==JSON.stringify(ue)){if(!ue)throw new Error("Internal error");const Ee=Object.assign({},ue);delete Ee.fetchTokens,yield B.$syncState.put(Ee,"options")}}else B.cloud.options=z||null;if(!((Z=B.cloud.options)===null||Z===void 0)&&Z.tryUseServiceWorker&&"serviceWorker"in navigator&&Q.length>0&&!ff?B.cloud.usingServiceWorker=!0:(!((oe=B.cloud.options)===null||oe===void 0)&&oe.tryUseServiceWorker&&B.cloud.isServiceWorkerDB,B.cloud.usingServiceWorker=!1),Ro(Y,B.cloud.options),Ro(re,B.cloud.options),Y){if(!re||JSON.stringify(re)!==JSON.stringify(Y)){const Ee=re||{};for(const[Oe,_e]of Object.entries(Y)){const ke=Ee[Oe];ke?(ke.markedForSync=_e.markedForSync,_e.deleted=ke.deleted,ke.generatedGlobalId=_e.generatedGlobalId):Ee[Oe]=Object.assign({},_e)}yield B.$syncState.put(Ee,"schema"),Object.assign(Y,Ee)}}else B.cloud.schema=re||null;return[de==null?void 0:de.initiallySynced,de==null?void 0:de.realms]}));ce&&B.setInitiallySynced(!0),function(Z){var oe,ue;for(const Y of Z.tables)if(!((ue=(oe=Z.cloud.schema)===null||oe===void 0?void 0:oe[Y.name])===null||ue===void 0)&&ue.markedForSync){if(Y.schema.primKey.auto)throw new Se.SchemaError(`Table ${Y.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(Y.name)}]}) to blacklist it from sync`);if(!Y.schema.primKey.keyPath)throw new Se.SchemaError(`Table ${Y.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(Y.name)}]}) to blacklist it from sync`)}}(B),!((w=B.cloud.options)===null||w===void 0)&&w.databaseUrl&&!ce&&(yield function(Z,oe,ue){return ee(this,void 0,void 0,function*(){yield Tn(Z,oe,ue,{isInitialSync:!0})})}(B,B.cloud.options,B.cloud.schema),B.setInitiallySynced(!0)),h(),B.cloud.isServiceWorkerDB||(o.push(Gt(()=>B.getCurrentUser()).subscribe(n)),o.push(Gt(()=>B.getPersistedSyncState()).subscribe(B.cloud.persistedSyncState)),yield Jt(Or([n.pipe(xs(1),Ht(1)),B.cloud.persistedSyncState.pipe(xs(1),Ht(1))])));let pe=!1;const ge=yield B.getCurrentUser(),ve=(j=B.cloud.options)===null||j===void 0?void 0:j.requireAuth;ve&&(typeof ve=="object"?(!ge.isLoggedIn||ve.userId&&ge.userId!==ve.userId||ve.email&&ge.email!==ve.email)&&(pe=yield Co(B,ve)):ge.isLoggedIn||(pe=yield Co(B))),!ge.isLoggedIn||te&&te.includes(ge.userId)||(pe=!0),u&&u.stop(),u=null,h(),B.cloud.usingServiceWorker&&(!((K=B.cloud.options)===null||K===void 0)&&K.databaseUrl)?(Ka(B,pe?"pull":"push").catch(()=>{}),function(Z){var oe;return ee(this,void 0,void 0,function*(){try{const{periodicSync:ue}=yield navigator.serviceWorker.ready;if(ue)try{yield ue.register(`dexie-cloud:${Z.name}`,(oe=Z.cloud.options)===null||oe===void 0?void 0:oe.periodicSync)}catch{}}catch{}})}(B).catch(()=>{})):!((N=B.cloud.options)===null||N===void 0)&&N.databaseUrl&&B.cloud.schema&&!B.cloud.isServiceWorkerDB&&(u=Pf(B,B.cloud.options,B.cloud.schema),u.start(),dt(B,pe?"pull":"push")),h(),B.cloud.isServiceWorkerDB||o.push(ot(self,"online").subscribe(()=>{B.syncStateChangedEvent.next({phase:"not-in-sync"}),tu(B)||dt(B,"push")}),ot(self,"offline").subscribe(()=>{B.syncStateChangedEvent.next({phase:"offline"})})),!(!((q=B.cloud.options)===null||q===void 0)&&q.databaseUrl)||!((G=B.cloud.options)===null||G===void 0)&&G.disableWebSocket||df||o.push(function(Z){var oe;if(!(!((oe=Z.cloud.options)===null||oe===void 0)&&oe.databaseUrl))throw new Error("No database URL to connect WebSocket to");const ue=Z.messageConsumer.readyToServe.pipe(rt(Y=>Y),Fe(()=>Z.getPersistedSyncState()),rt(Y=>Y&&Y.serverRevision),Fe(Y=>ee(this,void 0,void 0,function*(){return{type:"ready",rev:Y.serverRevision,realmSetHash:yield Jo(Y)}})));return function Y(){return Z.cloud.persistedSyncState.pipe(rt(z=>z==null?void 0:z.serverRevision),Ht(1),Fe(z=>Z.cloud.currentUser.pipe(it(re=>[re,z]))),Fe(([z,re])=>ti.pipe(it(de=>[de?z:null,re]))),Fe(([z,re])=>z!=null&&z.isLoggedIn&&!(re!=null&&re.realms.includes(z.userId))?Z.cloud.persistedSyncState.pipe(rt(de=>(de==null?void 0:de.realms.includes(z.userId))||!1),Ht(1),it(de=>[z,de])):new Qe([z,re])),Fe(([z,re])=>ee(this,void 0,void 0,function*(){return[z,yield Jo(re)]})),Ra(([z,re],[de,Ee])=>z===de&&re===Ee),Fe(([z,re])=>{var de;return!((de=Z.cloud.persistedSyncState)===null||de===void 0)&&de.value?z?new xf(Z.cloud.options.databaseUrl,Z.cloud.persistedSyncState.value.serverRevision,re,Z.cloud.persistedSyncState.value.clientIdentity,ue,Z.cloud.webSocketStatus,z.accessToken,z.accessTokenExpiration):st([]):Y()}),Fo(z=>(z==null?void 0:z.name)==="TokenExpiredError"?ht(!0).pipe(Fe(()=>ee(this,void 0,void 0,function*(){const re=yield Z.getCurrentUser(),de=yield Nr(Z.cloud.options.databaseUrl,re);yield Z.table("$logins").update(re.userId,{accessToken:de.accessToken,accessTokenExpiration:de.accessTokenExpiration,claims:de.claims,license:de.license,data:de.data})})),Fe(()=>Y())):ls(()=>z)),Fo(z=>(Z.cloud.webSocketStatus.next("error"),z instanceof Of?ls(()=>z):st(If()).pipe(Fe(()=>Y())))))}().subscribe({next:Y=>{Y&&Z.messageConsumer.enqueue(Y)},error:Y=>{},complete:()=>{}})}(B))})}(l)}catch{}}),!0);let f=!1;function h(){if(f)throw new Se.DatabaseClosedError}(function(l,g){l.on.close.subscribe(g);const b=l._close;l._close=function(){b.call(this),g()}})(e,()=>{o.forEach(l=>l.unsubscribe()),f=!0,u&&u.stop(),u=null,n.next(He)});const y=new Dn;var v;e.cloud={version:"4.0.12",options:Object.assign({},Mf),schema:null,get currentUserId(){return n.value.userId||He.userId},currentUser:n,syncState:new Qe({phase:"initial",status:"not-started"}),events:{syncComplete:y},persistedSyncState:new Qe(void 0),userInteraction:new Qe(void 0),webSocketStatus:new Qe("not-started"),login(l){return ee(this,void 0,void 0,function*(){const g=lt(e);yield g.cloud.sync(),yield Co(g,l)})},invites:$f(e),roles:mu(e),configure(l){l=e.cloud.options=Object.assign(Object.assign({},e.cloud.options),l),s=!0,l.databaseUrl&&l.nameSuffix&&(e.name=`${t}-${function(g){const b=new URL(g);return b.pathname==="/"?b.hostname.split(".")[0]:b.pathname.split("/")[1]}(l.databaseUrl)}`,lt(e).reconfigure()),Ro(e.cloud.schema,e.cloud.options)},logout({force:l}={}){return ee(this,void 0,void 0,function*(){l?yield Ho(lt(e),{deleteUnsyncedData:!0}):yield Na(lt(e))})},sync({wait:l,purpose:g}={wait:!0,purpose:"push"}){var b;return ee(this,void 0,void 0,function*(){l===void 0&&(l=!0);const w=lt(e);if((((b=w.cloud.currentUser.value.license)===null||b===void 0?void 0:b.status)||"ok")!=="ok"&&(yield vi(w)),g==="pull"){const j=w.cloud.persistedSyncState.value;if(dt(w,g),l){const K=yield Jt(w.cloud.persistedSyncState.pipe(rt(N=>(N==null?void 0:N.timestamp)!=null&&(!j||N.timestamp>j.timestamp))));if(K!=null&&K.error)throw new Error("Sync error: "+K.error)}}else if(yield Rs(w)){const j=w.cloud.persistedSyncState.value;dt(w,g),l&&(yield Jt(st(Gt(()=>ee(this,void 0,void 0,function*(){const K=yield Rs(w),N=yield w.getPersistedSyncState();if((N==null?void 0:N.timestamp)!==(j==null?void 0:j.timestamp)&&(N!=null&&N.error))throw new Error("Sync error: "+N.error);return K}))).pipe(rt(K=>!K))))}})},permissions:(l,g)=>function(b,w,j){if(!w)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:K,realmId:N}=w;if(!j){if(typeof w.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");j=w.table()}const q=gu(b),G=Q=>{const ce=Q[N||b.cloud.currentUserId];return ce?new Js(ce.permissions,j,N===void 0||N===b.cloud.currentUserId||K===b.cloud.currentUserId):new Js({},j,!K||K===b.cloud.currentUserId)},B=q.pipe(it(G));return B.getValue=()=>G(q.getValue()),B}(e._novip,l,g)},e.Version.prototype._parseStoresSpec=Se.override(e.Version.prototype._parseStoresSpec,l=>gf(l,e)),e.Table.prototype.newId=function({colocateWith:l}={}){const g=l&&l.substr(l.length-3);return eu(e.cloud.schema[this.name].idPrefix||"",g)},e.Table.prototype.idPrefix=function(){var l,g;return((g=(l=this.db.cloud.schema)===null||l===void 0?void 0:l[this.name])===null||g===void 0?void 0:g.idPrefix)||""},e.use(bf({currentUserObservable:e.cloud.currentUser,db:lt(e)})),e.use((v=lt(e),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:l=>Object.assign(Object.assign({},l),{table:g=>{const b=l.table(g);return Object.assign(Object.assign({},b),{mutate:w=>{var j,K,N,q;if(w.trans.disableChangeTracking)return b.mutate(w);const G=w.trans;if(!((K=(j=v.cloud.schema)===null||j===void 0?void 0:j[g])===null||K===void 0)&&K.markedForSync){if(G.mode==="versionchange")return Promise.reject(new Se.UpgradeError(`Dexie Cloud Addon: Cannot upgrade or populate synced table "${g}". See https://dexie.org/cloud/docs/best-practices`));if(w.type==="add"||w.type==="put"){if(g==="members")for(const B of w.values)typeof B.email=="string"&&(B.email=B.email.trim().toLowerCase());for(const B of w.values){B.owner||(B.owner=G.currentUser.userId),B.realmId||(B.realmId=G.currentUser.userId);const Q=(q=(N=b.schema.primaryKey).extractKey)===null||q===void 0?void 0:q.call(N,B);typeof Q=="string"&&Q[0]==="#"&&w.type==="put"&&(delete w.criteria,delete w.changeSpec,delete w.updates,B.$ts=Date.now())}}}return b.mutate(w)}})}})})),e.use(yf(lt(e)))}ri.version="4.0.12",Se.Cloud=ri;class Jf{constructor(){this._db=new Se("FlavorAwesome",{addons:[ri]}),this._db.version(20).stores({review:"id, created_at, updated_at, type",settings:"id"}),this._db.cloud.configure({customLoginGui:!0,databaseUrl:"https://zwa7o6jty.dexie.cloud",requireAuth:!1})}_filter(t,n){return t.filter(o=>!!(o.name.toLowerCase().indexOf(n)>=0||o.notes&&o.notes.toLowerCase().indexOf(n)>=0))}browseReview(t=null,n=null){return t===null?n===null?this._db.review.orderBy("updated_at").reverse().toArray():this._db.review.orderBy("updated_at").reverse().toArray().then(o=>this._filter(o,n)):n===null?this._db.review.where("type").equals(t).reverse().sortBy("updated_at"):this._db.review.where("type").equals(t).reverse().sortBy("updated_at").then(o=>this._filter(o,n))}readReview(t){return this._db.review.where("id").equals(t).toArray().then(n=>n[0])}addReview(t,n){const o=Oo(n);return o.id=crypto.randomUUID(),o.type=t,o.created_at=new Date,o.updated_at=new Date,o.favorite=!1,this._db.review.add(o)}editReview(t){const n=Oo(t);return n.updated_at=new Date,this._db.review.put(n).then(()=>this._db.review.where("id").equals(t.id).toArray().then(o=>o[0]))}deleteReview(t){return t===null?this._db.review.clear():this._db.review.delete(t)}countReview(){return this._db.review.toArray().then(t=>t.reduce((n,o)=>(n.hasOwnProperty(o.type)?n[o.type]=n[o.type]+1:n[o.type]=1,n),{All:t.length}))}favoriteReview(t,n){return this._db.review.update(t,{favorite:n,updated_at:new Date}).then(()=>this._db.review.where("id").equals(t).toArray().then(o=>o[0]))}countReviews(){return this._db.review.toArray().then(t=>t.length)}createSettings(){const t={id:crypto.randomUUID(),created_at:new Date,updated_at:new Date,book:null,avatar:null,name:null,selected:null};return this._db.settings.add(t).then(()=>this._db.settings.toArray()).then(n=>n[0])}readSettings(){return this._db.settings.toArray().then(t=>t.length===0?null:t[0])}updateSettings(t){const n=Oo(t);return n.updated_at=new Date,this._db.settings.put(n).then(()=>this._db.settings.toArray()).then(o=>o[0])}deleteSettings(){return this._db.settings.clear()}login(t){console.log("LOGIN EMAIL: "+t),this._db.cloud.login({email:t,grant_type:"otp"})}logout(){this._db.cloud.logout()}sync(){return console.log("DC SYNC"),this._db.cloud.sync({purpose:"pull",wait:!0})}get ui(){return this._db.cloud.userInteraction}get user(){return this._db.cloud.currentUser}get userId(){return this._db.cloud.currentUserId}}export{Jf as D};
